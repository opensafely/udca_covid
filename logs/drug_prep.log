
. 
. cap mkdir ./output/tables/

. 
. tempfile tempfile 

. import delimited using ./output/input_pbc.csv
(109 vars, 1,000 obs)

. save `tempfile' 
file /tmp/St00016.000001 saved

. 
. ** First import udca population
. import delimited using ./output/input_additional.csv, clear
(336 vars, 1,000 obs)

. 
. describe 

Contains data
  obs:         1,000                          
 vars:           336                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
udca_1          str10   %10s                  
udca_2          str10   %10s                  
udca_3          str10   %10s                  
udca_4          str10   %10s                  
udca_5          str10   %10s                  
udca_6          str10   %10s                  
udca_7          str10   %10s                  
udca_8          str10   %10s                  
udca_9          str10   %10s                  
udca_10         str10   %10s                  
udca_11         str10   %10s                  
udca_12         str10   %10s                  
udca_13         str10   %10s                  
udca_14         str10   %10s                  
udca_15         str10   %10s                  
udca_16         str10   %10s                  
udca_17         str10   %10s                  
udca_18         str10   %10s                  
udca_19         str10   %10s                  
udca_20         str10   %10s                  
udca_21         str10   %10s                  
udca_22         str10   %10s                  
udca_23         str10   %10s                  
udca_24         str10   %10s                  
udca_25         str10   %10s                  
udca_26         str10   %10s                  
udca_27         str10   %10s                  
udca_28         str10   %10s                  
udca_29         str10   %10s                  
udca_30         str10   %10s                  
udca_31         str10   %10s                  
udca_32         str10   %10s                  
udca_33         str10   %10s                  
udca_34         str10   %10s                  
udca_35         str10   %10s                  
udca_36         str10   %10s                  
udca_37         str10   %10s                  
udca_38         str10   %10s                  
udca_39         str10   %10s                  
udca_40         str10   %10s                  
udca_41         str10   %10s                  
udca_42         str10   %10s                  
udca_43         str10   %10s                  
udca_44         str10   %10s                  
udca_45         str10   %10s                  
udca_46         str10   %10s                  
udca_47         str10   %10s                  
udca_48         str10   %10s                  
udca_49         str10   %10s                  
udca_50         str10   %10s                  
udca_51         str10   %10s                  
udca_52         str10   %10s                  
udca_53         str10   %10s                  
udca_54         str10   %10s                  
udca_55         str10   %10s                  
udca_56         str10   %10s                  
udca_57         str10   %10s                  
udca_58         str10   %10s                  
udca_59         str10   %10s                  
udca_60         str10   %10s                  
udca_61         str10   %10s                  
udca_62         str10   %10s                  
udca_63         str10   %10s                  
udca_64         str10   %10s                  
udca_65         str10   %10s                  
udca_66         str10   %10s                  
udca_67         str10   %10s                  
udca_68         str10   %10s                  
udca_69         str10   %10s                  
udca_70         str10   %10s                  
udca_71         str10   %10s                  
udca_72         str10   %10s                  
udca_73         str10   %10s                  
udca_74         str10   %10s                  
udca_75         str10   %10s                  
udca_76         str10   %10s                  
udca_77         str10   %10s                  
udca_78         str10   %10s                  
udca_79         str10   %10s                  
udca_80         str10   %10s                  
udca_81         str10   %10s                  
udca_82         str10   %10s                  
udca_83         str10   %10s                  
udca_84         str10   %10s                  
udca_85         str10   %10s                  
udca_86         str10   %10s                  
udca_87         str10   %10s                  
udca_88         str10   %10s                  
udca_89         str10   %10s                  
udca_90         str10   %10s                  
udca_91         str10   %10s                  
udca_92         str10   %10s                  
udca_93         str10   %10s                  
udca_94         str10   %10s                  
udca_95         str10   %10s                  
udca_96         str10   %10s                  
udca_97         str10   %10s                  
udca_98         str10   %10s                  
udca_99         str10   %10s                  
udca_100        str10   %10s                  
udca_101        str10   %10s                  
udca_102        str10   %10s                  
udca_103        str10   %10s                  
udca_104        str10   %10s                  
udca_105        str10   %10s                  
udca_106        str10   %10s                  
udca_107        str10   %10s                  
udca_108        str10   %10s                  
udca_109        str10   %10s                  
udca_110        str10   %10s                  
udca_111        str10   %10s                  
udca_112        str10   %10s                  
udca_113        str10   %10s                  
udca_114        str10   %10s                  
udca_115        str10   %10s                  
udca_116        str10   %10s                  
udca_117        str10   %10s                  
udca_118        str10   %10s                  
udca_119        str10   %10s                  
udca_120        str10   %10s                  
udca_121        str10   %10s                  
udca_122        str10   %10s                  
udca_123        str10   %10s                  
udca_124        str10   %10s                  
udca_125        str10   %10s                  
udca_126        str10   %10s                  
udca_127        str10   %10s                  
udca_128        str10   %10s                  
udca_129        str10   %10s                  
udca_130        str10   %10s                  
udca_131        str10   %10s                  
udca_132        str10   %10s                  
udca_133        str10   %10s                  
udca_134        str10   %10s                  
udca_135        str10   %10s                  
udca_136        str10   %10s                  
udca_137        str10   %10s                  
udca_138        str10   %10s                  
udca_139        str10   %10s                  
udca_140        str10   %10s                  
udca_141        str10   %10s                  
udca_142        str10   %10s                  
udca_143        str10   %10s                  
udca_144        str10   %10s                  
udca_145        str10   %10s                  
udca_146        str10   %10s                  
udca_147        str10   %10s                  
udca_148        str10   %10s                  
udca_149        str10   %10s                  
udca_150        str10   %10s                  
udca_151        str10   %10s                  
udca_152        str10   %10s                  
udca_153        str10   %10s                  
udca_154        str10   %10s                  
udca_155        str10   %10s                  
udca_156        str10   %10s                  
udca_157        str10   %10s                  
udca_158        str10   %10s                  
udca_159        str10   %10s                  
udca_160        str10   %10s                  
udca_161        str10   %10s                  
udca_162        str10   %10s                  
udca_163        str10   %10s                  
udca_164        str10   %10s                  
udca_165        str10   %10s                  
udca_166        str10   %10s                  
udca_167        str10   %10s                  
udca_168        str10   %10s                  
udca_169        str10   %10s                  
udca_170        str10   %10s                  
udca_171        str10   %10s                  
udca_172        str10   %10s                  
udca_173        str10   %10s                  
udca_174        str10   %10s                  
udca_175        str10   %10s                  
udca_176        str10   %10s                  
udca_177        str10   %10s                  
udca_178        str10   %10s                  
udca_179        str10   %10s                  
udca_180        str10   %10s                  
udca_181        str10   %10s                  
udca_182        str10   %10s                  
udca_183        str10   %10s                  
udca_184        str10   %10s                  
udca_185        str10   %10s                  
udca_186        str10   %10s                  
udca_187        str10   %10s                  
udca_188        str10   %10s                  
udca_189        str10   %10s                  
udca_190        str10   %10s                  
udca_191        str10   %10s                  
udca_192        str10   %10s                  
udca_193        str10   %10s                  
udca_194        str10   %10s                  
udca_195        str10   %10s                  
udca_196        str10   %10s                  
udca_197        str10   %10s                  
udca_198        str10   %10s                  
udca_199        str10   %10s                  
udca_200        str10   %10s                  
udca_201        str10   %10s                  
udca_202        str10   %10s                  
udca_203        str10   %10s                  
udca_204        str10   %10s                  
udca_205        str10   %10s                  
udca_206        str10   %10s                  
udca_207        str10   %10s                  
udca_208        str10   %10s                  
udca_209        str10   %10s                  
udca_210        str10   %10s                  
udca_211        str10   %10s                  
udca_212        str10   %10s                  
udca_213        str10   %10s                  
udca_214        str10   %10s                  
udca_215        str10   %10s                  
udca_216        str10   %10s                  
udca_217        str10   %10s                  
udca_218        str10   %10s                  
udca_219        str10   %10s                  
udca_220        str10   %10s                  
udca_221        str10   %10s                  
udca_222        str10   %10s                  
udca_223        str10   %10s                  
udca_224        str10   %10s                  
udca_225        str10   %10s                  
udca_226        str10   %10s                  
udca_227        str10   %10s                  
udca_228        str10   %10s                  
udca_229        str10   %10s                  
udca_230        str10   %10s                  
udca_231        str10   %10s                  
udca_232        str10   %10s                  
udca_233        str10   %10s                  
udca_234        str10   %10s                  
udca_235        str10   %10s                  
udca_236        str10   %10s                  
udca_237        str10   %10s                  
udca_238        str10   %10s                  
udca_239        str10   %10s                  
udca_240        str10   %10s                  
udca_241        str10   %10s                  
udca_242        str10   %10s                  
udca_243        str10   %10s                  
udca_244        str10   %10s                  
udca_245        str10   %10s                  
udca_246        str10   %10s                  
udca_247        str10   %10s                  
udca_248        str10   %10s                  
udca_249        str10   %10s                  
udca_250        str10   %10s                  
udca_251        str10   %10s                  
udca_252        str10   %10s                  
udca_253        str10   %10s                  
udca_254        str10   %10s                  
udca_255        str10   %10s                  
udca_256        str10   %10s                  
udca_257        str10   %10s                  
udca_258        str10   %10s                  
udca_259        str10   %10s                  
udca_260        str10   %10s                  
udca_261        str10   %10s                  
udca_262        str10   %10s                  
udca_263        str10   %10s                  
udca_264        str10   %10s                  
udca_265        str10   %10s                  
udca_266        str10   %10s                  
udca_267        str10   %10s                  
udca_268        str10   %10s                  
udca_269        str10   %10s                  
udca_270        str10   %10s                  
udca_271        str10   %10s                  
udca_272        str10   %10s                  
udca_273        str10   %10s                  
udca_274        str10   %10s                  
udca_275        str10   %10s                  
udca_276        str10   %10s                  
udca_277        str10   %10s                  
udca_278        str10   %10s                  
udca_279        str10   %10s                  
udca_280        str10   %10s                  
udca_281        str10   %10s                  
udca_282        str10   %10s                  
udca_283        str10   %10s                  
udca_284        str10   %10s                  
udca_285        str10   %10s                  
udca_286        str10   %10s                  
udca_287        str10   %10s                  
udca_288        str10   %10s                  
udca_289        str10   %10s                  
udca_290        str10   %10s                  
udca_291        str10   %10s                  
udca_292        str10   %10s                  
udca_293        str10   %10s                  
udca_294        str10   %10s                  
udca_295        str10   %10s                  
udca_296        str10   %10s                  
udca_297        str10   %10s                  
udca_298        str10   %10s                  
udca_299        str10   %10s                  
udca_300        str10   %10s                  
udca_301        str10   %10s                  
udca_302        str10   %10s                  
udca_303        str10   %10s                  
udca_304        str10   %10s                  
udca_305        str10   %10s                  
udca_306        str10   %10s                  
udca_307        str10   %10s                  
udca_308        str10   %10s                  
udca_309        str10   %10s                  
udca_310        str10   %10s                  
udca_311        str10   %10s                  
udca_312        str10   %10s                  
udca_313        str10   %10s                  
udca_314        str10   %10s                  
udca_315        str10   %10s                  
udca_316        str10   %10s                  
udca_317        str10   %10s                  
udca_318        str10   %10s                  
udca_319        str10   %10s                  
udca_320        str10   %10s                  
udca_321        str10   %10s                  
udca_322        str10   %10s                  
udca_323        str10   %10s                  
udca_324        str10   %10s                  
udca_325        str10   %10s                  
udca_326        str10   %10s                  
udca_327        str10   %10s                  
udca_328        str10   %10s                  
udca_329        str10   %10s                  
udca_330        str10   %10s                  
udca_331        str10   %10s                  
udca_332        str10   %10s                  
udca_333        str10   %10s                  
udca_334        str10   %10s                  
udca_335        str10   %10s                  
patient_id      int     %8.0g                 
-------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. *Some records identified in study_definition_additional 
. *missings report, minimum(12400)
. missings dropvars udca_*, force

Checking missings in udca_1 udca_2 udca_3 udca_4 udca_5 udca_6 udca_7 udca_8
    udca_9 udca_10 udca_11 udca_12 udca_13 udca_14 udca_15 udca_16 udca_17
    udca_18 udca_19 udca_20 udca_21 udca_22 udca_23 udca_24 udca_25 udca_26
    udca_27 udca_28 udca_29 udca_30 udca_31 udca_32 udca_33 udca_34 udca_35
    udca_36 udca_37 udca_38 udca_39 udca_40 udca_41 udca_42 udca_43 udca_44
    udca_45 udca_46 udca_47 udca_48 udca_49 udca_50 udca_51 udca_52 udca_53
    udca_54 udca_55 udca_56 udca_57 udca_58 udca_59 udca_60 udca_61 udca_62
    udca_63 udca_64 udca_65 udca_66 udca_67 udca_68 udca_69 udca_70 udca_71
    udca_72 udca_73 udca_74 udca_75 udca_76 udca_77 udca_78 udca_79 udca_80
    udca_81 udca_82 udca_83 udca_84 udca_85 udca_86 udca_87 udca_88 udca_89
    udca_90 udca_91 udca_92 udca_93 udca_94 udca_95 udca_96 udca_97 udca_98
    udca_99 udca_100 udca_101 udca_102 udca_103 udca_104 udca_105 udca_106
    udca_107 udca_108 udca_109 udca_110 udca_111 udca_112 udca_113 udca_114
    udca_115 udca_116 udca_117 udca_118 udca_119 udca_120 udca_121 udca_122
    udca_123 udca_124 udca_125 udca_126 udca_127 udca_128 udca_129 udca_130
    udca_131 udca_132 udca_133 udca_134 udca_135 udca_136 udca_137 udca_138
    udca_139 udca_140 udca_141 udca_142 udca_143 udca_144 udca_145 udca_146
    udca_147 udca_148 udca_149 udca_150 udca_151 udca_152 udca_153 udca_154
    udca_155 udca_156 udca_157 udca_158 udca_159 udca_160 udca_161 udca_162
    udca_163 udca_164 udca_165 udca_166 udca_167 udca_168 udca_169 udca_170
    udca_171 udca_172 udca_173 udca_174 udca_175 udca_176 udca_177 udca_178
    udca_179 udca_180 udca_181 udca_182 udca_183 udca_184 udca_185 udca_186
    udca_187 udca_188 udca_189 udca_190 udca_191 udca_192 udca_193 udca_194
    udca_195 udca_196 udca_197 udca_198 udca_199 udca_200 udca_201 udca_202
    udca_203 udca_204 udca_205 udca_206 udca_207 udca_208 udca_209 udca_210
    udca_211 udca_212 udca_213 udca_214 udca_215 udca_216 udca_217 udca_218
    udca_219 udca_220 udca_221 udca_222 udca_223 udca_224 udca_225 udca_226
    udca_227 udca_228 udca_229 udca_230 udca_231 udca_232 udca_233 udca_234
    udca_235 udca_236 udca_237 udca_238 udca_239 udca_240 udca_241 udca_242
    udca_243 udca_244 udca_245 udca_246 udca_247 udca_248 udca_249 udca_250
    udca_251 udca_252 udca_253 udca_254 udca_255 udca_256 udca_257 udca_258
    udca_259 udca_260 udca_261 udca_262 udca_263 udca_264 udca_265 udca_266
    udca_267 udca_268 udca_269 udca_270 udca_271 udca_272 udca_273 udca_274
    udca_275 udca_276 udca_277 udca_278 udca_279 udca_280 udca_281 udca_282
    udca_283 udca_284 udca_285 udca_286 udca_287 udca_288 udca_289 udca_290
    udca_291 udca_292 udca_293 udca_294 udca_295 udca_296 udca_297 udca_298
    udca_299 udca_300 udca_301 udca_302 udca_303 udca_304 udca_305 udca_306
    udca_307 udca_308 udca_309 udca_310 udca_311 udca_312 udca_313 udca_314
    udca_315 udca_316 udca_317 udca_318 udca_319 udca_320 udca_321 udca_322
    udca_323 udca_324 udca_325 udca_326 udca_327 udca_328 udca_329 udca_330
    udca_331 udca_332 udca_333 udca_334 udca_335:
1000 observations with missing values

note: no variables qualify

. 
. * Format dates
. * First count number of variables for loop
. describe 

Contains data
  obs:         1,000                          
 vars:           336                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
udca_1          str10   %10s                  
udca_2          str10   %10s                  
udca_3          str10   %10s                  
udca_4          str10   %10s                  
udca_5          str10   %10s                  
udca_6          str10   %10s                  
udca_7          str10   %10s                  
udca_8          str10   %10s                  
udca_9          str10   %10s                  
udca_10         str10   %10s                  
udca_11         str10   %10s                  
udca_12         str10   %10s                  
udca_13         str10   %10s                  
udca_14         str10   %10s                  
udca_15         str10   %10s                  
udca_16         str10   %10s                  
udca_17         str10   %10s                  
udca_18         str10   %10s                  
udca_19         str10   %10s                  
udca_20         str10   %10s                  
udca_21         str10   %10s                  
udca_22         str10   %10s                  
udca_23         str10   %10s                  
udca_24         str10   %10s                  
udca_25         str10   %10s                  
udca_26         str10   %10s                  
udca_27         str10   %10s                  
udca_28         str10   %10s                  
udca_29         str10   %10s                  
udca_30         str10   %10s                  
udca_31         str10   %10s                  
udca_32         str10   %10s                  
udca_33         str10   %10s                  
udca_34         str10   %10s                  
udca_35         str10   %10s                  
udca_36         str10   %10s                  
udca_37         str10   %10s                  
udca_38         str10   %10s                  
udca_39         str10   %10s                  
udca_40         str10   %10s                  
udca_41         str10   %10s                  
udca_42         str10   %10s                  
udca_43         str10   %10s                  
udca_44         str10   %10s                  
udca_45         str10   %10s                  
udca_46         str10   %10s                  
udca_47         str10   %10s                  
udca_48         str10   %10s                  
udca_49         str10   %10s                  
udca_50         str10   %10s                  
udca_51         str10   %10s                  
udca_52         str10   %10s                  
udca_53         str10   %10s                  
udca_54         str10   %10s                  
udca_55         str10   %10s                  
udca_56         str10   %10s                  
udca_57         str10   %10s                  
udca_58         str10   %10s                  
udca_59         str10   %10s                  
udca_60         str10   %10s                  
udca_61         str10   %10s                  
udca_62         str10   %10s                  
udca_63         str10   %10s                  
udca_64         str10   %10s                  
udca_65         str10   %10s                  
udca_66         str10   %10s                  
udca_67         str10   %10s                  
udca_68         str10   %10s                  
udca_69         str10   %10s                  
udca_70         str10   %10s                  
udca_71         str10   %10s                  
udca_72         str10   %10s                  
udca_73         str10   %10s                  
udca_74         str10   %10s                  
udca_75         str10   %10s                  
udca_76         str10   %10s                  
udca_77         str10   %10s                  
udca_78         str10   %10s                  
udca_79         str10   %10s                  
udca_80         str10   %10s                  
udca_81         str10   %10s                  
udca_82         str10   %10s                  
udca_83         str10   %10s                  
udca_84         str10   %10s                  
udca_85         str10   %10s                  
udca_86         str10   %10s                  
udca_87         str10   %10s                  
udca_88         str10   %10s                  
udca_89         str10   %10s                  
udca_90         str10   %10s                  
udca_91         str10   %10s                  
udca_92         str10   %10s                  
udca_93         str10   %10s                  
udca_94         str10   %10s                  
udca_95         str10   %10s                  
udca_96         str10   %10s                  
udca_97         str10   %10s                  
udca_98         str10   %10s                  
udca_99         str10   %10s                  
udca_100        str10   %10s                  
udca_101        str10   %10s                  
udca_102        str10   %10s                  
udca_103        str10   %10s                  
udca_104        str10   %10s                  
udca_105        str10   %10s                  
udca_106        str10   %10s                  
udca_107        str10   %10s                  
udca_108        str10   %10s                  
udca_109        str10   %10s                  
udca_110        str10   %10s                  
udca_111        str10   %10s                  
udca_112        str10   %10s                  
udca_113        str10   %10s                  
udca_114        str10   %10s                  
udca_115        str10   %10s                  
udca_116        str10   %10s                  
udca_117        str10   %10s                  
udca_118        str10   %10s                  
udca_119        str10   %10s                  
udca_120        str10   %10s                  
udca_121        str10   %10s                  
udca_122        str10   %10s                  
udca_123        str10   %10s                  
udca_124        str10   %10s                  
udca_125        str10   %10s                  
udca_126        str10   %10s                  
udca_127        str10   %10s                  
udca_128        str10   %10s                  
udca_129        str10   %10s                  
udca_130        str10   %10s                  
udca_131        str10   %10s                  
udca_132        str10   %10s                  
udca_133        str10   %10s                  
udca_134        str10   %10s                  
udca_135        str10   %10s                  
udca_136        str10   %10s                  
udca_137        str10   %10s                  
udca_138        str10   %10s                  
udca_139        str10   %10s                  
udca_140        str10   %10s                  
udca_141        str10   %10s                  
udca_142        str10   %10s                  
udca_143        str10   %10s                  
udca_144        str10   %10s                  
udca_145        str10   %10s                  
udca_146        str10   %10s                  
udca_147        str10   %10s                  
udca_148        str10   %10s                  
udca_149        str10   %10s                  
udca_150        str10   %10s                  
udca_151        str10   %10s                  
udca_152        str10   %10s                  
udca_153        str10   %10s                  
udca_154        str10   %10s                  
udca_155        str10   %10s                  
udca_156        str10   %10s                  
udca_157        str10   %10s                  
udca_158        str10   %10s                  
udca_159        str10   %10s                  
udca_160        str10   %10s                  
udca_161        str10   %10s                  
udca_162        str10   %10s                  
udca_163        str10   %10s                  
udca_164        str10   %10s                  
udca_165        str10   %10s                  
udca_166        str10   %10s                  
udca_167        str10   %10s                  
udca_168        str10   %10s                  
udca_169        str10   %10s                  
udca_170        str10   %10s                  
udca_171        str10   %10s                  
udca_172        str10   %10s                  
udca_173        str10   %10s                  
udca_174        str10   %10s                  
udca_175        str10   %10s                  
udca_176        str10   %10s                  
udca_177        str10   %10s                  
udca_178        str10   %10s                  
udca_179        str10   %10s                  
udca_180        str10   %10s                  
udca_181        str10   %10s                  
udca_182        str10   %10s                  
udca_183        str10   %10s                  
udca_184        str10   %10s                  
udca_185        str10   %10s                  
udca_186        str10   %10s                  
udca_187        str10   %10s                  
udca_188        str10   %10s                  
udca_189        str10   %10s                  
udca_190        str10   %10s                  
udca_191        str10   %10s                  
udca_192        str10   %10s                  
udca_193        str10   %10s                  
udca_194        str10   %10s                  
udca_195        str10   %10s                  
udca_196        str10   %10s                  
udca_197        str10   %10s                  
udca_198        str10   %10s                  
udca_199        str10   %10s                  
udca_200        str10   %10s                  
udca_201        str10   %10s                  
udca_202        str10   %10s                  
udca_203        str10   %10s                  
udca_204        str10   %10s                  
udca_205        str10   %10s                  
udca_206        str10   %10s                  
udca_207        str10   %10s                  
udca_208        str10   %10s                  
udca_209        str10   %10s                  
udca_210        str10   %10s                  
udca_211        str10   %10s                  
udca_212        str10   %10s                  
udca_213        str10   %10s                  
udca_214        str10   %10s                  
udca_215        str10   %10s                  
udca_216        str10   %10s                  
udca_217        str10   %10s                  
udca_218        str10   %10s                  
udca_219        str10   %10s                  
udca_220        str10   %10s                  
udca_221        str10   %10s                  
udca_222        str10   %10s                  
udca_223        str10   %10s                  
udca_224        str10   %10s                  
udca_225        str10   %10s                  
udca_226        str10   %10s                  
udca_227        str10   %10s                  
udca_228        str10   %10s                  
udca_229        str10   %10s                  
udca_230        str10   %10s                  
udca_231        str10   %10s                  
udca_232        str10   %10s                  
udca_233        str10   %10s                  
udca_234        str10   %10s                  
udca_235        str10   %10s                  
udca_236        str10   %10s                  
udca_237        str10   %10s                  
udca_238        str10   %10s                  
udca_239        str10   %10s                  
udca_240        str10   %10s                  
udca_241        str10   %10s                  
udca_242        str10   %10s                  
udca_243        str10   %10s                  
udca_244        str10   %10s                  
udca_245        str10   %10s                  
udca_246        str10   %10s                  
udca_247        str10   %10s                  
udca_248        str10   %10s                  
udca_249        str10   %10s                  
udca_250        str10   %10s                  
udca_251        str10   %10s                  
udca_252        str10   %10s                  
udca_253        str10   %10s                  
udca_254        str10   %10s                  
udca_255        str10   %10s                  
udca_256        str10   %10s                  
udca_257        str10   %10s                  
udca_258        str10   %10s                  
udca_259        str10   %10s                  
udca_260        str10   %10s                  
udca_261        str10   %10s                  
udca_262        str10   %10s                  
udca_263        str10   %10s                  
udca_264        str10   %10s                  
udca_265        str10   %10s                  
udca_266        str10   %10s                  
udca_267        str10   %10s                  
udca_268        str10   %10s                  
udca_269        str10   %10s                  
udca_270        str10   %10s                  
udca_271        str10   %10s                  
udca_272        str10   %10s                  
udca_273        str10   %10s                  
udca_274        str10   %10s                  
udca_275        str10   %10s                  
udca_276        str10   %10s                  
udca_277        str10   %10s                  
udca_278        str10   %10s                  
udca_279        str10   %10s                  
udca_280        str10   %10s                  
udca_281        str10   %10s                  
udca_282        str10   %10s                  
udca_283        str10   %10s                  
udca_284        str10   %10s                  
udca_285        str10   %10s                  
udca_286        str10   %10s                  
udca_287        str10   %10s                  
udca_288        str10   %10s                  
udca_289        str10   %10s                  
udca_290        str10   %10s                  
udca_291        str10   %10s                  
udca_292        str10   %10s                  
udca_293        str10   %10s                  
udca_294        str10   %10s                  
udca_295        str10   %10s                  
udca_296        str10   %10s                  
udca_297        str10   %10s                  
udca_298        str10   %10s                  
udca_299        str10   %10s                  
udca_300        str10   %10s                  
udca_301        str10   %10s                  
udca_302        str10   %10s                  
udca_303        str10   %10s                  
udca_304        str10   %10s                  
udca_305        str10   %10s                  
udca_306        str10   %10s                  
udca_307        str10   %10s                  
udca_308        str10   %10s                  
udca_309        str10   %10s                  
udca_310        str10   %10s                  
udca_311        str10   %10s                  
udca_312        str10   %10s                  
udca_313        str10   %10s                  
udca_314        str10   %10s                  
udca_315        str10   %10s                  
udca_316        str10   %10s                  
udca_317        str10   %10s                  
udca_318        str10   %10s                  
udca_319        str10   %10s                  
udca_320        str10   %10s                  
udca_321        str10   %10s                  
udca_322        str10   %10s                  
udca_323        str10   %10s                  
udca_324        str10   %10s                  
udca_325        str10   %10s                  
udca_326        str10   %10s                  
udca_327        str10   %10s                  
udca_328        str10   %10s                  
udca_329        str10   %10s                  
udca_330        str10   %10s                  
udca_331        str10   %10s                  
udca_332        str10   %10s                  
udca_333        str10   %10s                  
udca_334        str10   %10s                  
udca_335        str10   %10s                  
patient_id      int     %8.0g                 
-------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

. local var = r(k)-1

. forvalues i=1/`var' {
  2.     gen udcaA`i' = date(udca_`i', "YMD")
  3.     format udcaA`i' %dD/N/CY
  4.     drop udca_`i'
  5. }
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)

. 
. * Reshape to long format 
. reshape long udcaA, i(patient_id) j(presc_number)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26
>  27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 5
> 2 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 
> 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102
>  103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 
> 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 1
> 41 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 16
> 0 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179
>  180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 
> 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 2
> 18 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 23
> 7 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256
>  257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 
> 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 2
> 95 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 31
> 4 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333
>  334 335)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     1000   ->  335000
Number of variables                 336   ->       3
j variable (335 values)                   ->   presc_number
xij variables:
             udcaA1 udcaA2 ... udcaA335   ->   udcaA
-----------------------------------------------------------------------------

. 
. * Drop rows where there is no prescription
. drop if udcaA==.
(167,500 observations deleted)

. 
. * Check that prescriptions are in order
. gen order_flag = (udcaA<udcaA[_n-1] & patient_id==patient_id[_n-1])

. tab order_flag 

 order_flag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     84,301       50.33       50.33
          1 |     83,199       49.67      100.00
------------+-----------------------------------
      Total |    167,500      100.00

. * Create flag if any out of order prescriptions in the data - should only be 
> in dummy data 
. egen out_of_order = max(order_flag)

. tab out_of_order

out_of_orde |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    167,500      100.00      100.00
------------+-----------------------------------
      Total |    167,500      100.00

. 
. * Sort if out of order - should only apply to dummy data 
. sort patient_id udcaA 

. 
. drop order_flag

. * Check in order
. gen order_flag = (udcaA<udcaA[_n-1] & patient_id==patient_id[_n-1])

. tab order_flag

 order_flag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    167,500      100.00      100.00
------------+-----------------------------------
      Total |    167,500      100.00

. 
. * Identify prescriptions with the same date 
. bys patient_id (udcaA): gen dup_presc = (udcaA==udcaA[_n-1])

. tab dup_presc 

  dup_presc |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    156,971       93.71       93.71
          1 |     10,529        6.29      100.00
------------+-----------------------------------
      Total |    167,500      100.00

. * Drop them 
. drop if dup_presc 
(10,529 observations deleted)

. 
. drop order_flag out_of_order dup_presc presc_number

. 
. * Re-count number of prescriptions 
. gen udca=1

. bys patient_id: egen total_no_presc = total(udca)

. sum total_no_presc, d

                       total_no_presc
-------------------------------------------------------------
      Percentiles      Smallest
 1%          138            134
 5%          143            134
10%          147            134       Obs             156,971
25%          152            134       Sum of Wgt.     156,971

50%          157                      Mean           157.4379
                        Largest       Std. Dev.      8.559788
75%          163            186
90%          169            186       Variance       73.26998
95%          171            186       Skewness       .0398291
99%          176            186       Kurtosis       2.868722

. 
. * Determine length of time from previous prescription 
. bys patient_id (udcaA): gen time_previous = udcaA - udcaA[_n-1]
(1,000 missing values generated)

. sum time_previous, d 

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs             155,971
25%            3              1       Sum of Wgt.     155,971

50%            6                      Mean           8.187855
                        Largest       Std. Dev.      7.654337
75%           11             84
90%           18             85       Variance       58.58888
95%           23             93       Skewness        1.98384
99%           36             99       Kurtosis       8.852655

. gen year = year(udcaA)

. bys year: sum time_previous, d

-------------------------------------------------------------------------------
-> year = 2020

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              35,777
25%            3              1       Sum of Wgt.      35,777

50%            6                      Mean           8.075887
                        Largest       Std. Dev.      7.520059
75%           11             69
90%           18             74       Variance       56.55129
95%           23             77       Skewness       1.959286
99%           35             99       Kurtosis       8.689126

-------------------------------------------------------------------------------
-> year = 2021

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              44,333
25%            3              1       Sum of Wgt.      44,333

50%            6                      Mean           8.241355
                        Largest       Std. Dev.      7.707629
75%           11             69
90%           18             71       Variance       59.40755
95%           24             73       Skewness       1.966419
99%           36             84       Kurtosis       8.618953

-------------------------------------------------------------------------------
-> year = 2022

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              44,308
25%            3              1       Sum of Wgt.      44,308

50%            6                      Mean           8.239076
                        Largest       Std. Dev.      7.748668
75%           11             79
90%           18             83       Variance       60.04185
95%           23             85       Skewness       2.064156
99%           36             93       Kurtosis       9.658708

-------------------------------------------------------------------------------
-> year = 2023

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              31,553
25%            3              1       Sum of Wgt.      31,553

50%            6                      Mean           8.167718
                        Largest       Std. Dev.      7.595518
75%           11             64
90%           18             66       Variance       57.69189
95%           23             68       Skewness        1.91273
99%           35             70       Kurtosis       8.115641


. 
. * Drop records in 2023 as this is after end of study
. drop if year==2023
(31,553 observations deleted)

. * Loop through assuming end date is 60 up to 180 days after prescription gene
> rated
. forvalues i = 60(30)180 {
  2.     preserve
  3.     gen stop_date = udcaA + `i'
  4.     format stop_date %dD/N/CY 
  5. 
.     * Drop rows where prescriptions ends prior to March 2020
.     count if stop_date <= date("01March2020", "DMY")
  6.     drop if stop_date <= date("01March2020", "DMY")
  7. 
.     * Collapse adjacent prescriptions that are continuous prescribing into on
> e period 
.     * Flag if start date is greater than assumed stop date of previous prescr
> iption 
.     bys patient_id (udcaA): gen spell = udcaA > stop_date[_n-1]
  8.     bys patient_id (udcaA): replace spell = 1 if _n==1
  9.     * Flag each row associated with each spell 
.     bys patient_id (udcaA): gen spell_sum = sum(spell) 
 10.     * Start date of spell 
.     bys patient_id spell_sum (udcaA): gen start = udcaA[1] 
 11.     bys patient_id spell_sum (udcaA): gen stop = stop_date[_N] 
 12.     format start stop %dD/N/CY
 13.     keep patient_id start stop udca total_no_presc
 14.     duplicates drop 
 15. 
.     * Add in rows where there are gaps between prescriptions 
.     bys patient_id (start): gen to_expand = 1 + (stop < start[_n+1])*(start[_
> n+1]~=.)
 16.     tab to_expand 
 17.     expand to_expand 
 18. 
.     * Flag new rows
.     bys patient_id start: gen new_record = (_n==2)
 19.     tab to_expand new_record 
 20. 
.     * Updating new rows 
.     sort patient_id start
 21.     replace udca=0 if new_record==1
 22.     replace start = stop if new_record==1
 23.     bys patient_id (start): replace stop = start[_n+1] if new_record==1
 24.     drop new_record to_expand
 25. 
.     * Checks 
.     count if stop<start 
 26.     sort patient_id start
 27.     count if stop[_n-1]>start & patient_id==patient_id[_n-1]
 28. 
.     * Update rows to match follow-up time
.     * merge variables from original study definition 
.     merge m:1 patient_id using `tempfile', keepusing(dereg_date died_date_ons
>  udca_count_bl) 
 29.     tab _merge
 30. 
.     * Update variables for people without any prescriptions 
.     replace start = date("01/03/2020", "DMY") if _merge==2
 31.     replace udca = 0 if _merge==2
 32.     replace stop = date("31/12/2022", "DMY") if _merge==2
 33.     replace total_no_presc = 0 if _merge==2
 34. 
.     * Determine end of follow-up date
.     gen dereg_dateA = date(dereg_date, "YMD")
 35.     format %dD/N/CY dereg_dateA
 36.     drop dereg_date
 37.     gen died_dateA = date(died_date_ons, "YMD")
 38.     format %dD/N/CY died_dateA
 39.     drop died_date_ons
 40.     gen end_study = date("31/12/2022", "DMY")
 41.     egen end_date = rowmin(dereg_dateA end_study died_dateA)
 42.     * Create flag indicating reason for end of follow-up 
.     gen end_date_flag = (end_date==dereg_dateA)
 43.     replace end_date_flag = 2 if end_date==died_dateA
 44.     replace end_date_flag = 3 if end_date==end_study
 45.     
.     * Count number of days of follow-up 
.     gen total_fu = end_date - date("01/03/2020", "DMY")
 46. 
.     ** Update start and end of follow-up for cohort
.     * Identify prescriptions that start prior to March 2020
.     gen start_prior = (start < date("01/03/2020", "DMY"))
 47.     replace start = date("01/03/2020", "DMY") if start_prior==1
 48. 
.     * Identify first prescriptions that start after March 2020
.     bys patient_id (start): gen start_after = 1 + (start > date("01/03/2020",
>  "DMY") & _n==1)
 49.     tab start_after
 50.     expand start_after
 51. 
.     * Flag new rows
.     bys patient_id start: gen new_record = (_n==2)
 52.     tab start_after new_record 
 53. 
.     * Updating new rows 
.     sort patient_id start
 54.     replace udca=0 if new_record==1
 55.     replace stop = start if new_record==1
 56.     replace start = date("01/03/2020", "DMY") if new_record==1
 57.     drop new_record start_after
 58. 
.     tab end_date_flag if start==date("01/03/2020", "DMY"), m 
 59.     * Identify rows that end after study end date for person 
.     gen end_after = (stop > end_date )
 60.     gen end_before = (start > end_date) 
 61. 
.     tab end_after
 62.     tab end_after end_date_flag
 63.     tab end_before 
 64. 
.     * Drop whole rows that are after end_date 
.     drop if end_before 
 65. 
.     * Check years of stop dates 
.     gen yr_stop = year(stop)
 66.     tab yr_stop end_after 
 67. 
.     * Check those flagged as ending after are last row only 
.     bys patient_id (start): gen last = _n==_N
 68.     tab last end_after 
 69.     * Check how many records end after end date - should just be one
.     bys patient_id: egen tot_end_after = total(end_after)
 70. 
.     replace stop = end_date if end_after==1 & end_before==0
 71. 
.     * Identify prescriptions that end prior to end of follow-up 
.     bys patient_id (start): gen stop_prior = 1 + (stop < end_date & _n==_N)
 72.     tab stop_prior
 73.     expand stop_prior
 74. 
.     * Flag new rows
.     bys patient_id start: gen new_record = (_n==2)
 75.     tab stop_prior new_record 
 76. 
.     * Updating new rows 
.     sort patient_id start
 77.     replace udca=0 if new_record==1
 78.     replace start =  stop if new_record==1
 79.     replace stop = end_date if new_record==1
 80.     drop new_record stop_prior
 81. 
.     di "number where start after stop date"
 82.     count if start > stop 
 83.     di "Number where start equals stop"
 84.     count if start==stop 
 85.     drop if start==stop 
 86.     * Check that time covered by prescriptions equals total follow-up
.     gen time = stop - start 
 87.     sum time, d  
 88.     bys patient_id: egen total_time = total(time)
 89. 
.     gen total_time_unequal = total_time!=total_fu
 90.     tab total_time_unequal, m
 91. 
.     save ./output/time_varying_udca_all_vars_`i'
 92.     * Drop unnecessary variables
.     keep patient_id start stop udca 
 93. 
.     save ./output/time_varying_udca_`i'
 94.     restore
 95. }
  0
(0 observations deleted)
(1000 real changes made)

Duplicates in terms of all variables

(124,370 observations deleted)

  to_expand |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,000       95.42       95.42
          2 |         48        4.58      100.00
------------+-----------------------------------
      Total |      1,048      100.00
(48 observations created)

           |      new_record
 to_expand |         0          1 |     Total
-----------+----------------------+----------
         1 |     1,000          0 |     1,000 
         2 |        48         48 |        96 
-----------+----------------------+----------
     Total |     1,048         48 |     1,096 
(48 real changes made)
(48 real changes made)
(48 real changes made)
  0
  0

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,902
        from master                       994  (_merge==1)
        from using                        908  (_merge==2)

    matched                               102  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |        994       49.60       49.60
         using only (2) |        908       45.31       94.91
            matched (3) |        102        5.09      100.00
------------------------+-----------------------------------
                  Total |      2,004      100.00
(908 real changes made)
(908 real changes made)
(908 real changes made)
(908 real changes made)
(1,498 missing values generated)
(1,500 missing values generated)
(346 real changes made)
(1,327 real changes made)
(0 real changes made)

start_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,004       50.10       50.10
          2 |      1,000       49.90      100.00
------------+-----------------------------------
      Total |      2,004      100.00
(1,000 observations created)

start_afte |      new_record
         r |         0          1 |     Total
-----------+----------------------+----------
         1 |     1,004          0 |     1,004 
         2 |     1,000      1,000 |     2,000 
-----------+----------------------+----------
     Total |     2,004      1,000 |     3,004 
(1,000 real changes made)
(1,000 real changes made)
(1,000 real changes made)

end_date_fl |
         ag |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        327       17.14       17.14
          2 |        344       18.03       35.17
          3 |      1,237       64.83      100.00
------------+-----------------------------------
      Total |      1,908      100.00

  end_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,386       46.14       46.14
          1 |      1,618       53.86      100.00
------------+-----------------------------------
      Total |      3,004      100.00

           |          end_date_flag
 end_after |         1          2          3 |     Total
-----------+---------------------------------+----------
         0 |        29         30      1,327 |     1,386 
         1 |       329        347        942 |     1,618 
-----------+---------------------------------+----------
     Total |       358        377      2,269 |     3,004 

 end_before |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,999       99.83       99.83
          1 |          5        0.17      100.00
------------+-----------------------------------
      Total |      3,004      100.00
(5 observations deleted)

           |       end_after
   yr_stop |         0          1 |     Total
-----------+----------------------+----------
      2020 |     1,014          1 |     1,015 
      2021 |        35          0 |        35 
      2022 |       337        615 |       952 
      2023 |         0        997 |       997 
-----------+----------------------+----------
     Total |     1,386      1,613 |     2,999 

           |       end_after
      last |         0          1 |     Total
-----------+----------------------+----------
         0 |     1,091          0 |     1,091 
         1 |       295      1,613 |     1,908 
-----------+----------------------+----------
     Total |     1,386      1,613 |     2,999 
(1,613 real changes made)

 stop_prior |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,999      100.00      100.00
------------+-----------------------------------
      Total |      2,999      100.00
(0 observations created)

           | new_record
stop_prior |         0 |     Total
-----------+-----------+----------
         1 |     2,999 |     2,999 
-----------+-----------+----------
     Total |     2,999 |     2,999 
(0 real changes made)
(0 real changes made)
(0 real changes made)
number where start after stop date
  0
Number where start equals stop
  0
(0 observations deleted)

                            time
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            2              1
10%            4              1       Obs               2,999
25%           11              1       Sum of Wgt.       2,999

50%          547                      Mean            530.866
                        Largest       Std. Dev.      465.6408
75%         1028           1035
90%         1034           1035       Variance       216821.3
95%         1035           1035       Skewness      -.0338956
99%         1035           1035       Kurtosis       1.150645

total_time_ |
    unequal |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,999      100.00      100.00
------------+-----------------------------------
      Total |      2,999      100.00
file ./output/time_varying_udca_all_vars_60.dta saved
file ./output/time_varying_udca_60.dta saved
  0
(0 observations deleted)
(1000 real changes made)

Duplicates in terms of all variables

(124,416 observations deleted)

  to_expand |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,000       99.80       99.80
          2 |          2        0.20      100.00
------------+-----------------------------------
      Total |      1,002      100.00
(2 observations created)

           |      new_record
 to_expand |         0          1 |     Total
-----------+----------------------+----------
         1 |     1,000          0 |     1,000 
         2 |         2          2 |         4 
-----------+----------------------+----------
     Total |     1,002          2 |     1,004 
(2 real changes made)
(2 real changes made)
(2 real changes made)
  0
  0

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,820
        from master                       912  (_merge==1)
        from using                        908  (_merge==2)

    matched                                92  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |        912       47.70       47.70
         using only (2) |        908       47.49       95.19
            matched (3) |         92        4.81      100.00
------------------------+-----------------------------------
                  Total |      1,912      100.00
(908 real changes made)
(908 real changes made)
(908 real changes made)
(908 real changes made)
(1,412 missing values generated)
(1,412 missing values generated)
(344 real changes made)
(1,241 real changes made)
(0 real changes made)

start_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        912       47.70       47.70
          2 |      1,000       52.30      100.00
------------+-----------------------------------
      Total |      1,912      100.00
(1,000 observations created)

start_afte |      new_record
         r |         0          1 |     Total
-----------+----------------------+----------
         1 |       912          0 |       912 
         2 |     1,000      1,000 |     2,000 
-----------+----------------------+----------
     Total |     1,912      1,000 |     2,912 
(1,000 real changes made)
(1,000 real changes made)
(1,000 real changes made)

end_date_fl |
         ag |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        327       17.14       17.14
          2 |        344       18.03       35.17
          3 |      1,237       64.83      100.00
------------+-----------------------------------
      Total |      1,908      100.00

  end_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,298       44.57       44.57
          1 |      1,614       55.43      100.00
------------+-----------------------------------
      Total |      2,912      100.00

           |          end_date_flag
 end_after |         1          2          3 |     Total
-----------+---------------------------------+----------
         0 |        27         30      1,241 |     1,298 
         1 |       327        345        942 |     1,614 
-----------+---------------------------------+----------
     Total |       354        375      2,183 |     2,912 

 end_before |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,911       99.97       99.97
          1 |          1        0.03      100.00
------------+-----------------------------------
      Total |      2,912      100.00
(1 observation deleted)

           |       end_after
   yr_stop |         0          1 |     Total
-----------+----------------------+----------
      2020 |     1,001          1 |     1,002 
      2022 |       297        613 |       910 
      2023 |         0        999 |       999 
-----------+----------------------+----------
     Total |     1,298      1,613 |     2,911 

           |       end_after
      last |         0          1 |     Total
-----------+----------------------+----------
         0 |     1,003          0 |     1,003 
         1 |       295      1,613 |     1,908 
-----------+----------------------+----------
     Total |     1,298      1,613 |     2,911 
(1,613 real changes made)

 stop_prior |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,911      100.00      100.00
------------+-----------------------------------
      Total |      2,911      100.00
(0 observations created)

           | new_record
stop_prior |         0 |     Total
-----------+-----------+----------
         1 |     2,911 |     2,911 
-----------+-----------+----------
     Total |     2,911 |     2,911 
(0 real changes made)
(0 real changes made)
(0 real changes made)
number where start after stop date
  0
Number where start equals stop
  0
(0 observations deleted)

                            time
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            2              1
10%            4              1       Obs               2,911
25%           11              1       Sum of Wgt.       2,911

50%          629                      Mean           546.9141
                        Largest       Std. Dev.      469.4192
75%         1029           1035
90%         1035           1035       Variance       220354.4
95%         1035           1035       Skewness       -.096805
99%         1035           1035       Kurtosis       1.142544

total_time_ |
    unequal |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,911      100.00      100.00
------------+-----------------------------------
      Total |      2,911      100.00
file ./output/time_varying_udca_all_vars_90.dta saved
file ./output/time_varying_udca_90.dta saved
  0
(0 observations deleted)
(1000 real changes made)

Duplicates in terms of all variables

(124,418 observations deleted)

  to_expand |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
(0 observations created)

           | new_record
 to_expand |         0 |     Total
-----------+-----------+----------
         1 |     1,000 |     1,000 
-----------+-----------+----------
     Total |     1,000 |     1,000 
(0 real changes made)
(0 real changes made)
(0 real changes made)
  0
  0

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,816
        from master                       908  (_merge==1)
        from using                        908  (_merge==2)

    matched                                92  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |        908       47.59       47.59
         using only (2) |        908       47.59       95.18
            matched (3) |         92        4.82      100.00
------------------------+-----------------------------------
                  Total |      1,908      100.00
(908 real changes made)
(908 real changes made)
(908 real changes made)
(908 real changes made)
(1,408 missing values generated)
(1,408 missing values generated)
(344 real changes made)
(1,237 real changes made)
(0 real changes made)

start_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        908       47.59       47.59
          2 |      1,000       52.41      100.00
------------+-----------------------------------
      Total |      1,908      100.00
(1,000 observations created)

start_afte |      new_record
         r |         0          1 |     Total
-----------+----------------------+----------
         1 |       908          0 |       908 
         2 |     1,000      1,000 |     2,000 
-----------+----------------------+----------
     Total |     1,908      1,000 |     2,908 
(1,000 real changes made)
(1,000 real changes made)
(1,000 real changes made)

end_date_fl |
         ag |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        327       17.14       17.14
          2 |        344       18.03       35.17
          3 |      1,237       64.83      100.00
------------+-----------------------------------
      Total |      1,908      100.00

  end_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,294       44.50       44.50
          1 |      1,614       55.50      100.00
------------+-----------------------------------
      Total |      2,908      100.00

           |          end_date_flag
 end_after |         1          2          3 |     Total
-----------+---------------------------------+----------
         0 |        27         30      1,237 |     1,294 
         1 |       327        345        942 |     1,614 
-----------+---------------------------------+----------
     Total |       354        375      2,179 |     2,908 

 end_before |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,907       99.97       99.97
          1 |          1        0.03      100.00
------------+-----------------------------------
      Total |      2,908      100.00
(1 observation deleted)

           |       end_after
   yr_stop |         0          1 |     Total
-----------+----------------------+----------
      2020 |       999          1 |     1,000 
      2022 |       295        613 |       908 
      2023 |         0        999 |       999 
-----------+----------------------+----------
     Total |     1,294      1,613 |     2,907 

           |       end_after
      last |         0          1 |     Total
-----------+----------------------+----------
         0 |       999          0 |       999 
         1 |       295      1,613 |     1,908 
-----------+----------------------+----------
     Total |     1,294      1,613 |     2,907 
(1,613 real changes made)

 stop_prior |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,907      100.00      100.00
------------+-----------------------------------
      Total |      2,907      100.00
(0 observations created)

           | new_record
stop_prior |         0 |     Total
-----------+-----------+----------
         1 |     2,907 |     2,907 
-----------+-----------+----------
     Total |     2,907 |     2,907 
(0 real changes made)
(0 real changes made)
(0 real changes made)
number where start after stop date
  0
Number where start equals stop
  0
(0 observations deleted)

                            time
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            2              1
10%            4              1       Obs               2,907
25%           11              1       Sum of Wgt.       2,907

50%          630                      Mean           547.6667
                        Largest       Std. Dev.      469.4282
75%         1029           1035
90%         1035           1035       Variance       220362.8
95%         1035           1035       Skewness      -.0996857
99%         1035           1035       Kurtosis        1.14321

total_time_ |
    unequal |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,907      100.00      100.00
------------+-----------------------------------
      Total |      2,907      100.00
file ./output/time_varying_udca_all_vars_120.dta saved
file ./output/time_varying_udca_120.dta saved
  0
(0 observations deleted)
(1000 real changes made)

Duplicates in terms of all variables

(124,418 observations deleted)

  to_expand |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
(0 observations created)

           | new_record
 to_expand |         0 |     Total
-----------+-----------+----------
         1 |     1,000 |     1,000 
-----------+-----------+----------
     Total |     1,000 |     1,000 
(0 real changes made)
(0 real changes made)
(0 real changes made)
  0
  0

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,816
        from master                       908  (_merge==1)
        from using                        908  (_merge==2)

    matched                                92  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |        908       47.59       47.59
         using only (2) |        908       47.59       95.18
            matched (3) |         92        4.82      100.00
------------------------+-----------------------------------
                  Total |      1,908      100.00
(908 real changes made)
(908 real changes made)
(908 real changes made)
(908 real changes made)
(1,408 missing values generated)
(1,408 missing values generated)
(344 real changes made)
(1,237 real changes made)
(0 real changes made)

start_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        908       47.59       47.59
          2 |      1,000       52.41      100.00
------------+-----------------------------------
      Total |      1,908      100.00
(1,000 observations created)

start_afte |      new_record
         r |         0          1 |     Total
-----------+----------------------+----------
         1 |       908          0 |       908 
         2 |     1,000      1,000 |     2,000 
-----------+----------------------+----------
     Total |     1,908      1,000 |     2,908 
(1,000 real changes made)
(1,000 real changes made)
(1,000 real changes made)

end_date_fl |
         ag |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        327       17.14       17.14
          2 |        344       18.03       35.17
          3 |      1,237       64.83      100.00
------------+-----------------------------------
      Total |      1,908      100.00

  end_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,294       44.50       44.50
          1 |      1,614       55.50      100.00
------------+-----------------------------------
      Total |      2,908      100.00

           |          end_date_flag
 end_after |         1          2          3 |     Total
-----------+---------------------------------+----------
         0 |        27         30      1,237 |     1,294 
         1 |       327        345        942 |     1,614 
-----------+---------------------------------+----------
     Total |       354        375      2,179 |     2,908 

 end_before |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,907       99.97       99.97
          1 |          1        0.03      100.00
------------+-----------------------------------
      Total |      2,908      100.00
(1 observation deleted)

           |       end_after
   yr_stop |         0          1 |     Total
-----------+----------------------+----------
      2020 |       999          1 |     1,000 
      2022 |       295        613 |       908 
      2023 |         0        999 |       999 
-----------+----------------------+----------
     Total |     1,294      1,613 |     2,907 

           |       end_after
      last |         0          1 |     Total
-----------+----------------------+----------
         0 |       999          0 |       999 
         1 |       295      1,613 |     1,908 
-----------+----------------------+----------
     Total |     1,294      1,613 |     2,907 
(1,613 real changes made)

 stop_prior |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,907      100.00      100.00
------------+-----------------------------------
      Total |      2,907      100.00
(0 observations created)

           | new_record
stop_prior |         0 |     Total
-----------+-----------+----------
         1 |     2,907 |     2,907 
-----------+-----------+----------
     Total |     2,907 |     2,907 
(0 real changes made)
(0 real changes made)
(0 real changes made)
number where start after stop date
  0
Number where start equals stop
  0
(0 observations deleted)

                            time
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            2              1
10%            4              1       Obs               2,907
25%           11              1       Sum of Wgt.       2,907

50%          630                      Mean           547.6667
                        Largest       Std. Dev.      469.4282
75%         1029           1035
90%         1035           1035       Variance       220362.8
95%         1035           1035       Skewness      -.0996857
99%         1035           1035       Kurtosis        1.14321

total_time_ |
    unequal |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,907      100.00      100.00
------------+-----------------------------------
      Total |      2,907      100.00
file ./output/time_varying_udca_all_vars_150.dta saved
file ./output/time_varying_udca_150.dta saved
  0
(0 observations deleted)
(1000 real changes made)

Duplicates in terms of all variables

(124,418 observations deleted)

  to_expand |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
(0 observations created)

           | new_record
 to_expand |         0 |     Total
-----------+-----------+----------
         1 |     1,000 |     1,000 
-----------+-----------+----------
     Total |     1,000 |     1,000 
(0 real changes made)
(0 real changes made)
(0 real changes made)
  0
  0

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,816
        from master                       908  (_merge==1)
        from using                        908  (_merge==2)

    matched                                92  (_merge==3)
    -----------------------------------------

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |        908       47.59       47.59
         using only (2) |        908       47.59       95.18
            matched (3) |         92        4.82      100.00
------------------------+-----------------------------------
                  Total |      1,908      100.00
(908 real changes made)
(908 real changes made)
(908 real changes made)
(908 real changes made)
(1,408 missing values generated)
(1,408 missing values generated)
(344 real changes made)
(1,237 real changes made)
(0 real changes made)

start_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        908       47.59       47.59
          2 |      1,000       52.41      100.00
------------+-----------------------------------
      Total |      1,908      100.00
(1,000 observations created)

start_afte |      new_record
         r |         0          1 |     Total
-----------+----------------------+----------
         1 |       908          0 |       908 
         2 |     1,000      1,000 |     2,000 
-----------+----------------------+----------
     Total |     1,908      1,000 |     2,908 
(1,000 real changes made)
(1,000 real changes made)
(1,000 real changes made)

end_date_fl |
         ag |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        327       17.14       17.14
          2 |        344       18.03       35.17
          3 |      1,237       64.83      100.00
------------+-----------------------------------
      Total |      1,908      100.00

  end_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,294       44.50       44.50
          1 |      1,614       55.50      100.00
------------+-----------------------------------
      Total |      2,908      100.00

           |          end_date_flag
 end_after |         1          2          3 |     Total
-----------+---------------------------------+----------
         0 |        27         30      1,237 |     1,294 
         1 |       327        345        942 |     1,614 
-----------+---------------------------------+----------
     Total |       354        375      2,179 |     2,908 

 end_before |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,907       99.97       99.97
          1 |          1        0.03      100.00
------------+-----------------------------------
      Total |      2,908      100.00
(1 observation deleted)

           |       end_after
   yr_stop |         0          1 |     Total
-----------+----------------------+----------
      2020 |       999          1 |     1,000 
      2022 |       295        613 |       908 
      2023 |         0        999 |       999 
-----------+----------------------+----------
     Total |     1,294      1,613 |     2,907 

           |       end_after
      last |         0          1 |     Total
-----------+----------------------+----------
         0 |       999          0 |       999 
         1 |       295      1,613 |     1,908 
-----------+----------------------+----------
     Total |     1,294      1,613 |     2,907 
(1,613 real changes made)

 stop_prior |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,907      100.00      100.00
------------+-----------------------------------
      Total |      2,907      100.00
(0 observations created)

           | new_record
stop_prior |         0 |     Total
-----------+-----------+----------
         1 |     2,907 |     2,907 
-----------+-----------+----------
     Total |     2,907 |     2,907 
(0 real changes made)
(0 real changes made)
(0 real changes made)
number where start after stop date
  0
Number where start equals stop
  0
(0 observations deleted)

                            time
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            2              1
10%            4              1       Obs               2,907
25%           11              1       Sum of Wgt.       2,907

50%          630                      Mean           547.6667
                        Largest       Std. Dev.      469.4282
75%         1029           1035
90%         1035           1035       Variance       220362.8
95%         1035           1035       Skewness      -.0996857
99%         1035           1035       Kurtosis        1.14321

total_time_ |
    unequal |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,907      100.00      100.00
------------+-----------------------------------
      Total |      2,907      100.00
file ./output/time_varying_udca_all_vars_180.dta saved
file ./output/time_varying_udca_180.dta saved

. 
. * Sensitivity analysis - add on overlapping days to the next unexposed period
>  up to 120 days. 120 exposure only.
. 
. gen stop_date = udcaA + 120

. format stop_date %dD/N/CY 

. 
. * Drop rows where prescriptions ends prior to March 2020
. count if stop_date <= date("01March2020", "DMY")
  0

. drop if stop_date <= date("01March2020", "DMY")
(0 observations deleted)

. 
. * Collapse adjacent prescriptions that are continuous prescribing into one pe
> riod 
. * Flag if start date is greater than assumed stop date of previous prescripti
> on 
. bys patient_id (udcaA): gen spell = udcaA > stop_date[_n-1]

. bys patient_id (udcaA): replace spell = 1 if _n==1
(1000 real changes made)

. * Flag each row associated with each spell 
. bys patient_id (udcaA): gen spell_sum = sum(spell) 

. * Start date of spell 
. bys patient_id spell_sum (udcaA): gen start = udcaA[1] 

. bys patient_id spell_sum (udcaA): gen stop = stop_date[_N] 

. format start stop %dD/N/CY

. * Determine number of overlapping days 
. bys patient_id (udcaA): gen overlap = stop_date - udcaA[_n+1]
(1,000 missing values generated)

. * Set to missing if no overlap
. replace overlap=. if overlap<=0
(0 real changes made)

. bys patient_id spell_sum: egen total_overlap = total(overlap)

. sum total_overlap, d

                        total_overlap
-------------------------------------------------------------
      Percentiles      Smallest
 1%        11829          11332
 5%        12408          11332
10%        12657          11332       Obs             125,418
25%        13262          11332       Sum of Wgt.     125,418

50%        13971                      Mean           13975.36
                        Largest       Std. Dev.      987.8471
75%        14693          17936
90%        15189          17936       Variance       975841.8
95%        15649          17936       Skewness       .1365183
99%        16156          17936       Kurtosis       2.901916

. * Only want to add up to 120 days so create variable cut to 120 days if over 
> 120 days overlap
. gen overlap_add = total_overlap

. replace overlap_add = 120 if total_overlap>120 & total_overlap!=.
(125,418 real changes made)

. keep patient_id start stop udca total_no_presc overlap_add

. duplicates drop 

Duplicates in terms of all variables

(124,418 observations deleted)

. sum overlap_add, d 

                         overlap_add
-------------------------------------------------------------
      Percentiles      Smallest
 1%          120            120
 5%          120            120
10%          120            120       Obs               1,000
25%          120            120       Sum of Wgt.       1,000

50%          120                      Mean                120
                        Largest       Std. Dev.             0
75%          120            120
90%          120            120       Variance              0
95%          120            120       Skewness              .
99%          120            120       Kurtosis              .

. 
. * Add on overlapping days 
. * Generate new stop date with 120 days added
. gen new_stop = stop + overlap_add

. * Update stop date with this date if there is an overlap 
. replace stop = new_stop if overlap_add!=0
(1,000 real changes made)

. * Identify spells where prescriptions overlap and combine rows
. bys patient_id (start): gen spell = start > stop[_n-1]

. bys patient_id (start): replace spell = 1 if _n==1
(1000 real changes made)

. bys patient_id (start): gen spell_sum = sum(spell) 

. sum spell_sum

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   spell_sum |      1,000           1           0          1          1

. * Start date of spell 
. bys patient_id spell_sum (start): gen start_n = start[1] 

. bys patient_id spell_sum (start): gen stop_n = stop[_N] 

. format start_n stop_n %dD/N/CY

. keep patient_id start_n stop_n udca total_no_presc

. rename start_n start 

. rename stop_n stop

. duplicates drop 

Duplicates in terms of all variables

(0 observations are duplicates)

. 
. * Add in rows where there are gaps between prescriptions 
. bys patient_id (start): gen to_expand = 1 + (stop < start[_n+1])*(start[_n+1]
> ~=.)

. tab to_expand 

  to_expand |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00

. expand to_expand 
(0 observations created)

. 
. * Flag new rows
. bys patient_id start: gen new_record = (_n==2)

. tab to_expand new_record 

           | new_record
 to_expand |         0 |     Total
-----------+-----------+----------
         1 |     1,000 |     1,000 
-----------+-----------+----------
     Total |     1,000 |     1,000 

. 
. * Updating new rows 
. sort patient_id start

. replace udca=0 if new_record==1
(0 real changes made)

. replace start = stop if new_record==1
(0 real changes made)

. bys patient_id (start): replace stop = start[_n+1] if new_record==1
(0 real changes made)

. drop new_record to_expand

. 
. * Checks 
. count if stop<start 
  0

. sort patient_id start

. count if stop[_n-1]>start & patient_id==patient_id[_n-1]
  0

. 
. * Update rows to match follow-up time
. * merge variables from original study definition 
. merge m:1 patient_id using `tempfile', keepusing(dereg_date died_date_ons udc
> a_count_bl) 

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,816
        from master                       908  (_merge==1)
        from using                        908  (_merge==2)

    matched                                92  (_merge==3)
    -----------------------------------------

. tab _merge

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |        908       47.59       47.59
         using only (2) |        908       47.59       95.18
            matched (3) |         92        4.82      100.00
------------------------+-----------------------------------
                  Total |      1,908      100.00

. 
. * Update variables for people without any prescriptions 
. replace start = date("01/03/2020", "DMY") if _merge==2
(908 real changes made)

. replace udca = 0 if _merge==2
(908 real changes made)

. replace stop = date("31/12/2022", "DMY") if _merge==2
(908 real changes made)

. replace total_no_presc = 0 if _merge==2
(908 real changes made)

. 
. * Determine end of follow-up date
. gen dereg_dateA = date(dereg_date, "YMD")
(1,408 missing values generated)

. format %dD/N/CY dereg_dateA

. drop dereg_date

. gen died_dateA = date(died_date_ons, "YMD")
(1,408 missing values generated)

. format %dD/N/CY died_dateA

. drop died_date_ons

. gen end_study = date("31/12/2022", "DMY")

. egen end_date = rowmin(dereg_dateA end_study died_dateA)

. * Create flag indicating reason for end of follow-up 
. gen end_date_flag = (end_date==dereg_dateA)

. replace end_date_flag = 2 if end_date==died_dateA
(344 real changes made)

. replace end_date_flag = 3 if end_date==end_study
(1,237 real changes made)

. 
. * Count number of days of follow-up 
. gen total_fu = end_date - date("01/03/2020", "DMY")

. 
. ** Update start and end of follow-up for cohort
. * Identify prescriptions that start prior to March 2020
. gen start_prior = (start < date("01/03/2020", "DMY"))

. replace start = date("01/03/2020", "DMY") if start_prior==1
(0 real changes made)

. 
. * Identify first prescriptions that start after March 2020
. bys patient_id (start): gen start_after = 1 + (start > date("01/03/2020", "DM
> Y") & _n==1)

. tab start_after

start_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        908       47.59       47.59
          2 |      1,000       52.41      100.00
------------+-----------------------------------
      Total |      1,908      100.00

. expand start_after
(1,000 observations created)

. 
. * Flag new rows
. bys patient_id start: gen new_record = (_n==2)

. tab start_after new_record 

start_afte |      new_record
         r |         0          1 |     Total
-----------+----------------------+----------
         1 |       908          0 |       908 
         2 |     1,000      1,000 |     2,000 
-----------+----------------------+----------
     Total |     1,908      1,000 |     2,908 

. 
. * Updating new rows 
. sort patient_id start

. replace udca=0 if new_record==1
(1,000 real changes made)

. replace stop = start if new_record==1
(1,000 real changes made)

. replace start = date("01/03/2020", "DMY") if new_record==1
(1,000 real changes made)

. drop new_record start_after

. 
. tab end_date_flag if start==date("01/03/2020", "DMY"), m 

end_date_fl |
         ag |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        327       17.14       17.14
          2 |        344       18.03       35.17
          3 |      1,237       64.83      100.00
------------+-----------------------------------
      Total |      1,908      100.00

. * Identify rows that end after study end date for person 
. gen end_after = (stop > end_date )

. gen end_before = (start > end_date) 

. 
. tab end_after

  end_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,294       44.50       44.50
          1 |      1,614       55.50      100.00
------------+-----------------------------------
      Total |      2,908      100.00

. tab end_after end_date_flag

           |          end_date_flag
 end_after |         1          2          3 |     Total
-----------+---------------------------------+----------
         0 |        27         30      1,237 |     1,294 
         1 |       327        345        942 |     1,614 
-----------+---------------------------------+----------
     Total |       354        375      2,179 |     2,908 

. tab end_before 

 end_before |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,907       99.97       99.97
          1 |          1        0.03      100.00
------------+-----------------------------------
      Total |      2,908      100.00

. 
. * Drop whole rows that are after end_date 
. drop if end_before 
(1 observation deleted)

. 
. * Check years of stop dates 
. gen yr_stop = year(stop)

. tab yr_stop end_after 

           |       end_after
   yr_stop |         0          1 |     Total
-----------+----------------------+----------
      2020 |       999          1 |     1,000 
      2022 |       295        613 |       908 
      2023 |         0        999 |       999 
-----------+----------------------+----------
     Total |     1,294      1,613 |     2,907 

. 
. * Check those flagged as ending after are last row only 
. bys patient_id (start): gen last = _n==_N

. tab last end_after 

           |       end_after
      last |         0          1 |     Total
-----------+----------------------+----------
         0 |       999          0 |       999 
         1 |       295      1,613 |     1,908 
-----------+----------------------+----------
     Total |     1,294      1,613 |     2,907 

. * Check how many records end after end date - should just be one
. bys patient_id: egen tot_end_after = total(end_after)

. 
. replace stop = end_date if end_after==1 & end_before==0
(1,613 real changes made)

. 
. * Identify prescriptions that end prior to end of follow-up 
. bys patient_id (start): gen stop_prior = 1 + (stop < end_date & _n==_N)

. tab stop_prior

 stop_prior |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      2,907      100.00      100.00
------------+-----------------------------------
      Total |      2,907      100.00

. expand stop_prior
(0 observations created)

. 
. * Flag new rows
. bys patient_id start: gen new_record = (_n==2)

. tab stop_prior new_record 

           | new_record
stop_prior |         0 |     Total
-----------+-----------+----------
         1 |     2,907 |     2,907 
-----------+-----------+----------
     Total |     2,907 |     2,907 

. 
. * Updating new rows 
. sort patient_id start

. replace udca=0 if new_record==1
(0 real changes made)

. replace start =  stop if new_record==1
(0 real changes made)

. replace stop = end_date if new_record==1
(0 real changes made)

. drop new_record stop_prior

. 
. di "number where start after stop date"
number where start after stop date

. count if start > stop 
  0

. di "Number where start equals stop"
Number where start equals stop

. count if start==stop 
  0

. drop if start==stop 
(0 observations deleted)

. * Check that time covered by prescriptions equals total follow-up
. gen time = stop - start 

. sum time, d  

                            time
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            2              1
10%            4              1       Obs               2,907
25%           11              1       Sum of Wgt.       2,907

50%          630                      Mean           547.6667
                        Largest       Std. Dev.      469.4282
75%         1029           1035
90%         1035           1035       Variance       220362.8
95%         1035           1035       Skewness      -.0996857
99%         1035           1035       Kurtosis        1.14321

. bys patient_id: egen total_time = total(time)

. 
. gen total_time_unequal = total_time!=total_fu

. tab total_time_unequal, m

total_time_ |
    unequal |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,907      100.00      100.00
------------+-----------------------------------
      Total |      2,907      100.00

. 
. save ./output/time_varying_udca_overlap_all_vars_120
file ./output/time_varying_udca_overlap_all_vars_120.dta saved

. * Drop unnecessary variables
. keep patient_id start stop udca 

. 
. save ./output/time_varying_udca_overlap_120
file ./output/time_varying_udca_overlap_120.dta saved

. 
. * Sensitivity analysis - March 2021 cohort - vaccinations
. 
. import delimited using ./output/input_vacc.csv, clear 
(109 vars, 1,000 obs)

. save `tempfile', replace 
file /tmp/St00016.000001 saved

. 
. ** First import udca population
. import delimited using ./output/input_addvacc.csv, clear
(336 vars, 1,000 obs)

. 
. describe 

Contains data
  obs:         1,000                          
 vars:           336                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
udca_1          str10   %10s                  
udca_2          str10   %10s                  
udca_3          str10   %10s                  
udca_4          str10   %10s                  
udca_5          str10   %10s                  
udca_6          str10   %10s                  
udca_7          str10   %10s                  
udca_8          str10   %10s                  
udca_9          str10   %10s                  
udca_10         str10   %10s                  
udca_11         str10   %10s                  
udca_12         str10   %10s                  
udca_13         str10   %10s                  
udca_14         str10   %10s                  
udca_15         str10   %10s                  
udca_16         str10   %10s                  
udca_17         str10   %10s                  
udca_18         str10   %10s                  
udca_19         str10   %10s                  
udca_20         str10   %10s                  
udca_21         str10   %10s                  
udca_22         str10   %10s                  
udca_23         str10   %10s                  
udca_24         str10   %10s                  
udca_25         str10   %10s                  
udca_26         str10   %10s                  
udca_27         str10   %10s                  
udca_28         str10   %10s                  
udca_29         str10   %10s                  
udca_30         str10   %10s                  
udca_31         str10   %10s                  
udca_32         str10   %10s                  
udca_33         str10   %10s                  
udca_34         str10   %10s                  
udca_35         str10   %10s                  
udca_36         str10   %10s                  
udca_37         str10   %10s                  
udca_38         str10   %10s                  
udca_39         str10   %10s                  
udca_40         str10   %10s                  
udca_41         str10   %10s                  
udca_42         str10   %10s                  
udca_43         str10   %10s                  
udca_44         str10   %10s                  
udca_45         str10   %10s                  
udca_46         str10   %10s                  
udca_47         str10   %10s                  
udca_48         str10   %10s                  
udca_49         str10   %10s                  
udca_50         str10   %10s                  
udca_51         str10   %10s                  
udca_52         str10   %10s                  
udca_53         str10   %10s                  
udca_54         str10   %10s                  
udca_55         str10   %10s                  
udca_56         str10   %10s                  
udca_57         str10   %10s                  
udca_58         str10   %10s                  
udca_59         str10   %10s                  
udca_60         str10   %10s                  
udca_61         str10   %10s                  
udca_62         str10   %10s                  
udca_63         str10   %10s                  
udca_64         str10   %10s                  
udca_65         str10   %10s                  
udca_66         str10   %10s                  
udca_67         str10   %10s                  
udca_68         str10   %10s                  
udca_69         str10   %10s                  
udca_70         str10   %10s                  
udca_71         str10   %10s                  
udca_72         str10   %10s                  
udca_73         str10   %10s                  
udca_74         str10   %10s                  
udca_75         str10   %10s                  
udca_76         str10   %10s                  
udca_77         str10   %10s                  
udca_78         str10   %10s                  
udca_79         str10   %10s                  
udca_80         str10   %10s                  
udca_81         str10   %10s                  
udca_82         str10   %10s                  
udca_83         str10   %10s                  
udca_84         str10   %10s                  
udca_85         str10   %10s                  
udca_86         str10   %10s                  
udca_87         str10   %10s                  
udca_88         str10   %10s                  
udca_89         str10   %10s                  
udca_90         str10   %10s                  
udca_91         str10   %10s                  
udca_92         str10   %10s                  
udca_93         str10   %10s                  
udca_94         str10   %10s                  
udca_95         str10   %10s                  
udca_96         str10   %10s                  
udca_97         str10   %10s                  
udca_98         str10   %10s                  
udca_99         str10   %10s                  
udca_100        str10   %10s                  
udca_101        str10   %10s                  
udca_102        str10   %10s                  
udca_103        str10   %10s                  
udca_104        str10   %10s                  
udca_105        str10   %10s                  
udca_106        str10   %10s                  
udca_107        str10   %10s                  
udca_108        str10   %10s                  
udca_109        str10   %10s                  
udca_110        str10   %10s                  
udca_111        str10   %10s                  
udca_112        str10   %10s                  
udca_113        str10   %10s                  
udca_114        str10   %10s                  
udca_115        str10   %10s                  
udca_116        str10   %10s                  
udca_117        str10   %10s                  
udca_118        str10   %10s                  
udca_119        str10   %10s                  
udca_120        str10   %10s                  
udca_121        str10   %10s                  
udca_122        str10   %10s                  
udca_123        str10   %10s                  
udca_124        str10   %10s                  
udca_125        str10   %10s                  
udca_126        str10   %10s                  
udca_127        str10   %10s                  
udca_128        str10   %10s                  
udca_129        str10   %10s                  
udca_130        str10   %10s                  
udca_131        str10   %10s                  
udca_132        str10   %10s                  
udca_133        str10   %10s                  
udca_134        str10   %10s                  
udca_135        str10   %10s                  
udca_136        str10   %10s                  
udca_137        str10   %10s                  
udca_138        str10   %10s                  
udca_139        str10   %10s                  
udca_140        str10   %10s                  
udca_141        str10   %10s                  
udca_142        str10   %10s                  
udca_143        str10   %10s                  
udca_144        str10   %10s                  
udca_145        str10   %10s                  
udca_146        str10   %10s                  
udca_147        str10   %10s                  
udca_148        str10   %10s                  
udca_149        str10   %10s                  
udca_150        str10   %10s                  
udca_151        str10   %10s                  
udca_152        str10   %10s                  
udca_153        str10   %10s                  
udca_154        str10   %10s                  
udca_155        str10   %10s                  
udca_156        str10   %10s                  
udca_157        str10   %10s                  
udca_158        str10   %10s                  
udca_159        str10   %10s                  
udca_160        str10   %10s                  
udca_161        str10   %10s                  
udca_162        str10   %10s                  
udca_163        str10   %10s                  
udca_164        str10   %10s                  
udca_165        str10   %10s                  
udca_166        str10   %10s                  
udca_167        str10   %10s                  
udca_168        str10   %10s                  
udca_169        str10   %10s                  
udca_170        str10   %10s                  
udca_171        str10   %10s                  
udca_172        str10   %10s                  
udca_173        str10   %10s                  
udca_174        str10   %10s                  
udca_175        str10   %10s                  
udca_176        str10   %10s                  
udca_177        str10   %10s                  
udca_178        str10   %10s                  
udca_179        str10   %10s                  
udca_180        str10   %10s                  
udca_181        str10   %10s                  
udca_182        str10   %10s                  
udca_183        str10   %10s                  
udca_184        str10   %10s                  
udca_185        str10   %10s                  
udca_186        str10   %10s                  
udca_187        str10   %10s                  
udca_188        str10   %10s                  
udca_189        str10   %10s                  
udca_190        str10   %10s                  
udca_191        str10   %10s                  
udca_192        str10   %10s                  
udca_193        str10   %10s                  
udca_194        str10   %10s                  
udca_195        str10   %10s                  
udca_196        str10   %10s                  
udca_197        str10   %10s                  
udca_198        str10   %10s                  
udca_199        str10   %10s                  
udca_200        str10   %10s                  
udca_201        str10   %10s                  
udca_202        str10   %10s                  
udca_203        str10   %10s                  
udca_204        str10   %10s                  
udca_205        str10   %10s                  
udca_206        str10   %10s                  
udca_207        str10   %10s                  
udca_208        str10   %10s                  
udca_209        str10   %10s                  
udca_210        str10   %10s                  
udca_211        str10   %10s                  
udca_212        str10   %10s                  
udca_213        str10   %10s                  
udca_214        str10   %10s                  
udca_215        str10   %10s                  
udca_216        str10   %10s                  
udca_217        str10   %10s                  
udca_218        str10   %10s                  
udca_219        str10   %10s                  
udca_220        str10   %10s                  
udca_221        str10   %10s                  
udca_222        str10   %10s                  
udca_223        str10   %10s                  
udca_224        str10   %10s                  
udca_225        str10   %10s                  
udca_226        str10   %10s                  
udca_227        str10   %10s                  
udca_228        str10   %10s                  
udca_229        str10   %10s                  
udca_230        str10   %10s                  
udca_231        str10   %10s                  
udca_232        str10   %10s                  
udca_233        str10   %10s                  
udca_234        str10   %10s                  
udca_235        str10   %10s                  
udca_236        str10   %10s                  
udca_237        str10   %10s                  
udca_238        str10   %10s                  
udca_239        str10   %10s                  
udca_240        str10   %10s                  
udca_241        str10   %10s                  
udca_242        str10   %10s                  
udca_243        str10   %10s                  
udca_244        str10   %10s                  
udca_245        str10   %10s                  
udca_246        str10   %10s                  
udca_247        str10   %10s                  
udca_248        str10   %10s                  
udca_249        str10   %10s                  
udca_250        str10   %10s                  
udca_251        str10   %10s                  
udca_252        str10   %10s                  
udca_253        str10   %10s                  
udca_254        str10   %10s                  
udca_255        str10   %10s                  
udca_256        str10   %10s                  
udca_257        str10   %10s                  
udca_258        str10   %10s                  
udca_259        str10   %10s                  
udca_260        str10   %10s                  
udca_261        str10   %10s                  
udca_262        str10   %10s                  
udca_263        str10   %10s                  
udca_264        str10   %10s                  
udca_265        str10   %10s                  
udca_266        str10   %10s                  
udca_267        str10   %10s                  
udca_268        str10   %10s                  
udca_269        str10   %10s                  
udca_270        str10   %10s                  
udca_271        str10   %10s                  
udca_272        str10   %10s                  
udca_273        str10   %10s                  
udca_274        str10   %10s                  
udca_275        str10   %10s                  
udca_276        str10   %10s                  
udca_277        str10   %10s                  
udca_278        str10   %10s                  
udca_279        str10   %10s                  
udca_280        str10   %10s                  
udca_281        str10   %10s                  
udca_282        str10   %10s                  
udca_283        str10   %10s                  
udca_284        str10   %10s                  
udca_285        str10   %10s                  
udca_286        str10   %10s                  
udca_287        str10   %10s                  
udca_288        str10   %10s                  
udca_289        str10   %10s                  
udca_290        str10   %10s                  
udca_291        str10   %10s                  
udca_292        str10   %10s                  
udca_293        str10   %10s                  
udca_294        str10   %10s                  
udca_295        str10   %10s                  
udca_296        str10   %10s                  
udca_297        str10   %10s                  
udca_298        str10   %10s                  
udca_299        str10   %10s                  
udca_300        str10   %10s                  
udca_301        str10   %10s                  
udca_302        str10   %10s                  
udca_303        str10   %10s                  
udca_304        str10   %10s                  
udca_305        str10   %10s                  
udca_306        str10   %10s                  
udca_307        str10   %10s                  
udca_308        str10   %10s                  
udca_309        str10   %10s                  
udca_310        str10   %10s                  
udca_311        str10   %10s                  
udca_312        str10   %10s                  
udca_313        str10   %10s                  
udca_314        str10   %10s                  
udca_315        str10   %10s                  
udca_316        str10   %10s                  
udca_317        str10   %10s                  
udca_318        str10   %10s                  
udca_319        str10   %10s                  
udca_320        str10   %10s                  
udca_321        str10   %10s                  
udca_322        str10   %10s                  
udca_323        str10   %10s                  
udca_324        str10   %10s                  
udca_325        str10   %10s                  
udca_326        str10   %10s                  
udca_327        str10   %10s                  
udca_328        str10   %10s                  
udca_329        str10   %10s                  
udca_330        str10   %10s                  
udca_331        str10   %10s                  
udca_332        str10   %10s                  
udca_333        str10   %10s                  
udca_334        str10   %10s                  
udca_335        str10   %10s                  
patient_id      int     %8.0g                 
-------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. *Some records identified in study_definition_additional 
. *missings report, minimum(12400)
. missings dropvars udca_*, force

Checking missings in udca_1 udca_2 udca_3 udca_4 udca_5 udca_6 udca_7 udca_8
    udca_9 udca_10 udca_11 udca_12 udca_13 udca_14 udca_15 udca_16 udca_17
    udca_18 udca_19 udca_20 udca_21 udca_22 udca_23 udca_24 udca_25 udca_26
    udca_27 udca_28 udca_29 udca_30 udca_31 udca_32 udca_33 udca_34 udca_35
    udca_36 udca_37 udca_38 udca_39 udca_40 udca_41 udca_42 udca_43 udca_44
    udca_45 udca_46 udca_47 udca_48 udca_49 udca_50 udca_51 udca_52 udca_53
    udca_54 udca_55 udca_56 udca_57 udca_58 udca_59 udca_60 udca_61 udca_62
    udca_63 udca_64 udca_65 udca_66 udca_67 udca_68 udca_69 udca_70 udca_71
    udca_72 udca_73 udca_74 udca_75 udca_76 udca_77 udca_78 udca_79 udca_80
    udca_81 udca_82 udca_83 udca_84 udca_85 udca_86 udca_87 udca_88 udca_89
    udca_90 udca_91 udca_92 udca_93 udca_94 udca_95 udca_96 udca_97 udca_98
    udca_99 udca_100 udca_101 udca_102 udca_103 udca_104 udca_105 udca_106
    udca_107 udca_108 udca_109 udca_110 udca_111 udca_112 udca_113 udca_114
    udca_115 udca_116 udca_117 udca_118 udca_119 udca_120 udca_121 udca_122
    udca_123 udca_124 udca_125 udca_126 udca_127 udca_128 udca_129 udca_130
    udca_131 udca_132 udca_133 udca_134 udca_135 udca_136 udca_137 udca_138
    udca_139 udca_140 udca_141 udca_142 udca_143 udca_144 udca_145 udca_146
    udca_147 udca_148 udca_149 udca_150 udca_151 udca_152 udca_153 udca_154
    udca_155 udca_156 udca_157 udca_158 udca_159 udca_160 udca_161 udca_162
    udca_163 udca_164 udca_165 udca_166 udca_167 udca_168 udca_169 udca_170
    udca_171 udca_172 udca_173 udca_174 udca_175 udca_176 udca_177 udca_178
    udca_179 udca_180 udca_181 udca_182 udca_183 udca_184 udca_185 udca_186
    udca_187 udca_188 udca_189 udca_190 udca_191 udca_192 udca_193 udca_194
    udca_195 udca_196 udca_197 udca_198 udca_199 udca_200 udca_201 udca_202
    udca_203 udca_204 udca_205 udca_206 udca_207 udca_208 udca_209 udca_210
    udca_211 udca_212 udca_213 udca_214 udca_215 udca_216 udca_217 udca_218
    udca_219 udca_220 udca_221 udca_222 udca_223 udca_224 udca_225 udca_226
    udca_227 udca_228 udca_229 udca_230 udca_231 udca_232 udca_233 udca_234
    udca_235 udca_236 udca_237 udca_238 udca_239 udca_240 udca_241 udca_242
    udca_243 udca_244 udca_245 udca_246 udca_247 udca_248 udca_249 udca_250
    udca_251 udca_252 udca_253 udca_254 udca_255 udca_256 udca_257 udca_258
    udca_259 udca_260 udca_261 udca_262 udca_263 udca_264 udca_265 udca_266
    udca_267 udca_268 udca_269 udca_270 udca_271 udca_272 udca_273 udca_274
    udca_275 udca_276 udca_277 udca_278 udca_279 udca_280 udca_281 udca_282
    udca_283 udca_284 udca_285 udca_286 udca_287 udca_288 udca_289 udca_290
    udca_291 udca_292 udca_293 udca_294 udca_295 udca_296 udca_297 udca_298
    udca_299 udca_300 udca_301 udca_302 udca_303 udca_304 udca_305 udca_306
    udca_307 udca_308 udca_309 udca_310 udca_311 udca_312 udca_313 udca_314
    udca_315 udca_316 udca_317 udca_318 udca_319 udca_320 udca_321 udca_322
    udca_323 udca_324 udca_325 udca_326 udca_327 udca_328 udca_329 udca_330
    udca_331 udca_332 udca_333 udca_334 udca_335:
1000 observations with missing values

note: no variables qualify

. 
. * Format dates
. * First count number of variables for loop
. describe 

Contains data
  obs:         1,000                          
 vars:           336                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
udca_1          str10   %10s                  
udca_2          str10   %10s                  
udca_3          str10   %10s                  
udca_4          str10   %10s                  
udca_5          str10   %10s                  
udca_6          str10   %10s                  
udca_7          str10   %10s                  
udca_8          str10   %10s                  
udca_9          str10   %10s                  
udca_10         str10   %10s                  
udca_11         str10   %10s                  
udca_12         str10   %10s                  
udca_13         str10   %10s                  
udca_14         str10   %10s                  
udca_15         str10   %10s                  
udca_16         str10   %10s                  
udca_17         str10   %10s                  
udca_18         str10   %10s                  
udca_19         str10   %10s                  
udca_20         str10   %10s                  
udca_21         str10   %10s                  
udca_22         str10   %10s                  
udca_23         str10   %10s                  
udca_24         str10   %10s                  
udca_25         str10   %10s                  
udca_26         str10   %10s                  
udca_27         str10   %10s                  
udca_28         str10   %10s                  
udca_29         str10   %10s                  
udca_30         str10   %10s                  
udca_31         str10   %10s                  
udca_32         str10   %10s                  
udca_33         str10   %10s                  
udca_34         str10   %10s                  
udca_35         str10   %10s                  
udca_36         str10   %10s                  
udca_37         str10   %10s                  
udca_38         str10   %10s                  
udca_39         str10   %10s                  
udca_40         str10   %10s                  
udca_41         str10   %10s                  
udca_42         str10   %10s                  
udca_43         str10   %10s                  
udca_44         str10   %10s                  
udca_45         str10   %10s                  
udca_46         str10   %10s                  
udca_47         str10   %10s                  
udca_48         str10   %10s                  
udca_49         str10   %10s                  
udca_50         str10   %10s                  
udca_51         str10   %10s                  
udca_52         str10   %10s                  
udca_53         str10   %10s                  
udca_54         str10   %10s                  
udca_55         str10   %10s                  
udca_56         str10   %10s                  
udca_57         str10   %10s                  
udca_58         str10   %10s                  
udca_59         str10   %10s                  
udca_60         str10   %10s                  
udca_61         str10   %10s                  
udca_62         str10   %10s                  
udca_63         str10   %10s                  
udca_64         str10   %10s                  
udca_65         str10   %10s                  
udca_66         str10   %10s                  
udca_67         str10   %10s                  
udca_68         str10   %10s                  
udca_69         str10   %10s                  
udca_70         str10   %10s                  
udca_71         str10   %10s                  
udca_72         str10   %10s                  
udca_73         str10   %10s                  
udca_74         str10   %10s                  
udca_75         str10   %10s                  
udca_76         str10   %10s                  
udca_77         str10   %10s                  
udca_78         str10   %10s                  
udca_79         str10   %10s                  
udca_80         str10   %10s                  
udca_81         str10   %10s                  
udca_82         str10   %10s                  
udca_83         str10   %10s                  
udca_84         str10   %10s                  
udca_85         str10   %10s                  
udca_86         str10   %10s                  
udca_87         str10   %10s                  
udca_88         str10   %10s                  
udca_89         str10   %10s                  
udca_90         str10   %10s                  
udca_91         str10   %10s                  
udca_92         str10   %10s                  
udca_93         str10   %10s                  
udca_94         str10   %10s                  
udca_95         str10   %10s                  
udca_96         str10   %10s                  
udca_97         str10   %10s                  
udca_98         str10   %10s                  
udca_99         str10   %10s                  
udca_100        str10   %10s                  
udca_101        str10   %10s                  
udca_102        str10   %10s                  
udca_103        str10   %10s                  
udca_104        str10   %10s                  
udca_105        str10   %10s                  
udca_106        str10   %10s                  
udca_107        str10   %10s                  
udca_108        str10   %10s                  
udca_109        str10   %10s                  
udca_110        str10   %10s                  
udca_111        str10   %10s                  
udca_112        str10   %10s                  
udca_113        str10   %10s                  
udca_114        str10   %10s                  
udca_115        str10   %10s                  
udca_116        str10   %10s                  
udca_117        str10   %10s                  
udca_118        str10   %10s                  
udca_119        str10   %10s                  
udca_120        str10   %10s                  
udca_121        str10   %10s                  
udca_122        str10   %10s                  
udca_123        str10   %10s                  
udca_124        str10   %10s                  
udca_125        str10   %10s                  
udca_126        str10   %10s                  
udca_127        str10   %10s                  
udca_128        str10   %10s                  
udca_129        str10   %10s                  
udca_130        str10   %10s                  
udca_131        str10   %10s                  
udca_132        str10   %10s                  
udca_133        str10   %10s                  
udca_134        str10   %10s                  
udca_135        str10   %10s                  
udca_136        str10   %10s                  
udca_137        str10   %10s                  
udca_138        str10   %10s                  
udca_139        str10   %10s                  
udca_140        str10   %10s                  
udca_141        str10   %10s                  
udca_142        str10   %10s                  
udca_143        str10   %10s                  
udca_144        str10   %10s                  
udca_145        str10   %10s                  
udca_146        str10   %10s                  
udca_147        str10   %10s                  
udca_148        str10   %10s                  
udca_149        str10   %10s                  
udca_150        str10   %10s                  
udca_151        str10   %10s                  
udca_152        str10   %10s                  
udca_153        str10   %10s                  
udca_154        str10   %10s                  
udca_155        str10   %10s                  
udca_156        str10   %10s                  
udca_157        str10   %10s                  
udca_158        str10   %10s                  
udca_159        str10   %10s                  
udca_160        str10   %10s                  
udca_161        str10   %10s                  
udca_162        str10   %10s                  
udca_163        str10   %10s                  
udca_164        str10   %10s                  
udca_165        str10   %10s                  
udca_166        str10   %10s                  
udca_167        str10   %10s                  
udca_168        str10   %10s                  
udca_169        str10   %10s                  
udca_170        str10   %10s                  
udca_171        str10   %10s                  
udca_172        str10   %10s                  
udca_173        str10   %10s                  
udca_174        str10   %10s                  
udca_175        str10   %10s                  
udca_176        str10   %10s                  
udca_177        str10   %10s                  
udca_178        str10   %10s                  
udca_179        str10   %10s                  
udca_180        str10   %10s                  
udca_181        str10   %10s                  
udca_182        str10   %10s                  
udca_183        str10   %10s                  
udca_184        str10   %10s                  
udca_185        str10   %10s                  
udca_186        str10   %10s                  
udca_187        str10   %10s                  
udca_188        str10   %10s                  
udca_189        str10   %10s                  
udca_190        str10   %10s                  
udca_191        str10   %10s                  
udca_192        str10   %10s                  
udca_193        str10   %10s                  
udca_194        str10   %10s                  
udca_195        str10   %10s                  
udca_196        str10   %10s                  
udca_197        str10   %10s                  
udca_198        str10   %10s                  
udca_199        str10   %10s                  
udca_200        str10   %10s                  
udca_201        str10   %10s                  
udca_202        str10   %10s                  
udca_203        str10   %10s                  
udca_204        str10   %10s                  
udca_205        str10   %10s                  
udca_206        str10   %10s                  
udca_207        str10   %10s                  
udca_208        str10   %10s                  
udca_209        str10   %10s                  
udca_210        str10   %10s                  
udca_211        str10   %10s                  
udca_212        str10   %10s                  
udca_213        str10   %10s                  
udca_214        str10   %10s                  
udca_215        str10   %10s                  
udca_216        str10   %10s                  
udca_217        str10   %10s                  
udca_218        str10   %10s                  
udca_219        str10   %10s                  
udca_220        str10   %10s                  
udca_221        str10   %10s                  
udca_222        str10   %10s                  
udca_223        str10   %10s                  
udca_224        str10   %10s                  
udca_225        str10   %10s                  
udca_226        str10   %10s                  
udca_227        str10   %10s                  
udca_228        str10   %10s                  
udca_229        str10   %10s                  
udca_230        str10   %10s                  
udca_231        str10   %10s                  
udca_232        str10   %10s                  
udca_233        str10   %10s                  
udca_234        str10   %10s                  
udca_235        str10   %10s                  
udca_236        str10   %10s                  
udca_237        str10   %10s                  
udca_238        str10   %10s                  
udca_239        str10   %10s                  
udca_240        str10   %10s                  
udca_241        str10   %10s                  
udca_242        str10   %10s                  
udca_243        str10   %10s                  
udca_244        str10   %10s                  
udca_245        str10   %10s                  
udca_246        str10   %10s                  
udca_247        str10   %10s                  
udca_248        str10   %10s                  
udca_249        str10   %10s                  
udca_250        str10   %10s                  
udca_251        str10   %10s                  
udca_252        str10   %10s                  
udca_253        str10   %10s                  
udca_254        str10   %10s                  
udca_255        str10   %10s                  
udca_256        str10   %10s                  
udca_257        str10   %10s                  
udca_258        str10   %10s                  
udca_259        str10   %10s                  
udca_260        str10   %10s                  
udca_261        str10   %10s                  
udca_262        str10   %10s                  
udca_263        str10   %10s                  
udca_264        str10   %10s                  
udca_265        str10   %10s                  
udca_266        str10   %10s                  
udca_267        str10   %10s                  
udca_268        str10   %10s                  
udca_269        str10   %10s                  
udca_270        str10   %10s                  
udca_271        str10   %10s                  
udca_272        str10   %10s                  
udca_273        str10   %10s                  
udca_274        str10   %10s                  
udca_275        str10   %10s                  
udca_276        str10   %10s                  
udca_277        str10   %10s                  
udca_278        str10   %10s                  
udca_279        str10   %10s                  
udca_280        str10   %10s                  
udca_281        str10   %10s                  
udca_282        str10   %10s                  
udca_283        str10   %10s                  
udca_284        str10   %10s                  
udca_285        str10   %10s                  
udca_286        str10   %10s                  
udca_287        str10   %10s                  
udca_288        str10   %10s                  
udca_289        str10   %10s                  
udca_290        str10   %10s                  
udca_291        str10   %10s                  
udca_292        str10   %10s                  
udca_293        str10   %10s                  
udca_294        str10   %10s                  
udca_295        str10   %10s                  
udca_296        str10   %10s                  
udca_297        str10   %10s                  
udca_298        str10   %10s                  
udca_299        str10   %10s                  
udca_300        str10   %10s                  
udca_301        str10   %10s                  
udca_302        str10   %10s                  
udca_303        str10   %10s                  
udca_304        str10   %10s                  
udca_305        str10   %10s                  
udca_306        str10   %10s                  
udca_307        str10   %10s                  
udca_308        str10   %10s                  
udca_309        str10   %10s                  
udca_310        str10   %10s                  
udca_311        str10   %10s                  
udca_312        str10   %10s                  
udca_313        str10   %10s                  
udca_314        str10   %10s                  
udca_315        str10   %10s                  
udca_316        str10   %10s                  
udca_317        str10   %10s                  
udca_318        str10   %10s                  
udca_319        str10   %10s                  
udca_320        str10   %10s                  
udca_321        str10   %10s                  
udca_322        str10   %10s                  
udca_323        str10   %10s                  
udca_324        str10   %10s                  
udca_325        str10   %10s                  
udca_326        str10   %10s                  
udca_327        str10   %10s                  
udca_328        str10   %10s                  
udca_329        str10   %10s                  
udca_330        str10   %10s                  
udca_331        str10   %10s                  
udca_332        str10   %10s                  
udca_333        str10   %10s                  
udca_334        str10   %10s                  
udca_335        str10   %10s                  
patient_id      int     %8.0g                 
-------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

. local var = r(k)-1

. forvalues i=1/`var' {
  2.     gen udcaA`i' = date(udca_`i', "YMD")
  3.     format udcaA`i' %dD/N/CY
  4.     drop udca_`i'
  5. }
(582 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)
(500 missing values generated)

. 
. * Reshape to long format 
. reshape long udcaA, i(patient_id) j(presc_number)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26
>  27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 5
> 2 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 
> 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102
>  103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 
> 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 1
> 41 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 16
> 0 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179
>  180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 
> 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 2
> 18 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 23
> 7 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256
>  257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 
> 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 2
> 95 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 31
> 4 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333
>  334 335)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     1000   ->  335000
Number of variables                 336   ->       3
j variable (335 values)                   ->   presc_number
xij variables:
             udcaA1 udcaA2 ... udcaA335   ->   udcaA
-----------------------------------------------------------------------------

. 
. * Drop rows where there is no prescription
. drop if udcaA==.
(167,582 observations deleted)

. 
. * Check that prescriptions are in order
. gen order_flag = (udcaA<udcaA[_n-1] & patient_id==patient_id[_n-1])

. tab order_flag 

 order_flag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     84,198       50.29       50.29
          1 |     83,220       49.71      100.00
------------+-----------------------------------
      Total |    167,418      100.00

. * Create flag if any out of order prescriptions in the data - should only be 
> in dummy data 
. egen out_of_order = max(order_flag)

. tab out_of_order

out_of_orde |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    167,418      100.00      100.00
------------+-----------------------------------
      Total |    167,418      100.00

. 
. * Sort if out of order - should only apply to dummy data 
. sort patient_id udcaA 

. 
. drop order_flag

. * Check in order
. gen order_flag = (udcaA<udcaA[_n-1] & patient_id==patient_id[_n-1])

. tab order_flag

 order_flag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    167,418      100.00      100.00
------------+-----------------------------------
      Total |    167,418      100.00

. 
. * Identify prescriptions with the same date 
. bys patient_id (udcaA): gen dup_presc = (udcaA==udcaA[_n-1])

. tab dup_presc 

  dup_presc |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    157,230       93.91       93.91
          1 |     10,188        6.09      100.00
------------+-----------------------------------
      Total |    167,418      100.00

. * Drop them 
. drop if dup_presc 
(10,188 observations deleted)

. 
. drop order_flag out_of_order dup_presc presc_number

. 
. * Re-count number of prescriptions 
. gen udca=1

. bys patient_id: egen total_no_presc = total(udca)

. sum total_no_presc, d

                       total_no_presc
-------------------------------------------------------------
      Percentiles      Smallest
 1%          137            131
 5%          143            131
10%          146            131       Obs             157,230
25%          152            131       Sum of Wgt.     157,230

50%          158                      Mean           157.7148
                        Largest       Std. Dev.      8.713652
75%          163            189
90%          169            189       Variance       75.92773
95%          172            189       Skewness      -.0087051
99%          177            189       Kurtosis       3.094056

. 
. * Determine length of time from previous prescription 
. bys patient_id (udcaA): gen time_previous = udcaA - udcaA[_n-1]
(1,000 missing values generated)

. sum time_previous, d 

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs             156,230
25%            3              1       Sum of Wgt.     156,230

50%            6                      Mean           8.309992
                        Largest       Std. Dev.      7.754246
75%           11             84
90%           18             85       Variance       60.12833
95%           24             87       Skewness       1.967824
99%           36             93       Kurtosis       8.709306

. gen year = year(udcaA)

. bys year: sum time_previous, d

-------------------------------------------------------------------------------
-> year = 2020

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              35,604
25%            3              1       Sum of Wgt.      35,604

50%            6                      Mean           8.136473
                        Largest       Std. Dev.      7.557819
75%           11             69
90%           18             69       Variance       57.12063
95%           23             70       Skewness       1.951522
99%           35             79       Kurtosis       8.509898

-------------------------------------------------------------------------------
-> year = 2021

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              43,689
25%            3              1       Sum of Wgt.      43,689

50%            6                      Mean           8.344137
                        Largest       Std. Dev.      7.752717
75%           11             68
90%           19             69       Variance       60.10463
95%           24             74       Skewness       1.918604
99%           36             83       Kurtosis       8.224072

-------------------------------------------------------------------------------
-> year = 2022

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              43,584
25%            3              1       Sum of Wgt.      43,584

50%            6                      Mean           8.377134
                        Largest       Std. Dev.      7.833765
75%           11             84
90%           19             85       Variance       61.36787
95%           24             87       Skewness       2.021169
99%           37             93       Kurtosis       9.360513

-------------------------------------------------------------------------------
-> year = 2023

                        time_previous
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              33,353
25%            3              1       Sum of Wgt.      33,353

50%            6                      Mean           8.362756
                        Largest       Std. Dev.      7.855785
75%           11             73
90%           19             78       Variance       61.71336
95%           24             78       Skewness       1.970746
99%           36             80       Kurtosis       8.607864


. 
. * Drop records in 2023 as this is after end of study
. drop if year==2023
(33,353 observations deleted)

. * assume end date of prescription is 120 days to match primary analysis 
. 
. gen stop_date = udcaA + 120

. format stop_date %dD/N/CY 

. 
. * Drop rows where prescriptions ends prior to March 2020
. count if stop_date <= date("01March2021", "DMY")
  29,322

. drop if stop_date <= date("01March2021", "DMY")
(29,322 observations deleted)

. 
. * Collapse adjacent prescriptions that are continuous prescribing into one pe
> riod 
. * Flag if start date is greater than assumed stop date of previous prescripti
> on 
. bys patient_id (udcaA): gen spell = udcaA > stop_date[_n-1]

. bys patient_id (udcaA): replace spell = 1 if _n==1
(1000 real changes made)

. * Flag each row associated with each spell 
. bys patient_id (udcaA): gen spell_sum = sum(spell) 

. * Start date of spell 
. bys patient_id spell_sum (udcaA): gen start = udcaA[1] 

. bys patient_id spell_sum (udcaA): gen stop = stop_date[_N] 

. format start stop %dD/N/CY

. keep patient_id start stop udca total_no_presc

. duplicates drop 

Duplicates in terms of all variables

(93,555 observations deleted)

. 
. * Add in rows where there are gaps between prescriptions 
. bys patient_id (start): gen to_expand = 1 + (stop < start[_n+1])*(start[_n+1]
> ~=.)

. tab to_expand 

  to_expand |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00

. expand to_expand 
(0 observations created)

. 
. * Flag new rows
. bys patient_id start: gen new_record = (_n==2)

. tab to_expand new_record 

           | new_record
 to_expand |         0 |     Total
-----------+-----------+----------
         1 |     1,000 |     1,000 
-----------+-----------+----------
     Total |     1,000 |     1,000 

. 
. * Updating new rows 
. sort patient_id start

. replace udca=0 if new_record==1
(0 real changes made)

. replace start = stop if new_record==1
(0 real changes made)

. bys patient_id (start): replace stop = start[_n+1] if new_record==1
(0 real changes made)

. drop new_record to_expand

. 
. * Checks 
. count if stop<start 
  0

. sort patient_id start

. count if stop[_n-1]>start & patient_id==patient_id[_n-1]
  0

. 
. * Update rows to match follow-up time
. * merge variables from original study definition 
. merge m:1 patient_id using `tempfile', keepusing(dereg_date died_date_ons udc
> a_count_bl) 

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,796
        from master                       898  (_merge==1)
        from using                        898  (_merge==2)

    matched                               102  (_merge==3)
    -----------------------------------------

. tab _merge

                 _merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |        898       47.31       47.31
         using only (2) |        898       47.31       94.63
            matched (3) |        102        5.37      100.00
------------------------+-----------------------------------
                  Total |      1,898      100.00

. 
. * Update variables for people without any prescriptions 
. replace start = date("01/03/2021", "DMY") if _merge==2
(898 real changes made)

. replace udca = 0 if _merge==2
(898 real changes made)

. replace stop = date("31/12/2022", "DMY") if _merge==2
(898 real changes made)

. replace total_no_presc = 0 if _merge==2
(898 real changes made)

. 
. * Determine end of follow-up date
. gen dereg_dateA = date(dereg_date, "YMD")
(1,398 missing values generated)

. format %dD/N/CY dereg_dateA

. drop dereg_date

. gen died_dateA = date(died_date_ons, "YMD")
(1,542 missing values generated)

. format %dD/N/CY died_dateA

. drop died_date_ons

. gen end_study = date("31/12/2022", "DMY")

. egen end_date = rowmin(dereg_dateA end_study died_dateA)

. * Create flag indicating reason for end of follow-up 
. gen end_date_flag = (end_date==dereg_dateA)

. replace end_date_flag = 2 if end_date==died_dateA
(205 real changes made)

. replace end_date_flag = 3 if end_date==end_study
(1,379 real changes made)

. 
. * Count number of days of follow-up 
. gen total_fu = end_date - date("01/03/2020", "DMY")

. 
. ** Update start and end of follow-up for cohort
. * Identify prescriptions that start prior to March 2020
. gen start_prior = (start < date("01/03/2021", "DMY"))

. replace start = date("01/03/2021", "DMY") if start_prior==1
(1,000 real changes made)

. 
. * Identify first prescriptions that start after March 2021
. bys patient_id (start): gen start_after = 1 + (start > date("01/03/2021", "DM
> Y") & _n==1)

. tab start_after

start_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,898      100.00      100.00
------------+-----------------------------------
      Total |      1,898      100.00

. expand start_after
(0 observations created)

. 
. * Flag new rows
. bys patient_id start: gen new_record = (_n==2)

. tab start_after new_record 

start_afte | new_record
         r |         0 |     Total
-----------+-----------+----------
         1 |     1,898 |     1,898 
-----------+-----------+----------
     Total |     1,898 |     1,898 

. 
. * Updating new rows 
. sort patient_id start

. replace udca=0 if new_record==1
(0 real changes made)

. replace stop = start if new_record==1
(0 real changes made)

. replace start = date("01/03/2021", "DMY") if new_record==1
(0 real changes made)

. drop new_record start_after

. 
. tab end_date_flag if start==date("01/03/2021", "DMY"), m 

end_date_fl |
         ag |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        315       16.60       16.60
          2 |        204       10.75       27.34
          3 |      1,379       72.66      100.00
------------+-----------------------------------
      Total |      1,898      100.00

. * Identify rows that end after study end date for person 
. gen end_after = (stop > end_date )

. gen end_before = (start > end_date) 

. 
. tab end_after

  end_after |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        430       22.66       22.66
          1 |      1,468       77.34      100.00
------------+-----------------------------------
      Total |      1,898      100.00

. tab end_after end_date_flag

           |          end_date_flag
 end_after |         1          2          3 |     Total
-----------+---------------------------------+----------
         0 |         0          0        430 |       430 
         1 |       315        204        949 |     1,468 
-----------+---------------------------------+----------
     Total |       315        204      1,379 |     1,898 

. tab end_before 

 end_before |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,898      100.00      100.00
------------+-----------------------------------
      Total |      1,898      100.00

. 
. * Drop whole rows that are after end_date 
. drop if end_before 
(0 observations deleted)

. 
. * Check years of stop dates 
. gen yr_stop = year(stop)

. tab yr_stop end_after 

           |       end_after
   yr_stop |         0          1 |     Total
-----------+----------------------+----------
      2022 |       430        468 |       898 
      2023 |         0      1,000 |     1,000 
-----------+----------------------+----------
     Total |       430      1,468 |     1,898 

. 
. * Check those flagged as ending after are last row only 
. bys patient_id (start): gen last = _n==_N

. tab last end_after 

           |       end_after
      last |         0          1 |     Total
-----------+----------------------+----------
         1 |       430      1,468 |     1,898 
-----------+----------------------+----------
     Total |       430      1,468 |     1,898 

. * Check how many records end after end date - should just be one
. bys patient_id: egen tot_end_after = total(end_after)

. 
. replace stop = end_date if end_after==1 & end_before==0
(1,468 real changes made)

. 
. * Identify prescriptions that end prior to end of follow-up 
. bys patient_id (start): gen stop_prior = 1 + (stop < end_date & _n==_N)

. tab stop_prior

 stop_prior |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,898      100.00      100.00
------------+-----------------------------------
      Total |      1,898      100.00

. expand stop_prior
(0 observations created)

. 
. * Flag new rows
. bys patient_id start: gen new_record = (_n==2)

. tab stop_prior new_record 

           | new_record
stop_prior |         0 |     Total
-----------+-----------+----------
         1 |     1,898 |     1,898 
-----------+-----------+----------
     Total |     1,898 |     1,898 

. 
. * Updating new rows 
. sort patient_id start

. replace udca=0 if new_record==1
(0 real changes made)

. replace start =  stop if new_record==1
(0 real changes made)

. replace stop = end_date if new_record==1
(0 real changes made)

. drop new_record stop_prior

. 
. di "number where start after stop date"
number where start after stop date

. count if start > stop 
  0

. di "Number where start equals stop"
Number where start equals stop

. count if start==stop 
  0

. drop if start==stop 
(0 observations deleted)

. * Check that time covered by prescriptions equals total follow-up
. gen time = stop - start 

. sum time, d  

                            time
-------------------------------------------------------------
      Percentiles      Smallest
 1%           17              3
 5%           97              3
10%          226              3       Obs               1,898
25%          595              3       Sum of Wgt.       1,898

50%          670                      Mean           572.9099
                        Largest       Std. Dev.      188.3629
75%          670            670
90%          670            670       Variance       35480.57
95%          670            670       Skewness      -1.794941
99%          670            670       Kurtosis       4.798956

. bys patient_id: egen total_time = total(time)

. 
. gen total_time_unequal = total_time!=total_fu

. tab total_time_unequal, m

total_time_ |
    unequal |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,898      100.00      100.00
------------+-----------------------------------
      Total |      1,898      100.00

. 
. save ./output/time_varying_udca_all_vars_vacc
file ./output/time_varying_udca_all_vars_vacc.dta saved

. * Drop unnecessary variables
. keep patient_id start stop udca 

. 
. save ./output/time_varying_udca_vacc
file ./output/time_varying_udca_vacc.dta saved

. 
. 
. 
. 
. 
. 
end of do-file

. . file open output using "/tmp/101_drug_prep.do.CN5O.out", write text replace

. . file write output "success" 

. . file close output

. 
end of do-file


