
. 
. * Open file to write results to 
. file open tablecontent using ./output/tables/cox_models.txt, write text repla
> ce
(note: file ./output/tables/cox_models.txt not found)

. file write tablecontent ("Outcome") _tab ("Exposure status") _tab ("denominat
> or") _tab ("events") _tab ("total_person_mths") _tab ("Rate") _tab ("unadj_hr
> ") _tab ///
> ("unadj_ci") _tab ("unadj_lci") _tab ("unadj_uci")  _tab ("p_adj_hr") _tab ("
> p_adj_ci") _tab ("p_adj_lci") _tab ("p_adj_uci") _tab ("f_adj_hr") _tab ("f_a
> dj_ci") _tab ("f_adj_lci") _tab ("f_adj_uci") _tab  _n

. 
. * Cox models and Schoenfeld residual plots for each outcome
. foreach outcome in died_covid_any hosp_any composite_any {
  2.     use ./output/an_dataset_`outcome', clear 
  3.     * Open file to write results
.     describe
  4.     gen index_date = date("01/03/2020", "DMY")
  5.     stset stop, fail(`outcome'_flag) id(patient_id) enter(index_date) orig
> in(index_date)
  6.     count if `outcome'_flag==1
  7.     if r(N) > 10 {
  8.         sts graph, by(udca) title("`outcome'") graphregion(fcolor(white)) 
> ylabel(.75(.1)1)
  9.         graph export ./output/graphs/km_`outcome'.svg, as(svg) replace
 10.         * Cox model - crude
.         stcox udca, strata(stp) vce(robust)
 11.         estimates save "./output/tempdata/crude_`outcome'", replace 
 12.         eststo model1
 13.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_crude_`outcome'", replace) idstr("crude_`outcome'") 
 14.         estat phtest, detail
 15.         * Plot schoenfeld residuals 
.         estat phtest, plot(udca) ///
>                     graphregion(fcolor(white)) ///
>                     ylabel(, nogrid labsize(small)) ///
>                     xlabel(, labsize(small)) ///
>                     xtitle("Time", size(small)) ///
>                     ytitle("Scaled Schoenfeld Residuals", size(small)) ///
>                     msize(small) ///
>                     mcolor(gs6) ///
>                     msymbol(circle_hollow) ///
>                     scheme(s1mono) ///
>                     title ("`outcome'", position(11) size(medsmall)) ///
>                     name(uni_plot_`outcome') ///
>                     note("")
 16.         * Cox model - age and sex adjusted
.         stcox udca age_tv male, strata(stp) vce(robust)
 17.         estimates save "./output/tempdata/p_adj_model_`outcome'", replace 
 18.         eststo model2
 19.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/p_surv_adj_`outcome'", replace) idstr("adj_`outcome'") 
 20.         estat phtest, detail
 21.         * Cox model - fully adjusted
.         stcox udca age_tv male any_high_risk_condition i.eth_bin i.imd ib2.bm
> i_cat i.smoking severe_disease covid_vacc_first liver_trans, strata(stp) vce(
> robust)
 22.         estimates save "./output/tempdata/adj_model_`outcome'", replace 
 23.         eststo model3
 24.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_adj_`outcome'", replace) idstr("adj_`outcome'") 
 25.         estat phtest, detail
 26.         * Plot Schoenfeld residuals 
.         estat phtest, plot(udca) ///
>                     graphregion(fcolor(white)) ///
>                     ylabel(, nogrid labsize(small)) ///
>                     xlabel(, labsize(small)) ///
>                     xtitle("Time", size(small)) ///
>                     ytitle("Scaled Schoenfeld Residuals", size(small)) ///
>                     msize(small) ///
>                     mcolor(gs6) ///
>                     msymbol(circle_hollow) ///
>                     scheme(s1mono) ///
>                     title ("Adjusted `outcome'", position(11) size(medsmall))
>  ///
>                     name(adj_plot_`outcome') ///
>                     note("")
 27.         graph combine uni_plot_`outcome' adj_plot_`outcome'
 28.         graph export ./output/graphs/schoenplot_`outcome'.svg, as(svg) rep
> lace 
 29.         * Cox model - fully adjusted with binary ethnicity variable 
.         stcox udca age_tv male any_high_risk_condition i.ethnicity i.imd ib2.
> bmi_cat i.smoking severe_disease covid_vacc_first liver_trans, strata(stp) vc
> e(robust)
 30.         * flag single row for each person
.         bys patient_id (start): gen number = _n==_N 
 31.         tab number 
 32.         * Count number unexposed at any time 
.         bys patient_id : egen unexposed_ever = min(udca) 
 33.         tab unexposed_ever if number==1
 34.         safecount if unexposed_ever==0 & number==1
 35.         local denominator = r(N)
 36.         safecount if udca == 0 & `outcome'_flag == 1
 37.         local event = r(N)
 38.         di "no udca events = " `event'
 39.         bysort udca: egen total_follow_up = total(_t) if number==1
 40.         su total_follow_up if udca==0 & number==1
 41.         local person_mth = r(mean)/30
 42.         di `person_mth'
 43.         local rate = 100000*(`event'/`person_mth')
 44.         di `rate'
 45.         if `event'>10 & `event'!=. {
 46.             file write tablecontent  ("`outcome'") _tab ("No UDCA") _tab (
> `denominator') _tab (`event') _tab %10.0f (`person_mth') _tab %3.2f (`rate') 
> _tab
 47.             file write tablecontent ("1.00") _tab _tab ("1.00")  _n
 48.             }
 49.         else {
 50.             file write tablecontent ("`outcome'") _tab ("No UDCA") _tab ("
> redact") _n
 51.             continue
 52.         }
 53.         * Count number exposed at any time 
.         bys patient_id : egen exposed_ever = max(udca) 
 54.         tab exposed_ever if number==1
 55.         qui safecount if exposed_ever==1 & number==1
 56.         local denominator = r(N)
 57.         qui safecount if udca == 1 & `outcome'_flag == 1
 58.         local event = r(N)
 59.         di "udca events = " `event'
 60.         qui su total_follow_up if udca==1 & number==1
 61.         local person_mth = r(mean)/30
 62.         local rate = 100000*(`event'/`person_mth')
 63.         if `event'>10 & `event'!=. {
 64.             file write tablecontent ("`outcome'") _tab ("UDCA") _tab (`den
> ominator') _tab (`event') _tab %10.0f (`person_mth') _tab %3.2f (`rate') _tab
 65.             cap estimates use "./output/tempdata/crude_`outcome'" 
 66.             cap lincom udca, eform
 67.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub)) _ta
> b 
 68.             cap estimates clear
 69.             cap estimates use "./output/tempdata/p_adj_model_`outcome'" 
 70.             cap lincom udca, eform
 71.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub)) _ta
> b 
 72.             cap estimates clear
 73.             cap estimates use "./output/tempdata/adj_model_`outcome'" 
 74.             cap lincom udca, eform
 75.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub)) _ta
> b _n 
 76.             cap estimates clear
 77.         }
 78.         else {
 79.             file write tablecontent  ("`outcome'") _tab ("UDCA") _tab ("re
> dact") _n
 80.             continue
 81.         }
 82.     
. drop total_follow_up
 83.     }
 84. else { 
 85.     file write tablecontent ("`outcome'") _tab ("redact") _n
 86.     continue
 87. }
 88. }

Contains data from ./output/an_dataset_died_covid_any.dta
  obs:         2,595                          
 vars:            20                          14 Sep 2023 14:17
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
stp             str4    %9s                   
imd             byte    %8.0g                 
ethnicity       byte    %8.0g      eth5       
has_pbc         byte    %8.0g                 
oca_bl          byte    %8.0g                 
patient_id      int     %8.0g                 
male            float   %9.0g                 
eth_bin         float   %9.0g      eth_3      
bmi_cat         float   %14.0g     bmi        
smoking         float   %14.0g     smok       
any_high_risk~n float   %9.0g                 
time_vacc_cat   byte    %8.0g                 4 quantiles of time_vacc
start           float   %9.0g                 
stop            float   %9.0g                 
died_covid_an~g byte    %8.0g                 
age_tv          float   %9.0g                 
udca            float   %9.0g                 
liver_trans     float   %9.0g                 
covid_vacc_fi~t float   %9.0g                 
severe_disease  float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: 

                id:  patient_id
     failure event:  died_covid_any_flag != 0 & died_covid_any_flag < .
obs. time interval:  (stop[_n-1], stop]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      2,595  total observations
          0  exclusions
------------------------------------------------------------------------------
      2,595  observations remaining, representing
      1,000  subjects
        165  failures in single-failure-per-subject data
    676,087  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     1,035
  165

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_died_covid_any.svg not found)
(file ./output/graphs/km_died_covid_any.svg written in SVG format)

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -29.709405
Iteration 1:   log pseudolikelihood = -29.431738
Iteration 2:   log pseudolikelihood =  -29.43051
Refining estimates:
Iteration 0:   log pseudolikelihood =  -29.43051

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         284
No. of failures      =           23
Time at risk         =       112288
                                                Wald chi2(1)     =        0.64
Log pseudolikelihood =    -29.43051             Prob > chi2      =      0.4246

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |    .596213   .3861765    -0.80   0.425     .1675193    2.121964
------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/tempdata/crude_died_covid_any.ster saved
file ./output/tempdata/surv_crude_died_covid_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.18547         0.28        1         0.5936
      ------------+---------------------------------------------------
      global test |                      0.28        1         0.5936
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -29.709405
Iteration 1:   log pseudolikelihood = -28.281362
Iteration 2:   log pseudolikelihood = -28.263579
Iteration 3:   log pseudolikelihood = -28.263567
Refining estimates:
Iteration 0:   log pseudolikelihood = -28.263567

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         284
No. of failures      =           23
Time at risk         =       112288
                                                Wald chi2(3)     =        3.04
Log pseudolikelihood =   -28.263567             Prob > chi2      =      0.3855

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   .6280341   .4864481    -0.60   0.548     .1376193    2.866072
      age_tv |   .9784407    .016049    -1.33   0.184     .9474855    1.010407
        male |   1.467337   1.109715     0.51   0.612     .3332613    6.460632
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/p_adj_model_died_covid_any.ster not found)
file ./output/tempdata/p_adj_model_died_covid_any.ster saved
(note: file ./output/tempdata/p_surv_adj_died_covid_any.dta not found)
file ./output/tempdata/p_surv_adj_died_covid_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |      0.23229         0.82        1         0.3664
      age_tv      |     -0.19766         0.40        1         0.5267
      male        |     -0.54639         5.19        1         0.0227
      ------------+---------------------------------------------------
      global test |                      5.50        3         0.1388
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -29.709405
Iteration 1:   log pseudolikelihood = -22.941603
Iteration 2:   log pseudolikelihood = -21.718509
Iteration 3:   log pseudolikelihood = -21.451511
Iteration 4:   log pseudolikelihood =  -21.37357
Iteration 5:   log pseudolikelihood =  -21.34554
Iteration 6:   log pseudolikelihood = -21.335285
Iteration 7:   log pseudolikelihood =  -21.33152
Iteration 8:   log pseudolikelihood = -21.330136
Iteration 9:   log pseudolikelihood = -21.329627
Iteration 10:  log pseudolikelihood =  -21.32944
Iteration 11:  log pseudolikelihood = -21.329371
Iteration 12:  log pseudolikelihood = -21.329346
Iteration 13:  log pseudolikelihood = -21.329337
Iteration 14:  log pseudolikelihood = -21.329333
Iteration 15:  log pseudolikelihood = -21.329332
Iteration 16:  log pseudolikelihood = -21.329331
Iteration 17:  log pseudolikelihood = -21.329331
Iteration 18:  log pseudolikelihood = -21.329331
Iteration 19:  log pseudolikelihood = -21.329331
Iteration 20:  log pseudolikelihood = -21.329331
Iteration 21:  log pseudolikelihood = -21.329331
Iteration 22:  log pseudolikelihood = -21.329331
Iteration 23:  log pseudolikelihood = -21.329331
Iteration 24:  log pseudolikelihood = -21.329331
Iteration 25:  log pseudolikelihood = -21.329331
Iteration 26:  log pseudolikelihood = -21.329331
Iteration 27:  log pseudolikelihood = -21.329331
Iteration 28:  log pseudolikelihood = -21.329331
Iteration 29:  log pseudolikelihood = -21.329331
Iteration 30:  log pseudolikelihood = -21.329331
Iteration 31:  log pseudolikelihood = -21.329331
Iteration 32:  log pseudolikelihood = -21.329331
Iteration 33:  log pseudolikelihood = -21.329331
Iteration 34:  log pseudolikelihood = -21.329331
Iteration 35:  log pseudolikelihood = -21.329331
Iteration 36:  log pseudolikelihood = -21.329331
Iteration 37:  log pseudolikelihood = -21.329331
Iteration 38:  log pseudolikelihood = -21.329331
Iteration 39:  log pseudolikelihood = -21.329331
Iteration 40:  log pseudolikelihood = -21.329331
Iteration 41:  log pseudolikelihood = -21.329331
Iteration 42:  log pseudolikelihood = -21.329331
Iteration 43:  log pseudolikelihood = -21.329331
Iteration 44:  log pseudolikelihood = -21.329331
Refining estimates:
Iteration 0:   log pseudolikelihood = -21.329331

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         284
No. of failures      =           23
Time at risk         =       112288
                                                Wald chi2(14)    =       23.36
Log pseudolikelihood =   -21.329331             Prob > chi2      =      0.0547

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   .8930107   .9692747    -0.10   0.917     .1064049    7.494655
      age_tv |   .9700092   .0254545    -1.16   0.246     .9213805    1.021204
        male |    .828919   .8352533    -0.19   0.852     .1150286    5.973353
any_high_r~n |          1  (omitted)
             |
     eth_bin |
  Non-White  |   .2249918   .2256772    -1.49   0.137     .0315045    1.606798
    Unknown  |   1.06e-20          .        .       .            .           .
             |
         imd |
          2  |   .7729258   1.322044    -0.15   0.880     .0270525    22.08351
          3  |   1.52e-20          .        .       .            .           .
          4  |   .4533518   .7006484    -0.51   0.609     .0219238     9.37464
          5  |   .6100581   .9270999    -0.33   0.745     .0310318    11.99319
          6  |   1.19e-19          .        .       .            .           .
             |
     bmi_cat |
Underweight  |   3.974057   5.311194     1.03   0.302     .2894889    54.55523
 Overweight  |   3.215082   3.101468     1.21   0.226     .4853665    21.29679
      Obese  |   .4124086     .32172    -1.14   0.256     .0893934    1.902611
Morbidly ..  |   9.71e-20          .        .       .            .           .
             |
     smoking |
Current s..  |   .7245129    .704595    -0.33   0.740     .1077073    4.873567
  Ex-smoker  |    1.80838     2.6463     0.40   0.686      .102726    31.83456
             |
severe_dis~e |   6.423814   8.532871     1.40   0.161     .4754733      86.788
covid_vacc~t |   .2537282    .562184    -0.62   0.536     .0032989     19.5151
 liver_trans |   2.15e-19          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/adj_model_died_covid_any.ster not found)
file ./output/tempdata/adj_model_died_covid_any.ster saved
(note: file ./output/tempdata/surv_adj_died_covid_any.dta not found)
file ./output/tempdata/surv_adj_died_covid_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.14669         2.34        1         0.1264
      age_tv      |      0.03268         0.06        1         0.8031
      male        |      0.07576         0.49        1         0.4847
      o.any_high~n|            .            .        1             .
      0b.eth_bin  |            .            .        1             .
      1.eth_bin   |      0.01125         0.01        1         0.9398
      2.eth_bin   |            .            .        1             .
      1b.imd      |            .            .        1             .
      2.imd       |      0.30130         9.41        1         0.0022
      3.imd       |            .            .        1             .
      4.imd       |      0.30866         8.88        1         0.0029
      5.imd       |      0.29275         7.07        1         0.0078
      6.imd       |            .            .        1             .
      1.bmi_cat   |      0.15166         2.20        1         0.1380
      2b.bmi_cat  |            .            .        1             .
      3.bmi_cat   |      0.05491         0.13        1         0.7171
      4.bmi_cat   |      0.00763         0.00        1         0.9750
      5.bmi_cat   |            .            .        1             .
      0b.smoking  |            .            .        1             .
      1.smoking   |     -0.06877         0.12        1         0.7324
      2.smoking   |     -0.30322         6.52        1         0.0106
      severe_dis~e|      0.16178         3.15        1         0.0759
      covid_vacc~t|      0.11960         2.14        1         0.1437
      liver_trans |            .            .        1             .
      ------------+---------------------------------------------------
      global test |                     17.77       14         0.2172
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.
(note: file ./output/graphs/schoenplot_died_covid_any.svg not found)
(file ./output/graphs/schoenplot_died_covid_any.svg written in SVG format)

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -29.709405
Iteration 1:   log pseudolikelihood = -20.803884
Iteration 2:   log pseudolikelihood = -17.571146
Iteration 3:   log pseudolikelihood = -15.891165
Iteration 4:   log pseudolikelihood = -15.444157
Iteration 5:   log pseudolikelihood = -15.357863
Iteration 6:   log pseudolikelihood =  -15.33638
Iteration 7:   log pseudolikelihood = -15.328664
Iteration 8:   log pseudolikelihood = -15.325832
Iteration 9:   log pseudolikelihood = -15.324792
Iteration 10:  log pseudolikelihood = -15.324409
Iteration 11:  log pseudolikelihood = -15.324268
Iteration 12:  log pseudolikelihood = -15.324216
Iteration 13:  log pseudolikelihood = -15.324197
Iteration 14:  log pseudolikelihood =  -15.32419
Iteration 15:  log pseudolikelihood = -15.324188
Iteration 16:  log pseudolikelihood = -15.324187
Iteration 17:  log pseudolikelihood = -15.324186
Iteration 18:  log pseudolikelihood = -15.324186
Iteration 19:  log pseudolikelihood = -15.324186
Iteration 20:  log pseudolikelihood = -15.324186
Iteration 21:  log pseudolikelihood = -15.324186
Iteration 22:  log pseudolikelihood = -15.324186
Iteration 23:  log pseudolikelihood = -15.324186
Iteration 24:  log pseudolikelihood = -15.324186
Iteration 25:  log pseudolikelihood = -15.324186
Iteration 26:  log pseudolikelihood = -15.324186
Iteration 27:  log pseudolikelihood = -15.324186
Iteration 28:  log pseudolikelihood = -15.324186
Iteration 29:  log pseudolikelihood = -15.324186
Iteration 30:  log pseudolikelihood = -15.324186
Iteration 31:  log pseudolikelihood = -15.324186
Iteration 32:  log pseudolikelihood = -15.324186
Iteration 33:  log pseudolikelihood = -15.324186
Iteration 34:  log pseudolikelihood = -15.324186
Iteration 35:  log pseudolikelihood = -15.324186
Iteration 36:  log pseudolikelihood = -15.324186
Iteration 37:  log pseudolikelihood = -15.324186
Iteration 38:  log pseudolikelihood = -15.324186
Iteration 39:  log pseudolikelihood = -15.324186
Iteration 40:  log pseudolikelihood = -15.324186
Iteration 41:  log pseudolikelihood = -15.324186
Iteration 42:  log pseudolikelihood = -15.324186
Iteration 43:  log pseudolikelihood = -15.324186
Iteration 44:  log pseudolikelihood = -15.324186
Iteration 45:  log pseudolikelihood = -15.324186
Refining estimates:
Iteration 0:   log pseudolikelihood = -15.324186

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         284
No. of failures      =           23
Time at risk         =       112288
                                                Wald chi2(16)    =       53.62
Log pseudolikelihood =   -15.324186             Prob > chi2      =      0.0000

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |    .223964   .2390797    -1.40   0.161     .0276393      1.8148
      age_tv |    .944233   .0483892    -1.12   0.263     .8539993    1.044001
        male |   2.695146   2.143734     1.25   0.213     .5669331    12.81246
any_high_r~n |          1  (omitted)
             |
   ethnicity |
      Mixed  |   .0306302   .0832882    -1.28   0.200     .0001485    6.319711
      Asian  |   1.110581   2.078841     0.06   0.955     .0283289    43.53833
      Black  |   1.27e-23          .        .       .            .           .
      Other  |   .0205438   .0850928    -0.94   0.348     6.12e-06    68.92457
    Unknown  |   9.47e-24          .        .       .            .           .
             |
         imd |
          2  |   4.203149   13.92066     0.43   0.665     .0063743    2771.528
          3  |   9.47e-21          .        .       .            .           .
          4  |    .634874    1.14494    -0.25   0.801     .0185191    21.76481
          5  |   .1859086   .4831469    -0.65   0.517     .0011407     30.2996
          6  |   1.40e-19          .        .       .            .           .
             |
     bmi_cat |
Underweight  |   59.53624   301.9656     0.81   0.420     .0028676     1236072
 Overweight  |   18.89378   39.51929     1.41   0.160     .3132547    1139.567
      Obese  |    .086205   .1391953    -1.52   0.129       .00364    2.041592
Morbidly ..  |   9.29e-21          .        .       .            .           .
             |
     smoking |
Current s..  |   .2050282   .2495204    -1.30   0.193     .0188754    2.227053
  Ex-smoker  |   73.56772   211.1718     1.50   0.134     .2650716    20417.92
             |
severe_dis~e |   25.76503   77.68349     1.08   0.281     .0699189     9494.38
covid_vacc~t |   .2075674   .7165323    -0.46   0.649     .0002392    180.1136
 liver_trans |   6.69e-20          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp

     number |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,595       61.46       61.46
          1 |      1,000       38.54      100.00
------------+-----------------------------------
      Total |      2,595      100.00
(1868 missing values generated)

unexposed_e |
        ver |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        198      100.00      100.00
------------+-----------------------------------
      Total |        198      100.00
  198
  7
no udca events = 7
(1595 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
total_foll~p |         60       30138           0      30138      30138
1004.6
696.79474

Contains data from ./output/an_dataset_hosp_any.dta
  obs:         2,535                          
 vars:            21                          14 Sep 2023 14:17
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
stp             str4    %9s                   
imd             byte    %8.0g                 
ethnicity       byte    %8.0g      eth5       
has_pbc         byte    %8.0g                 
oca_bl          byte    %8.0g                 
patient_id      int     %8.0g                 
male            float   %9.0g                 
eth_bin         float   %9.0g      eth_3      
bmi_cat         float   %14.0g     bmi        
smoking         float   %14.0g     smok       
any_high_risk~n float   %9.0g                 
time_vacc_cat   byte    %8.0g                 4 quantiles of time_vacc
start           float   %9.0g                 
stop            float   %9.0g                 
hosp_any_flag   float   %9.0g                 
age_tv          float   %9.0g                 
udca            float   %9.0g                 
liver_trans     float   %9.0g                 
covid_vacc_fi~t float   %9.0g                 
severe_disease  float   %9.0g                 
total_hosp      float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: 

                id:  patient_id
     failure event:  hosp_any_flag != 0 & hosp_any_flag < .
obs. time interval:  (stop[_n-1], stop]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      2,535  total observations
          0  exclusions
------------------------------------------------------------------------------
      2,535  observations remaining, representing
      1,000  subjects
         57  failures in single-failure-per-subject data
    652,131  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     1,035
  57

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_hosp_any.svg not found)
(file ./output/graphs/km_hosp_any.svg written in SVG format)

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -8.9146261
Iteration 1:   log pseudolikelihood = -8.0075123
Iteration 2:   log pseudolikelihood = -7.7974571
Iteration 3:   log pseudolikelihood = -7.7278485
Iteration 4:   log pseudolikelihood = -7.7031091
Iteration 5:   log pseudolikelihood = -7.6941187
Iteration 6:   log pseudolikelihood =  -7.690826
Iteration 7:   log pseudolikelihood = -7.6896167
Iteration 8:   log pseudolikelihood =  -7.689172
Iteration 9:   log pseudolikelihood = -7.6890085
Iteration 10:  log pseudolikelihood = -7.6889483
Iteration 11:  log pseudolikelihood = -7.6889262
Iteration 12:  log pseudolikelihood = -7.6889181
Iteration 13:  log pseudolikelihood = -7.6889151
Iteration 14:  log pseudolikelihood =  -7.688914
Iteration 15:  log pseudolikelihood = -7.6889136
Iteration 16:  log pseudolikelihood = -7.6889134
Iteration 17:  log pseudolikelihood = -7.6889134
Iteration 18:  log pseudolikelihood = -7.6889133
Iteration 19:  log pseudolikelihood = -7.6889133
Iteration 20:  log pseudolikelihood = -7.6889133
Iteration 21:  log pseudolikelihood = -7.6889133
Iteration 22:  log pseudolikelihood = -7.6889133
Iteration 23:  log pseudolikelihood = -7.6889133
Iteration 24:  log pseudolikelihood = -7.6889133
Iteration 25:  log pseudolikelihood = -7.6889133
Iteration 26:  log pseudolikelihood = -7.6889133
Iteration 27:  log pseudolikelihood = -7.6889133
Iteration 28:  log pseudolikelihood = -7.6889133
Iteration 29:  log pseudolikelihood = -7.6889133
Iteration 30:  log pseudolikelihood = -7.6889133
Iteration 31:  log pseudolikelihood = -7.6889133
Iteration 32:  log pseudolikelihood = -7.6889133
Iteration 33:  log pseudolikelihood = -7.6889133
Iteration 34:  log pseudolikelihood = -7.6889133
Iteration 35:  log pseudolikelihood = -7.6889133
Refining estimates:
Iteration 0:   log pseudolikelihood = -7.6889133
Iteration 1:   log pseudolikelihood = -7.6889133

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         280
No. of failures      =            9
Time at risk         =       110140
                                                Wald chi2(1)     =     1235.76
Log pseudolikelihood =   -7.6889133             Prob > chi2      =      0.0000

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   8.47e+15   8.84e+15    35.15   0.000     1.10e+15    6.54e+16
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/crude_hosp_any.ster not found)
file ./output/tempdata/crude_hosp_any.ster saved
(note: file ./output/tempdata/surv_crude_hosp_any.dta not found)
file ./output/tempdata/surv_crude_hosp_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |            .         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                      0.00        1         1.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -8.9146261
Iteration 1:   log pseudolikelihood = -5.9707226
Iteration 2:   log pseudolikelihood = -5.5651532
Iteration 3:   log pseudolikelihood = -5.4222889
Iteration 4:   log pseudolikelihood = -5.3697281
Iteration 5:   log pseudolikelihood = -5.3504089
Iteration 6:   log pseudolikelihood = -5.3433042
Iteration 7:   log pseudolikelihood = -5.3406908
Iteration 8:   log pseudolikelihood = -5.3397295
Iteration 9:   log pseudolikelihood = -5.3393758
Iteration 10:  log pseudolikelihood = -5.3392457
Iteration 11:  log pseudolikelihood = -5.3391979
Iteration 12:  log pseudolikelihood = -5.3391803
Iteration 13:  log pseudolikelihood = -5.3391738
Iteration 14:  log pseudolikelihood = -5.3391714
Iteration 15:  log pseudolikelihood = -5.3391705
Iteration 16:  log pseudolikelihood = -5.3391702
Iteration 17:  log pseudolikelihood = -5.3391701
Iteration 18:  log pseudolikelihood =   -5.33917
Iteration 19:  log pseudolikelihood =   -5.33917
Iteration 20:  log pseudolikelihood =   -5.33917
Iteration 21:  log pseudolikelihood =   -5.33917
Iteration 22:  log pseudolikelihood =   -5.33917
Iteration 23:  log pseudolikelihood =   -5.33917
Iteration 24:  log pseudolikelihood =   -5.33917
Iteration 25:  log pseudolikelihood =   -5.33917
Iteration 26:  log pseudolikelihood =   -5.33917
Iteration 27:  log pseudolikelihood =   -5.33917
Iteration 28:  log pseudolikelihood =   -5.33917
Iteration 29:  log pseudolikelihood =   -5.33917
Iteration 30:  log pseudolikelihood =   -5.33917
Iteration 31:  log pseudolikelihood =   -5.33917
Iteration 32:  log pseudolikelihood =   -5.33917
Iteration 33:  log pseudolikelihood =   -5.33917
Iteration 34:  log pseudolikelihood =   -5.33917
Iteration 35:  log pseudolikelihood =   -5.33917
Iteration 36:  log pseudolikelihood =   -5.33917
Refining estimates:
Iteration 0:   log pseudolikelihood =   -5.33917
Iteration 1:   log pseudolikelihood =   -5.33917

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         280
No. of failures      =            9
Time at risk         =       110140
                                                Wald chi2(1)     =        0.06
Log pseudolikelihood =     -5.33917             Prob > chi2      =      0.8129

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   1.72e+16          .        .       .            .           .
      age_tv |   .9964664   .0149012    -0.24   0.813     .9676844    1.026104
        male |   1.75e+16          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/p_adj_model_hosp_any.ster not found)
file ./output/tempdata/p_adj_model_hosp_any.ster saved
(note: file ./output/tempdata/p_surv_adj_hosp_any.dta not found)
file ./output/tempdata/p_surv_adj_hosp_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |      0.76071            .        1             .
      age_tv      |     -0.76071         0.03        1         0.8703
      male        |            .            .        1             .
      ------------+---------------------------------------------------
      global test |                      0.03        1         0.8703
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -8.9146261
Iteration 1:   log pseudolikelihood = -2.5004453
Iteration 2:   log pseudolikelihood =  -.2415051
Iteration 3:   log pseudolikelihood = -.07967721
Iteration 4:   log pseudolikelihood = -.02839524
Iteration 5:   log pseudolikelihood = -.01033671
Iteration 6:   log pseudolikelihood = -.00378901
Iteration 7:   log pseudolikelihood = -.00139225
Iteration 8:   log pseudolikelihood = -.00051204
Iteration 9:   log pseudolikelihood =  -.0001884
Iteration 10:  log pseudolikelihood = -.00006985
Iteration 11:  log pseudolikelihood = -.00002605
Iteration 12:  log pseudolikelihood = -9.400e-06
Iteration 13:  log pseudolikelihood = -9.291e-06
Iteration 14:  log pseudolikelihood = -5.570e-06
Iteration 15:  log pseudolikelihood = -4.576e-06
Iteration 16:  log pseudolikelihood = -3.801e-06
Iteration 17:  log pseudolikelihood = -2.442e-06
Iteration 18:  log pseudolikelihood = -2.330e-06
Iteration 19:  log pseudolikelihood =  .00058118
Iteration 20:  log pseudolikelihood =  .00065227
Iteration 21:  log pseudolikelihood =  .00095292
Iteration 22:  log pseudolikelihood =  .00048835  (backed up)
Iteration 23:  log pseudolikelihood =  .00094099  (backed up)
Iteration 24:  log pseudolikelihood =  .00082014  (backed up)
Refining estimates:
Iteration 0:   log pseudolikelihood = -2.243e-06
Iteration 1:   log pseudolikelihood = -8.253e-07
Iteration 2:   log pseudolikelihood = -3.036e-07
Iteration 3:   log pseudolikelihood = -1.117e-07
Iteration 4:   log pseudolikelihood = -4.109e-08
Iteration 5:   log pseudolikelihood = -1.512e-08
Iteration 6:   log pseudolikelihood = -5.561e-09
Iteration 7:   log pseudolikelihood = -2.046e-09
Iteration 8:   log pseudolikelihood = -7.531e-10
Iteration 9:   log pseudolikelihood = -2.737e-10
Iteration 10:  log pseudolikelihood = -1.160e-10
Iteration 11:  log pseudolikelihood = -1.121e-10
Iteration 12:  log pseudolikelihood = -2.699e-11
Iteration 13:  log pseudolikelihood =  2.996e-11
Iteration 14:  log pseudolikelihood =  3.442e-11
Iteration 15:  log pseudolikelihood =  3.556e-11
Iteration 16:  log pseudolikelihood = -3.832e-11  (backed up)

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         280
No. of failures      =            9
Time at risk         =       110140
                                                Wald chi2(13)    =    4.07e+07
Log pseudolikelihood =   -3.832e-11             Prob > chi2      =      0.0000

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |    6824.82          .        .       .            .           .
      age_tv |   1.020482   .0026245     7.88   0.000     1.015351    1.025639
        male |   4.91e+21          .        .       .            .           .
any_high_r~n |          1  (omitted)
             |
     eth_bin |
  Non-White  |   .0000917          .        .       .            .           .
    Unknown  |   4.74e+29   4.19e+28   772.95   0.000     3.98e+29    5.63e+29
             |
         imd |
          2  |   1.61e+14          .        .       .            .           .
          3  |   .0000604    .000051   -11.51   0.000     .0000116    .0003158
          4  |   37622.92   33703.42    11.76   0.000      6500.22    217759.5
          5  |   1.299377   1.235387     0.28   0.783     .2015822    8.375639
          6  |   5.73e-14   4.33e-14   -40.32   0.000     1.30e-14    2.52e-13
             |
     bmi_cat |
Underweight  |    1477.69   572.7842    18.83   0.000     691.2572    3158.837
 Overweight  |   1.14e-17   1.72e-17   -25.83   0.000     5.91e-19    2.20e-16
      Obese  |   .0000383   .0000265   -14.70   0.000     9.88e-06    .0001487
Morbidly ..  |    213.017   248.9585     4.59   0.000     21.55722    2104.921
             |
     smoking |
Current s..  |   6.32e-09   3.66e-09   -32.56   0.000     2.03e-09    1.97e-08
  Ex-smoker  |   6.47e-09          .        .       .            .           .
             |
severe_dis~e |   5.97e-10   2.66e-10   -47.72   0.000     2.50e-10    1.43e-09
covid_vacc~t |   1.52e-15   1.86e-15   -27.80   0.000     1.37e-16    1.68e-14
 liver_trans |   2.60e+28   3.12e+28    54.47   0.000     2.47e+27    2.73e+29
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/adj_model_hosp_any.ster not found)
file ./output/tempdata/adj_model_hosp_any.ster saved
(note: file ./output/tempdata/surv_adj_hosp_any.dta not found)
file ./output/tempdata/surv_adj_hosp_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |            .            .        1             .
      age_tv      |            .         0.00        1         1.0000
      male        |            .            .        1             .
      o.any_high~n|            .            .        1             .
      0b.eth_bin  |            .            .        1             .
      1.eth_bin   |            .            .        1             .
      2.eth_bin   |            .         0.00        1         1.0000
      1b.imd      |            .            .        1             .
      2.imd       |            .            .        1             .
      3.imd       |     -0.55975         0.00        1         0.9990
      4.imd       |            .         0.00        1         1.0000
      5.imd       |            .         0.00        1         1.0000
      6.imd       |     -0.55975         0.00        1         0.9999
      1.bmi_cat   |            .         0.00        1         1.0000
      2b.bmi_cat  |            .            .        1             .
      3.bmi_cat   |            .         0.00        1         1.0000
      4.bmi_cat   |            .         0.00        1         1.0000
      5.bmi_cat   |     -0.55975         0.00        1         0.9997
      0b.smoking  |            .            .        1             .
      1.smoking   |            .         0.00        1         1.0000
      2.smoking   |            .            .        1             .
      severe_dis~e|            .         0.00        1         1.0000
      covid_vacc~t|            .         0.00        1         1.0000
      liver_trans |            .         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                      0.00       13         1.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.
(note: file ./output/graphs/schoenplot_hosp_any.svg not found)
(file ./output/graphs/schoenplot_hosp_any.svg written in SVG format)

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -8.9146261
Iteration 1:   log pseudolikelihood = -.58385515
Iteration 2:   log pseudolikelihood = -.13526608
Iteration 3:   log pseudolikelihood = -.04622689
Iteration 4:   log pseudolikelihood =  -.0166274
Iteration 5:   log pseudolikelihood = -.00607164
Iteration 6:   log pseudolikelihood = -.00222827
Iteration 7:   log pseudolikelihood = -.00081915
Iteration 8:   log pseudolikelihood =  -.0003013
Iteration 9:   log pseudolikelihood = -.00011084
Iteration 10:  log pseudolikelihood = -.00004078
Iteration 11:  log pseudolikelihood = -.00001506
Iteration 12:  log pseudolikelihood = -.00001427
Iteration 13:  log pseudolikelihood =  .00099489
Iteration 14:  log pseudolikelihood =  .00149094
Iteration 15:  log pseudolikelihood =  .00251426
Iteration 16:  log pseudolikelihood =  .00687322
Iteration 17:  log pseudolikelihood =  .01515429
Iteration 18:  log pseudolikelihood =  .02107181
Iteration 19:  log pseudolikelihood =  .62151458
Iteration 20:  log pseudolikelihood =   .9133991
Iteration 21:  log pseudolikelihood =  1.0880678
flat region resulting in a missing likelihood
r(430);

end of do-file
r(430);

end of do-file

r(430);


