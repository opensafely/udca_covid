
. 
. * Open file to write results to 
. file open tablecontent using ./output/tables/cox_models.txt, write text repla
> ce
(note: file ./output/tables/cox_models.txt not found)

. file write tablecontent ("Outcome") _tab ("Exposure status") _tab ("denominat
> or") _tab ("events") _tab ("total_person_wks") _tab ("Rate") _tab ("unadj_hr"
> ) _tab ///
> ("unadj_ci") _tab ("unadj_lci") _tab ("unadj_uci") _tab ("f_adj_hr") _tab ("f
> _adj_ci") _tab ("f_adj_lci") _tab ("f_adj_uci") _tab  _n

. 
. * Cox models and Schoenfeld residual plots for each outcome
. foreach outcome in died_covid_any hosp_any composite_any {
  2.     use ./output/an_dataset_`outcome', clear 
  3.     * Open file to write results
.     describe
  4.     gen index_date = date("01/03/2020", "DMY")
  5.     stset stop, fail(`outcome'_flag) id(patient_id) enter(index_date) orig
> in(index_date)
  6.     count if `outcome'_flag==1
  7.     if r(N) > 10 {
  8.         sts graph, by(udca) title("`outcome'") graphregion(fcolor(white))
  9.         graph export ./output/graphs/km_`outcome'.svg, as(svg) replace
 10.         * Cox model - crude
.         stcox udca, strata(stp) vce(robust)
 11.         estimates save "./output/tempdata/crude_`outcome'", replace 
 12.         eststo model1
 13.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_crude_`outcome'", replace) idstr("crude_`outcome'") 
 14.         estat phtest, detail
 15.         * Plot schoenfeld residuals 
.         estat phtest, plot(udca) ///
>                     graphregion(fcolor(white)) ///
>                     ylabel(, nogrid labsize(small)) ///
>                     xlabel(, labsize(small)) ///
>                     xtitle("Time", size(small)) ///
>                     ytitle("Scaled Schoenfeld Residuals", size(small)) ///
>                     msize(small) ///
>                     mcolor(gs6) ///
>                     msymbol(circle_hollow) ///
>                     scheme(s1mono) ///
>                     title ("`outcome'", position(11) size(medsmall)) ///
>                     name(uni_plot_`outcome') ///
>                     note("")
 16.         * Cox model - fully adjusted
.         stcox udca age_tv male any_high_risk_condition i.ethnicity i.imd bmi_
> cat i.smoking severe_disease covid_vacc_first liver_trans i.wave, strata(stp)
>  vce(robust)
 17.         estimates save "./output/tempdata/adj_model_`outcome'", replace 
 18.         eststo model2
 19.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_adj_`outcome'", replace) idstr("adj_`outcome'") 
 20.         estat phtest, detail
 21.         * Plot Schoenfeld residuals 
.         estat phtest, plot(udca) ///
>                     graphregion(fcolor(white)) ///
>                     ylabel(, nogrid labsize(small)) ///
>                     xlabel(, labsize(small)) ///
>                     xtitle("Time", size(small)) ///
>                     ytitle("Scaled Schoenfeld Residuals", size(small)) ///
>                     msize(small) ///
>                     mcolor(gs6) ///
>                     msymbol(circle_hollow) ///
>                     scheme(s1mono) ///
>                     title ("Adjusted `outcome'", position(11) size(medsmall))
>  ///
>                     name(adj_plot_`outcome') ///
>                     note("")
 22.         graph combine uni_plot_`outcome' adj_plot_`outcome'
 23.         graph export ./output/graphs/schoenplot_`outcome'.svg, as(svg) rep
> lace 
 24.         * flag single row for each person
.         bys patient_id (start): gen number = _n==_N 
 25.         tab number 
 26.         * Count number unexposed at any time 
.         bys patient_id : egen unexposed_ever = min(udca) 
 27.         tab unexposed_ever if number==1
 28.         safecount if unexposed_ever==1 & number==1
 29.         local denominator = r(N)
 30.         safecount if udca == 0 & `outcome'_flag == 1
 31.         local event = r(N)
 32.         di "no udca events = " `event'
 33.         bysort udca: egen total_follow_up = total(_t) if number==1
 34.         su total_follow_up if udca==0 & number==1
 35.         local person_mth = r(mean)/30
 36.         di `person_mth'
 37.         local rate = 100000*(`event'/`person_mth')
 38.         di `rate'
 39.         if `event'>10 & `event'!=. {
 40.             file write tablecontent  ("`outcome'") _tab ("No UDCA") _tab (
> `denominator') _tab (`event') _tab %10.0f (`person_mth') _tab %3.2f (`rate') 
> _tab
 41.             file write tablecontent ("1.00") _tab _tab ("1.00")  _n
 42.             }
 43.         else {
 44.             file write tablecontent ("`outcome'") _tab ("No UDCA") _tab ("
> redact") _n
 45.             continue
 46.         }
 47.         * Count number exposed at any time 
.         bys patient_id : egen exposed_ever = max(udca) 
 48.         tab exposed_ever if number==1
 49.         qui safecount if exposed_ever==1 & number==1
 50.         local denominator = r(N)
 51.         qui safecount if udca == 1 & `outcome'_flag == 1
 52.         local event = r(N)
 53.         di "udca events = " `event'
 54.         qui su total_follow_up if udca==1 & number==1
 55.         local person_mth = r(mean)/30
 56.         local rate = 100000*(`event'/`person_mth')
 57.         if `event'>10 & `event'!=. {
 58.             file write tablecontent ("`outcome'") _tab ("UDCA") _tab (`den
> ominator') _tab (`event') _tab %10.0f (`person_mth') _tab %3.2f (`rate') _tab
 59.             cap estimates use "./output/tempdata/crude_`outcome'" 
 60.             cap lincom udca, eform
 61.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub)) _ta
> b 
 62.             cap estimates clear
 63.             cap estimates use "./output/tempdata/adj_model_`outcome'" 
 64.             cap lincom udca, eform
 65.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub)) _ta
> b _n 
 66.             cap estimates clear
 67.         }
 68.         else {
 69.             file write tablecontent  ("`outcome'") _tab ("UDCA") _tab ("re
> dact") _n
 70.             continue
 71.         }
 72.     
. drop total_follow_up
 73.     }
 74. else { 
 75.     file write tablecontent ("`outcome'") _tab ("redact") _n
 76.     continue
 77. }
 78. }

Contains data from ./output/an_dataset_died_covid_any.dta
  obs:         4,967                          
 vars:            17                          10 Jul 2023 12:26
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
stp             str4    %9s                   
imd             byte    %8.0g                 
ethnicity       byte    %8.0g      eth5       
patient_id      int     %8.0g                 
male            float   %9.0g                 
bmi_cat         float   %14.0g     bmi        
smoking         float   %9.0g                 
any_high_risk~n float   %9.0g                 
start           float   %9.0g                 
stop            float   %9.0g                 
died_covid_an~g byte    %8.0g                 
wave            float   %9.0g                 
age_tv          float   %9.0g                 
udca            float   %9.0g                 
liver_trans     float   %9.0g                 
covid_vacc_fi~t float   %9.0g                 
severe_disease  float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: 

                id:  patient_id
     failure event:  died_covid_any_flag != 0 & died_covid_any_flag < .
obs. time interval:  (stop[_n-1], stop]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      4,967  total observations
          0  exclusions
------------------------------------------------------------------------------
      4,967  observations remaining, representing
      1,000  subjects
        153  failures in single-failure-per-subject data
    651,528  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     1,035
  153

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_died_covid_any.svg not found)
(file ./output/graphs/km_died_covid_any.svg written in SVG format)

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -361.07731
Iteration 1:   log pseudolikelihood = -360.52069
Iteration 2:   log pseudolikelihood = -360.50284
Iteration 3:   log pseudolikelihood = -360.50281
Refining estimates:
Iteration 0:   log pseudolikelihood = -360.50281

Stratified Cox regr. -- no ties

No. of subjects      =        1,000             Number of obs    =       2,433
No. of failures      =          153
Time at risk         =       651528
                                                Wald chi2(1)     =        0.96
Log pseudolikelihood =   -360.50281             Prob > chi2      =      0.3272

                           (Std. Err. adjusted for 500 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   .6000562   .3127979    -0.98   0.327     .2160114    1.666891
------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/tempdata/crude_died_covid_any.ster saved
file ./output/tempdata/surv_crude_died_covid_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.08357         0.55        1         0.4574
      ------------+---------------------------------------------------
      global test |                      0.55        1         0.4574
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -360.18634
Iteration 1:   log pseudolikelihood = -345.38581
Iteration 2:   log pseudolikelihood = -344.60137
Iteration 3:   log pseudolikelihood = -344.47363
Iteration 4:   log pseudolikelihood = -344.42898
Iteration 5:   log pseudolikelihood = -344.41259
Iteration 6:   log pseudolikelihood = -344.40656
Iteration 7:   log pseudolikelihood = -344.40434
Iteration 8:   log pseudolikelihood = -344.40352
Iteration 9:   log pseudolikelihood = -344.40322
Iteration 10:  log pseudolikelihood = -344.40311
Iteration 11:  log pseudolikelihood = -344.40307
Iteration 12:  log pseudolikelihood = -344.40306
Iteration 13:  log pseudolikelihood = -344.40305
Iteration 14:  log pseudolikelihood = -344.40305
Iteration 15:  log pseudolikelihood = -344.40305
Iteration 16:  log pseudolikelihood = -344.40305
Iteration 17:  log pseudolikelihood = -344.40305
Iteration 18:  log pseudolikelihood = -344.40305
Iteration 19:  log pseudolikelihood = -344.40305
Iteration 20:  log pseudolikelihood = -344.40305
Iteration 21:  log pseudolikelihood = -344.40305
Iteration 22:  log pseudolikelihood = -344.40305
Iteration 23:  log pseudolikelihood = -344.40305
Iteration 24:  log pseudolikelihood = -344.40305
Iteration 25:  log pseudolikelihood = -344.40305
Iteration 26:  log pseudolikelihood = -344.40305
Iteration 27:  log pseudolikelihood = -344.40305
Iteration 28:  log pseudolikelihood = -344.40305
Iteration 29:  log pseudolikelihood = -344.40305
Iteration 30:  log pseudolikelihood = -344.40305
Iteration 31:  log pseudolikelihood = -344.40305
Iteration 32:  log pseudolikelihood = -344.40305
Iteration 33:  log pseudolikelihood = -344.40305
Iteration 34:  log pseudolikelihood = -344.40305
Iteration 35:  log pseudolikelihood = -344.40305
Refining estimates:
Iteration 0:   log pseudolikelihood = -344.40305
Iteration 1:   log pseudolikelihood = -344.40305

Stratified Cox regr. -- no ties

No. of subjects      =          990             Number of obs    =       2,405
No. of failures      =          150
Time at risk         =       645699
                                                Wald chi2(20)    =     4211.34
Log pseudolikelihood =   -344.40305             Prob > chi2      =      0.0000

                           (Std. Err. adjusted for 496 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   .6042528   .3367942    -0.90   0.366     .2026665    1.801588
      age_tv |   .9923079    .005109    -1.50   0.134     .9823448    1.002372
        male |   1.503474   .3650825     1.68   0.093     .9341188    2.419857
any_high_r~n |          1  (omitted)
             |
   ethnicity |
      Mixed  |   .9192296   .3495611    -0.22   0.825     .4362468    1.936938
      Asian  |   .8758908   .3409335    -0.34   0.734     .4084384    1.878336
      Black  |   .9908081   .3999916    -0.02   0.982     .4491149    2.185856
      Other  |   .8147435   .3187273    -0.52   0.600     .3784698    1.753923
    Unknown  |   1.393705   .6338608     0.73   0.465     .5715339    3.398597
             |
         imd |
          2  |   1.556964   .5731391     1.20   0.229     .7567286    3.203444
          3  |   1.886392   .7283206     1.64   0.100     .8850951    4.020443
          4  |   1.124984   .4388614     0.30   0.763     .5237074    2.416596
          5  |   .9261629   .3933272    -0.18   0.857      .402898     2.12902
          6  |   1.126997   .7910919     0.17   0.865     .2847242    4.460884
             |
     bmi_cat |   .9994618   .0734244    -0.01   0.994     .8654334    1.154247
             |
     smoking |
          1  |   1.450561    .871809     0.62   0.536     .4466333    4.711085
          2  |   .6441161   .4517352    -0.63   0.531     .1629276    2.546441
          3  |   2.587839   1.381943     1.78   0.075     .9086226    7.370398
             |
severe_dis~e |   .8489685   .2129454    -0.65   0.514     .5192614    1.388024
covid_vacc~t |   .5746414   .1702772    -1.87   0.062     .3214915    1.027127
 liver_trans |   2.62e-16   1.72e-16   -54.70   0.000     7.25e-17    9.49e-16
             |
        wave |
          2  |   1.728853          .        .       .            .           .
          3  |   5.585702          .        .       .            .           .
          4  |   7358.847          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/adj_model_died_covid_any.ster not found)
file ./output/tempdata/adj_model_died_covid_any.ster saved
(note: file ./output/tempdata/surv_adj_died_covid_any.dta not found)
file ./output/tempdata/surv_adj_died_covid_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.04688         0.31        1         0.5798
      age_tv      |      0.01914         0.05        1         0.8316
      male        |     -0.06650         0.70        1         0.4043
      o.any_high~n|            .            .        1             .
      1b.ethnicity|            .            .        1             .
      2.ethnicity |     -0.14700         2.81        1         0.0940
      3.ethnicity |     -0.04784         0.31        1         0.5780
      4.ethnicity |     -0.04976         0.27        1         0.6049
      5.ethnicity |     -0.15422         2.96        1         0.0854
      6.ethnicity |      0.09612         1.12        1         0.2901
      1b.imd      |            .            .        1             .
      2.imd       |     -0.18723         3.75        1         0.0528
      3.imd       |     -0.08000         0.84        1         0.3601
      4.imd       |     -0.06399         0.45        1         0.5010
      5.imd       |      0.00494         0.00        1         0.9589
      6.imd       |     -0.14215         2.64        1         0.1044
      bmi_cat     |      0.17495         3.84        1         0.0501
      0b.smoking  |            .            .        1             .
      1.smoking   |     -0.11396         1.76        1         0.1848
      2.smoking   |      0.03353         0.13        1         0.7152
      3.smoking   |     -0.06029         0.52        1         0.4722
      severe_dis~e|      0.02823         0.08        1         0.7749
      covid_vacc~t|      0.21320         2.24        1         0.1342
      liver_trans |      0.14285         0.79        1         0.3747
      1b.wave     |            .            .        1             .
      2.wave      |            .            .        1             .
      3.wave      |      0.00500            .        1             .
      4.wave      |            .            .        1             .
      ------------+---------------------------------------------------
      global test |                     19.85       20         0.4677
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.
(note: file ./output/graphs/schoenplot_died_covid_any.svg not found)
(file ./output/graphs/schoenplot_died_covid_any.svg written in SVG format)

     number |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,967       79.87       79.87
          1 |      1,000       20.13      100.00
------------+-----------------------------------
      Total |      4,967      100.00

unexposed_e |
        ver |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  0
  139
no udca events = 139
(3967 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
total_foll~p |        897      584131           0     584131     584131
19471.033
713.88096

exposed_eve |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        897       89.70       89.70
          1 |        103       10.30      100.00
------------+-----------------------------------
      Total |      1,000      100.00
udca events = 14

Contains data from ./output/an_dataset_hosp_any.dta
  obs:         5,025                          
 vars:            17                          10 Jul 2023 12:26
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
stp             str4    %9s                   
imd             byte    %8.0g                 
ethnicity       byte    %8.0g      eth5       
patient_id      int     %8.0g                 
male            float   %9.0g                 
bmi_cat         float   %14.0g     bmi        
smoking         float   %9.0g                 
any_high_risk~n float   %9.0g                 
start           float   %9.0g                 
stop            float   %9.0g                 
hosp_any_flag   float   %9.0g                 
wave            float   %9.0g                 
age_tv          float   %9.0g                 
udca            float   %9.0g                 
liver_trans     float   %9.0g                 
covid_vacc_fi~t float   %9.0g                 
severe_disease  float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: 

                id:  patient_id
     failure event:  hosp_any_flag != 0 & hosp_any_flag < .
obs. time interval:  (stop[_n-1], stop]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      5,025  total observations
        191  observations begin on or after (first) failure
------------------------------------------------------------------------------
      4,834  observations remaining, representing
      1,000  subjects
         58  failures in single-failure-per-subject data
    630,402  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     1,035
  58

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_hosp_any.svg not found)
(file ./output/graphs/km_hosp_any.svg written in SVG format)

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -145.73668
Iteration 1:   log pseudolikelihood = -145.43809
Iteration 2:   log pseudolikelihood = -145.42348
Iteration 3:   log pseudolikelihood = -145.42346
Refining estimates:
Iteration 0:   log pseudolikelihood = -145.42346

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =        1,000             Number of obs    =       2,364
No. of failures      =           58
Time at risk         =       630402
                                                Wald chi2(1)     =        0.68
Log pseudolikelihood =   -145.42346             Prob > chi2      =      0.4101

                           (Std. Err. adjusted for 500 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   1.566348    .853272     0.82   0.410     .5385101    4.555987
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/crude_hosp_any.ster not found)
file ./output/tempdata/crude_hosp_any.ster saved
(note: file ./output/tempdata/surv_crude_hosp_any.dta not found)
file ./output/tempdata/surv_crude_hosp_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.04342         0.06        1         0.8054
      ------------+---------------------------------------------------
      global test |                      0.06        1         0.8054
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -145.40832
Iteration 1:   log pseudolikelihood = -134.91428
Iteration 2:   log pseudolikelihood =  -133.5862
Iteration 3:   log pseudolikelihood = -133.35554
Iteration 4:   log pseudolikelihood = -133.28865
Iteration 5:   log pseudolikelihood = -133.26418
Iteration 6:   log pseudolikelihood = -133.25516
Iteration 7:   log pseudolikelihood = -133.25184
Iteration 8:   log pseudolikelihood = -133.25062
Iteration 9:   log pseudolikelihood = -133.25017
Iteration 10:  log pseudolikelihood = -133.25001
Iteration 11:  log pseudolikelihood = -133.24995
Iteration 12:  log pseudolikelihood = -133.24992
Iteration 13:  log pseudolikelihood = -133.24992
Iteration 14:  log pseudolikelihood = -133.24991
Iteration 15:  log pseudolikelihood = -133.24991
Iteration 16:  log pseudolikelihood = -133.24991
Iteration 17:  log pseudolikelihood = -133.24991
Iteration 18:  log pseudolikelihood = -133.24991
Iteration 19:  log pseudolikelihood = -133.24991
Iteration 20:  log pseudolikelihood = -133.24991
Iteration 21:  log pseudolikelihood = -133.24991
Iteration 22:  log pseudolikelihood = -133.24991
Iteration 23:  log pseudolikelihood = -133.24991
Iteration 24:  log pseudolikelihood = -133.24991
Iteration 25:  log pseudolikelihood = -133.24991
Iteration 26:  log pseudolikelihood = -133.24991
Iteration 27:  log pseudolikelihood = -133.24991
Iteration 28:  log pseudolikelihood = -133.24991
Iteration 29:  log pseudolikelihood = -133.24991
Iteration 30:  log pseudolikelihood = -133.24991
Iteration 31:  log pseudolikelihood = -133.24991
Iteration 32:  log pseudolikelihood = -133.24991
Iteration 33:  log pseudolikelihood = -133.24991
Refining estimates:
Iteration 0:   log pseudolikelihood = -133.24991
Iteration 1:   log pseudolikelihood = -133.24991

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =          990             Number of obs    =       2,336
No. of failures      =           58
Time at risk         =       624573
                                                Wald chi2(20)    =    11043.36
Log pseudolikelihood =   -133.24991             Prob > chi2      =      0.0000

                           (Std. Err. adjusted for 496 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   1.390212   .8275398     0.55   0.580     .4329058    4.464457
      age_tv |   1.003451   .0078829     0.44   0.661     .9881193    1.019021
        male |   1.041339   .3897425     0.11   0.914     .5000493    2.168562
any_high_r~n |          1  (omitted)
             |
   ethnicity |
      Mixed  |   1.711355   1.071717     0.86   0.391     .5015161    5.839765
      Asian  |   1.176138   .7904433     0.24   0.809     .3150608    4.390586
      Black  |    1.52202   1.034885     0.62   0.537     .4014696    5.770159
      Other  |   1.224308     .79565     0.31   0.755     .3425421    4.375899
    Unknown  |   .7410383   .8262203    -0.27   0.788     .0833286     6.59003
             |
         imd |
          2  |   8.138433   8.868131     1.92   0.054     .9616562    68.87502
          3  |   10.18704   10.87049     2.18   0.030      1.25817    82.48156
          4  |   9.096941   9.851922     2.04   0.041     1.089056    75.98723
          5  |   8.798238   9.537431     2.01   0.045     1.051186    73.63966
          6  |   1.05e-14   1.12e-14   -30.19   0.000     1.30e-15    8.50e-14
             |
     bmi_cat |   1.052308   .1306598     0.41   0.681     .8249987    1.342246
             |
     smoking |
          1  |    2.89596   3.037843     1.01   0.311     .3705851    22.63066
          2  |   3.525095   3.731567     1.19   0.234     .4427033    28.06913
          3  |   4.163294   4.247677     1.40   0.162     .5636155    30.75326
             |
severe_dis~e |    .408677   .1557905    -2.35   0.019      .193596    .8627085
covid_vacc~t |     .91594   .4299727    -0.19   0.852     .3649931    2.298525
 liver_trans |   2.43e-15   1.44e-15   -56.74   0.000     7.60e-16    7.77e-15
             |
        wave |
          2  |   895.2024          .        .       .            .           .
          3  |   36514.34          .        .       .            .           .
          4  |    9020752          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/adj_model_hosp_any.ster not found)
file ./output/tempdata/adj_model_hosp_any.ster saved
(note: file ./output/tempdata/surv_adj_hosp_any.dta not found)
file ./output/tempdata/surv_adj_hosp_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.15396         1.30        1         0.2546
      age_tv      |     -0.02148         0.03        1         0.8576
      male        |      0.27067         6.45        1         0.0111
      o.any_high~n|            .            .        1             .
      1b.ethnicity|            .            .        1             .
      2.ethnicity |     -0.17786         2.30        1         0.1298
      3.ethnicity |      0.17945         1.72        1         0.1894
      4.ethnicity |      0.10620         0.67        1         0.4124
      5.ethnicity |      0.17218         1.26        1         0.2614
      6.ethnicity |      0.13858         1.06        1         0.3024
      1b.imd      |            .            .        1             .
      2.imd       |     -0.20102         2.00        1         0.1578
      3.imd       |     -0.24342         3.30        1         0.0692
      4.imd       |     -0.33185         6.51        1         0.0107
      5.imd       |     -0.32348         5.93        1         0.0149
      6.imd       |     -0.22886         2.40        1         0.1217
      bmi_cat     |      0.16491         2.29        1         0.1306
      0b.smoking  |            .            .        1             .
      1.smoking   |      0.13174         0.92        1         0.3374
      2.smoking   |      0.00471         0.00        1         0.9724
      3.smoking   |      0.06427         0.23        1         0.6293
      severe_dis~e|     -0.07132         0.32        1         0.5697
      covid_vacc~t|     -0.01954         0.02        1         0.8845
      liver_trans |     -0.30273         0.57        1         0.4500
      1b.wave     |            .            .        1             .
      2.wave      |            .            .        1             .
      3.wave      |            .            .        1             .
      4.wave      |            .            .        1             .
      ------------+---------------------------------------------------
      global test |                     24.17       20         0.2353
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.
(note: file ./output/graphs/schoenplot_hosp_any.svg not found)
(file ./output/graphs/schoenplot_hosp_any.svg written in SVG format)

     number |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      4,025       80.10       80.10
          1 |      1,000       19.90      100.00
------------+-----------------------------------
      Total |      5,025      100.00

unexposed_e |
        ver |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  0
  53
no udca events = 53
(4025 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
total_foll~p |        897      541499           0     541499     541499
18049.967
293.62935

exposed_eve |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        897       89.70       89.70
          1 |        103       10.30      100.00
------------+-----------------------------------
      Total |      1,000      100.00
udca events = .

Contains data from ./output/an_dataset_composite_any.dta
  obs:         5,025                          
 vars:            17                          10 Jul 2023 12:26
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
stp             str4    %9s                   
imd             byte    %8.0g                 
ethnicity       byte    %8.0g      eth5       
patient_id      int     %8.0g                 
male            float   %9.0g                 
bmi_cat         float   %14.0g     bmi        
smoking         float   %9.0g                 
any_high_risk~n float   %9.0g                 
start           float   %9.0g                 
stop            float   %9.0g                 
composite_any~g float   %9.0g                 
wave            float   %9.0g                 
age_tv          float   %9.0g                 
udca            float   %9.0g                 
liver_trans     float   %9.0g                 
covid_vacc_fi~t float   %9.0g                 
severe_disease  float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: 

                id:  patient_id
     failure event:  composite_any_flag != 0 & composite_any_flag < .
obs. time interval:  (stop[_n-1], stop]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      5,025  total observations
        191  observations begin on or after (first) failure
------------------------------------------------------------------------------
      4,834  observations remaining, representing
      1,000  subjects
        213  failures in single-failure-per-subject data
    630,402  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     1,035
  213

         failure _d:  composite_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_composite_any.svg not found)
(file ./output/graphs/km_composite_any.svg written in SVG format)

         failure _d:  composite_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -517.07597
Iteration 1:   log pseudolikelihood = -517.07334
Iteration 2:   log pseudolikelihood = -517.07334
Refining estimates:
Iteration 0:   log pseudolikelihood = -517.07334

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =        1,000             Number of obs    =       2,364
No. of failures      =          213
Time at risk         =       630402
                                                Wald chi2(1)     =        0.01
Log pseudolikelihood =   -517.07334             Prob > chi2      =      0.9435

                           (Std. Err. adjusted for 500 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   .9751054   .3470624    -0.07   0.944     .4853884    1.958907
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/crude_composite_any.ster not found)
file ./output/tempdata/crude_composite_any.ster saved
(note: file ./output/tempdata/surv_crude_composite_any.dta not found)
file ./output/tempdata/surv_crude_composite_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.08078         0.75        1         0.3855
      ------------+---------------------------------------------------
      global test |                      0.75        1         0.3855
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  composite_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -515.73019
Iteration 1:   log pseudolikelihood = -497.29114
Iteration 2:   log pseudolikelihood = -496.32363
Iteration 3:   log pseudolikelihood = -496.13173
Iteration 4:   log pseudolikelihood = -496.06202
Iteration 5:   log pseudolikelihood = -496.03641
Iteration 6:   log pseudolikelihood =   -496.027
Iteration 7:   log pseudolikelihood = -496.02354
Iteration 8:   log pseudolikelihood = -496.02226
Iteration 9:   log pseudolikelihood = -496.02179
Iteration 10:  log pseudolikelihood = -496.02162
Iteration 11:  log pseudolikelihood = -496.02156
Iteration 12:  log pseudolikelihood = -496.02154
Iteration 13:  log pseudolikelihood = -496.02153
Iteration 14:  log pseudolikelihood = -496.02152
Iteration 15:  log pseudolikelihood = -496.02152
Iteration 16:  log pseudolikelihood = -496.02152
Iteration 17:  log pseudolikelihood = -496.02152
Iteration 18:  log pseudolikelihood = -496.02152
Iteration 19:  log pseudolikelihood = -496.02152
Iteration 20:  log pseudolikelihood = -496.02152
Iteration 21:  log pseudolikelihood = -496.02152
Iteration 22:  log pseudolikelihood = -496.02152
Iteration 23:  log pseudolikelihood = -496.02152
Iteration 24:  log pseudolikelihood = -496.02152
Iteration 25:  log pseudolikelihood = -496.02152
Iteration 26:  log pseudolikelihood = -496.02152
Iteration 27:  log pseudolikelihood = -496.02152
Iteration 28:  log pseudolikelihood = -496.02152
Iteration 29:  log pseudolikelihood = -496.02152
Iteration 30:  log pseudolikelihood = -496.02152
Iteration 31:  log pseudolikelihood = -496.02152
Iteration 32:  log pseudolikelihood = -496.02152
Iteration 33:  log pseudolikelihood = -496.02152
Iteration 34:  log pseudolikelihood = -496.02152
Iteration 35:  log pseudolikelihood = -496.02152
Iteration 36:  log pseudolikelihood = -496.02152
Iteration 37:  log pseudolikelihood = -496.02152
Iteration 38:  log pseudolikelihood = -496.02152
Refining estimates:
Iteration 0:   log pseudolikelihood = -496.02152
Iteration 1:   log pseudolikelihood = -496.02152
Iteration 2:   log pseudolikelihood = -496.02152

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =          990             Number of obs    =       2,336
No. of failures      =          210
Time at risk         =       624573
                                                Wald chi2(20)    =     6094.91
Log pseudolikelihood =   -496.02152             Prob > chi2      =      0.0000

                           (Std. Err. adjusted for 496 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   .9375404   .3524505    -0.17   0.864     .4487422    1.958768
      age_tv |   .9951978   .0040634    -1.18   0.238     .9872654    1.003194
        male |   1.196456   .2378153     0.90   0.367     .8104133    1.766392
any_high_r~n |          1  (omitted)
             |
   ethnicity |
      Mixed  |   1.041702   .3198503     0.13   0.894     .5706702    1.901522
      Asian  |    .843343    .273087    -0.53   0.599     .4470669    1.590875
      Black  |   1.020133   .3280609     0.06   0.951     .5431523    1.915983
      Other  |   .9606554   .2938042    -0.13   0.896     .5275194    1.749431
    Unknown  |   .9820719   .4282346    -0.04   0.967     .4178063    2.308403
             |
         imd |
          2  |   2.441495   .8329413     2.62   0.009     1.251007    4.764881
          3  |   2.853274   1.021157     2.93   0.003      1.41484    5.754132
          4  |   1.971819   .7055135     1.90   0.058     .9779317    3.975809
          5  |   1.575023   .6006105     1.19   0.234     .7459237    3.325672
          6  |   1.517144   .9609022     0.66   0.510     .4384376    5.249839
             |
     bmi_cat |   .9862796    .060625    -0.22   0.822     .8743354    1.112556
             |
     smoking |
          1  |   1.963579   1.034074     1.28   0.200     .6994915    5.512065
          2  |   1.289345   .7277194     0.45   0.653     .4265231    3.897588
          3  |   3.162503   1.515238     2.40   0.016     1.236511    8.088423
             |
severe_dis~e |   .6778756   .1359535    -1.94   0.053     .4575457    1.004305
covid_vacc~t |   .6354923    .167897    -1.72   0.086     .3786368     1.06659
 liver_trans |   4.68e-18   2.62e-18   -71.29   0.000     1.56e-18    1.40e-17
             |
        wave |
          2  |   1347.859          .        .       .            .           .
          3  |    1079518          .        .       .            .           .
          4  |    6384804          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/adj_model_composite_any.ster not found)
file ./output/tempdata/adj_model_composite_any.ster saved
(note: file ./output/tempdata/surv_adj_composite_any.dta not found)
file ./output/tempdata/surv_adj_composite_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.08330         1.10        1         0.2943
      age_tv      |      0.00153         0.00        1         0.9855
      male        |      0.01354         0.03        1         0.8698
      o.any_high~n|            .            .        1             .
      1b.ethnicity|            .            .        1             .
      2.ethnicity |     -0.11409         1.60        1         0.2054
      3.ethnicity |      0.03412         0.17        1         0.6842
      4.ethnicity |      0.05050         0.32        1         0.5698
      5.ethnicity |     -0.01816         0.04        1         0.8349
      6.ethnicity |      0.09807         1.48        1         0.2231
      1b.imd      |            .            .        1             .
      2.imd       |     -0.07940         0.95        1         0.3306
      3.imd       |     -0.03021         0.16        1         0.6903
      4.imd       |     -0.07677         0.95        1         0.3288
      5.imd       |     -0.06854         0.69        1         0.4079
      6.imd       |     -0.10476         1.88        1         0.1703
      bmi_cat     |      0.09569         1.29        1         0.2554
      0b.smoking  |            .            .        1             .
      1.smoking   |     -0.05044         0.42        1         0.5160
      2.smoking   |     -0.01872         0.05        1         0.8199
      3.smoking   |     -0.02991         0.15        1         0.6960
      severe_dis~e|     -0.03078         0.11        1         0.7361
      covid_vacc~t|      0.11434         1.12        1         0.2891
      liver_trans |      0.05958         0.10        1         0.7539
      1b.wave     |            .            .        1             .
      2.wave      |            .            .        1             .
      3.wave      |     -0.06603            .        1             .
      4.wave      |     -0.07722            .        1             .
      ------------+---------------------------------------------------
      global test |                     11.51       20         0.9320
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.
(note: file ./output/graphs/schoenplot_composite_any.svg not found)
(file ./output/graphs/schoenplot_composite_any.svg written in SVG format)

     number |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      4,025       80.10       80.10
          1 |      1,000       19.90      100.00
------------+-----------------------------------
      Total |      5,025      100.00

unexposed_e |
        ver |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  0
  192
no udca events = 192
(4025 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
total_foll~p |        897      541499           0     541499     541499
18049.967
1063.7139

exposed_eve |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        897       89.70       89.70
          1 |        103       10.30      100.00
------------+-----------------------------------
      Total |      1,000      100.00
udca events = 21

. 
. file close tablecontent

. 
end of do-file

. . file open output using "/tmp/106_analysis_models.do.ObYZ.out", write text r
> eplace

. . file write output "success" 

. . file close output

. 
end of do-file


