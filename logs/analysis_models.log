
. 
. * Open file to write results to 
. file open tablecontent using ./output/tables/cox_models.txt, write text repla
> ce
(note: file ./output/tables/cox_models.txt not found)

. file write tablecontent ("Outcome") _tab ("Exposure status") _tab ("denominat
> or") _tab ("events") _tab ("total_person_mths") _tab ("Rate") _tab ("unadj_hr
> ") _tab ///
> ("unadj_ci") _tab ("unadj_lci") _tab ("unadj_uci")  _tab ("p_adj_hr") _tab ("
> p_adj_ci") _tab ("p_adj_lci") _tab ("p_adj_uci") _tab ("f_adj_hr") _tab ("f_a
> dj_ci") _tab ("f_adj_lci") _tab ("f_adj_uci") _tab  _n

. 
. * Cox models and Schoenfeld residual plots for each outcome
. foreach outcome in died_covid_any hosp_any composite_any {
  2.     use ./output/an_dataset_`outcome', clear 
  3.     * Open file to write results
.     describe
  4.     gen index_date = date("01/03/2020", "DMY")
  5.     stset stop, fail(`outcome'_flag) id(patient_id) enter(index_date) orig
> in(index_date)
  6.     count if `outcome'_flag==1
  7.     if r(N) > 10 {
  8.         sts graph, by(udca) title("`outcome'") graphregion(fcolor(white)) 
> ylabel(.75(.1)1)
  9.         graph export ./output/graphs/km_`outcome'.svg, as(svg) replace
 10.         * Cox model - crude
.         stcox udca, strata(stp) vce(robust)
 11.         estimates save "./output/tempdata/crude_`outcome'", replace 
 12.         eststo model1
 13.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_crude_`outcome'", replace) idstr("crude_`outcome'") 
 14.         estat phtest, detail
 15.         * Plot schoenfeld residuals 
.         estat phtest, plot(udca) ///
>                     graphregion(fcolor(white)) ///
>                     ylabel(, nogrid labsize(small)) ///
>                     xlabel(, labsize(small)) ///
>                     xtitle("Time", size(small)) ///
>                     ytitle("Scaled Schoenfeld Residuals", size(small)) ///
>                     msize(small) ///
>                     mcolor(gs6) ///
>                     msymbol(circle_hollow) ///
>                     scheme(s1mono) ///
>                     title ("`outcome'", position(11) size(medsmall)) ///
>                     name(uni_plot_`outcome') ///
>                     note("")
 16.         * Cox model - age and sex adjusted
.         stcox udca age_tv male, strata(stp) vce(robust)
 17.         estimates save "./output/tempdata/p_adj_model_`outcome'", replace 
 18.         eststo model2
 19.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/p_surv_adj_`outcome'", replace) idstr("adj_`outcome'") 
 20.         estat phtest, detail
 21.         * Cox model - fully adjusted
.         stcox udca age_tv male any_high_risk_condition i.eth_bin i.imd ib2.bm
> i_cat i.smoking severe_disease covid_vacc_first liver_trans, strata(stp) vce(
> robust)
 22.         estimates save "./output/tempdata/adj_model_`outcome'", replace 
 23.         eststo model3
 24.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_adj_`outcome'", replace) idstr("adj_`outcome'") 
 25.         estat phtest, detail
 26.         * Plot Schoenfeld residuals 
.         estat phtest, plot(udca) ///
>                     graphregion(fcolor(white)) ///
>                     ylabel(, nogrid labsize(small)) ///
>                     xlabel(, labsize(small)) ///
>                     xtitle("Time", size(small)) ///
>                     ytitle("Scaled Schoenfeld Residuals", size(small)) ///
>                     msize(small) ///
>                     mcolor(gs6) ///
>                     msymbol(circle_hollow) ///
>                     scheme(s1mono) ///
>                     title ("Adjusted `outcome'", position(11) size(medsmall))
>  ///
>                     name(adj_plot_`outcome') ///
>                     note("")
 27.         graph combine uni_plot_`outcome' adj_plot_`outcome'
 28.         graph export ./output/graphs/schoenplot_`outcome'.svg, as(svg) rep
> lace 
 29.         * Cox model - fully adjusted with binary ethnicity variable 
.         stcox udca age_tv male any_high_risk_condition i.ethnicity i.imd ib2.
> bmi_cat i.smoking severe_disease covid_vacc_first liver_trans, strata(stp) vc
> e(robust)
 30.         * flag single row for each person
.         bys patient_id (start): gen number = _n==_N 
 31.         tab number 
 32.         * Count number unexposed at any time 
.         bys patient_id : egen unexposed_ever = min(udca) 
 33.         tab unexposed_ever if number==1
 34.         safecount if unexposed_ever==0 & number==1
 35.         local denominator = r(N)
 36.         safecount if udca == 0 & `outcome'_flag == 1
 37.         local event = r(N)
 38.         di "no udca events = " `event'
 39.         bysort udca: egen total_follow_up = total(_t) if number==1
 40.         su total_follow_up if udca==0 & number==1
 41.         local person_mth = r(mean)/30
 42.         di `person_mth'
 43.         local rate = 100000*(`event'/`person_mth')
 44.         di `rate'
 45.         if `event'>10 & `event'!=. {
 46.             file write tablecontent  ("`outcome'") _tab ("No UDCA") _tab (
> `denominator') _tab (`event') _tab %10.0f (`person_mth') _tab %3.2f (`rate') 
> _tab
 47.             file write tablecontent ("1.00") _tab _tab ("1.00")  _n
 48.             }
 49.         else {
 50.             file write tablecontent ("`outcome'") _tab ("No UDCA") _tab ("
> redact") _n
 51.             continue
 52.         }
 53.         * Count number exposed at any time 
.         bys patient_id : egen exposed_ever = max(udca) 
 54.         tab exposed_ever if number==1
 55.         qui safecount if exposed_ever==1 & number==1
 56.         local denominator = r(N)
 57.         qui safecount if udca == 1 & `outcome'_flag == 1
 58.         local event = r(N)
 59.         di "udca events = " `event'
 60.         qui su total_follow_up if udca==1 & number==1
 61.         local person_mth = r(mean)/30
 62.         local rate = 100000*(`event'/`person_mth')
 63.         if `event'>10 & `event'!=. {
 64.             file write tablecontent ("`outcome'") _tab ("UDCA") _tab (`den
> ominator') _tab (`event') _tab %10.0f (`person_mth') _tab %3.2f (`rate') _tab
 65.             cap estimates use "./output/tempdata/crude_`outcome'" 
 66.             cap lincom udca, eform
 67.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub)) _ta
> b 
 68.             cap estimates clear
 69.             cap estimates use "./output/tempdata/p_adj_model_`outcome'" 
 70.             cap lincom udca, eform
 71.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub)) _ta
> b 
 72.             cap estimates clear
 73.             cap estimates use "./output/tempdata/adj_model_`outcome'" 
 74.             cap lincom udca, eform
 75.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub)) _ta
> b _n 
 76.             cap estimates clear
 77.         }
 78.         else {
 79.             file write tablecontent  ("`outcome'") _tab ("UDCA") _tab ("re
> dact") _n
 80.             continue
 81.         }
 82.     
. drop total_follow_up
 83.     }
 84. else { 
 85.     file write tablecontent ("`outcome'") _tab ("redact") _n
 86.     continue
 87. }
 88. }

Contains data from ./output/an_dataset_died_covid_any.dta
  obs:         2,595                          
 vars:            19                          13 Sep 2023 10:43
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
stp             str4    %9s                   
imd             byte    %8.0g                 
ethnicity       byte    %8.0g      eth5       
has_pbc         byte    %8.0g                 
patient_id      int     %8.0g                 
male            float   %9.0g                 
eth_bin         float   %9.0g      eth2       
bmi_cat         float   %14.0g     bmi        
smoking         float   %14.0g     smok       
any_high_risk~n float   %9.0g                 
time_vacc_cat   byte    %8.0g                 4 quantiles of time_vacc
start           float   %9.0g                 
stop            float   %9.0g                 
died_covid_an~g byte    %8.0g                 
age_tv          float   %9.0g                 
udca            float   %9.0g                 
liver_trans     float   %9.0g                 
covid_vacc_fi~t float   %9.0g                 
severe_disease  float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: 

                id:  patient_id
     failure event:  died_covid_any_flag != 0 & died_covid_any_flag < .
obs. time interval:  (stop[_n-1], stop]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      2,595  total observations
          0  exclusions
------------------------------------------------------------------------------
      2,595  observations remaining, representing
      1,000  subjects
        165  failures in single-failure-per-subject data
    676,087  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     1,035
  165

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_died_covid_any.svg not found)
(file ./output/graphs/km_died_covid_any.svg written in SVG format)

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -29.709405
Iteration 1:   log pseudolikelihood = -29.431738
Iteration 2:   log pseudolikelihood =  -29.43051
Refining estimates:
Iteration 0:   log pseudolikelihood =  -29.43051

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         284
No. of failures      =           23
Time at risk         =       112288
                                                Wald chi2(1)     =        0.64
Log pseudolikelihood =    -29.43051             Prob > chi2      =      0.4246

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |    .596213   .3861765    -0.80   0.425     .1675193    2.121964
------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/tempdata/crude_died_covid_any.ster saved
file ./output/tempdata/surv_crude_died_covid_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.18547         0.28        1         0.5936
      ------------+---------------------------------------------------
      global test |                      0.28        1         0.5936
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -29.709405
Iteration 1:   log pseudolikelihood = -28.281362
Iteration 2:   log pseudolikelihood = -28.263579
Iteration 3:   log pseudolikelihood = -28.263567
Refining estimates:
Iteration 0:   log pseudolikelihood = -28.263567

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         284
No. of failures      =           23
Time at risk         =       112288
                                                Wald chi2(3)     =        3.04
Log pseudolikelihood =   -28.263567             Prob > chi2      =      0.3855

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   .6280341   .4864481    -0.60   0.548     .1376193    2.866072
      age_tv |   .9784407    .016049    -1.33   0.184     .9474855    1.010407
        male |   1.467337   1.109715     0.51   0.612     .3332613    6.460632
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/p_adj_model_died_covid_any.ster not found)
file ./output/tempdata/p_adj_model_died_covid_any.ster saved
(note: file ./output/tempdata/p_surv_adj_died_covid_any.dta not found)
file ./output/tempdata/p_surv_adj_died_covid_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |      0.23229         0.82        1         0.3664
      age_tv      |     -0.19766         0.40        1         0.5267
      male        |     -0.54639         5.19        1         0.0227
      ------------+---------------------------------------------------
      global test |                      5.50        3         0.1388
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -29.709405
Iteration 1:   log pseudolikelihood = -23.025786
Iteration 2:   log pseudolikelihood = -22.077505
Iteration 3:   log pseudolikelihood = -21.896967
Iteration 4:   log pseudolikelihood = -21.840149
Iteration 5:   log pseudolikelihood = -21.819549
Iteration 6:   log pseudolikelihood = -21.812004
Iteration 7:   log pseudolikelihood = -21.809233
Iteration 8:   log pseudolikelihood = -21.808214
Iteration 9:   log pseudolikelihood = -21.807839
Iteration 10:  log pseudolikelihood = -21.807702
Iteration 11:  log pseudolikelihood = -21.807651
Iteration 12:  log pseudolikelihood = -21.807632
Iteration 13:  log pseudolikelihood = -21.807625
Iteration 14:  log pseudolikelihood = -21.807623
Iteration 15:  log pseudolikelihood = -21.807622
Iteration 16:  log pseudolikelihood = -21.807622
Iteration 17:  log pseudolikelihood = -21.807621
Iteration 18:  log pseudolikelihood = -21.807621
Iteration 19:  log pseudolikelihood = -21.807621
Iteration 20:  log pseudolikelihood = -21.807621
Iteration 21:  log pseudolikelihood = -21.807621
Iteration 22:  log pseudolikelihood = -21.807621
Iteration 23:  log pseudolikelihood = -21.807621
Iteration 24:  log pseudolikelihood = -21.807621
Iteration 25:  log pseudolikelihood = -21.807621
Iteration 26:  log pseudolikelihood = -21.807621
Iteration 27:  log pseudolikelihood = -21.807621
Iteration 28:  log pseudolikelihood = -21.807621
Iteration 29:  log pseudolikelihood = -21.807621
Iteration 30:  log pseudolikelihood = -21.807621
Iteration 31:  log pseudolikelihood = -21.807621
Iteration 32:  log pseudolikelihood = -21.807621
Iteration 33:  log pseudolikelihood = -21.807621
Iteration 34:  log pseudolikelihood = -21.807621
Iteration 35:  log pseudolikelihood = -21.807621
Iteration 36:  log pseudolikelihood = -21.807621
Iteration 37:  log pseudolikelihood = -21.807621
Iteration 38:  log pseudolikelihood = -21.807621
Iteration 39:  log pseudolikelihood = -21.807621
Iteration 40:  log pseudolikelihood = -21.807621
Iteration 41:  log pseudolikelihood = -21.807621
Iteration 42:  log pseudolikelihood = -21.807621
Refining estimates:
Iteration 0:   log pseudolikelihood = -21.807621
Iteration 1:   log pseudolikelihood = -21.807621

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         284
No. of failures      =           23
Time at risk         =       112288
                                                Wald chi2(15)    =     4587.32
Log pseudolikelihood =   -21.807621             Prob > chi2      =      0.0000

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   .7352868   .6969189    -0.32   0.746     .1147286    4.712397
      age_tv |   .9706136   .0272639    -1.06   0.288     .9186217    1.025548
        male |   .9204724   .9372821    -0.08   0.935     .1251021    6.772625
any_high_r~n |          1  (omitted)
             |
     eth_bin |
  Non-White  |   .2250824   .2371551    -1.42   0.157      .028542    1.775003
             |
         imd |
          2  |    .874533    1.53475    -0.08   0.939     .0280525    27.26343
          3  |   5.48e-20   8.42e-20   -28.86   0.000     2.69e-21    1.11e-18
          4  |   .5538162    .822077    -0.40   0.691     .0301894    10.15962
          5  |   .6865418   1.027133    -0.25   0.802     .0365752    12.88686
          6  |   9.15e-20          .        .       .            .           .
             |
     bmi_cat |
Underweight  |   1.957709   2.840177     0.46   0.643     .1139868    33.62343
 Overweight  |   2.445682   2.363649     0.93   0.355     .3679167    16.25738
      Obese  |   .3656801   .2963751    -1.24   0.215     .0746831    1.790524
Morbidly ..  |   8.82e-20          .        .       .            .           .
             |
     smoking |
Current s..  |   .7220124   .6331399    -0.37   0.710     .1294546    4.026908
  Ex-smoker  |   1.502205   2.173707     0.28   0.779     .0881112    25.61103
             |
severe_dis~e |   4.551176   6.236893     1.11   0.269     .3102019    66.77332
covid_vacc~t |   .3039522   .6745893    -0.54   0.592     .0039233     23.5481
 liver_trans |   2.58e-19          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/adj_model_died_covid_any.ster not found)
file ./output/tempdata/adj_model_died_covid_any.ster saved
(note: file ./output/tempdata/surv_adj_died_covid_any.dta not found)
file ./output/tempdata/surv_adj_died_covid_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |     -0.16952         2.55        1         0.1101
      age_tv      |     -0.00834         0.01        1         0.9414
      male        |      0.04293         0.12        1         0.7254
      o.any_high~n|            .            .        1             .
      0b.eth_bin  |            .            .        1             .
      1.eth_bin   |     -0.06941         0.21        1         0.6487
      1b.imd      |            .            .        1             .
      2.imd       |      0.31178        10.72        1         0.0011
      3.imd       |      0.17922         0.97        1         0.3243
      4.imd       |      0.31663         9.51        1         0.0020
      5.imd       |      0.30679         7.30        1         0.0069
      6.imd       |            .            .        1             .
      1.bmi_cat   |      0.22297         6.38        1         0.0116
      2b.bmi_cat  |            .            .        1             .
      3.bmi_cat   |      0.12237         0.87        1         0.3501
      4.bmi_cat   |     -0.00026         0.00        1         0.9992
      5.bmi_cat   |            .            .        1             .
      0b.smoking  |            .            .        1             .
      1.smoking   |     -0.08076         0.10        1         0.7521
      2.smoking   |     -0.37112         9.85        1         0.0017
      severe_dis~e|      0.20543         5.48        1         0.0192
      covid_vacc~t|      0.11768         2.35        1         0.1250
      liver_trans |            .            .        1             .
      ------------+---------------------------------------------------
      global test |                     21.94       15         0.1093
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.
(note: file ./output/graphs/schoenplot_died_covid_any.svg not found)
(file ./output/graphs/schoenplot_died_covid_any.svg written in SVG format)

         failure _d:  died_covid_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -29.709405
Iteration 1:   log pseudolikelihood = -20.803884
Iteration 2:   log pseudolikelihood = -17.571146
Iteration 3:   log pseudolikelihood = -15.891165
Iteration 4:   log pseudolikelihood = -15.444157
Iteration 5:   log pseudolikelihood = -15.357863
Iteration 6:   log pseudolikelihood =  -15.33638
Iteration 7:   log pseudolikelihood = -15.328664
Iteration 8:   log pseudolikelihood = -15.325832
Iteration 9:   log pseudolikelihood = -15.324792
Iteration 10:  log pseudolikelihood = -15.324409
Iteration 11:  log pseudolikelihood = -15.324268
Iteration 12:  log pseudolikelihood = -15.324216
Iteration 13:  log pseudolikelihood = -15.324197
Iteration 14:  log pseudolikelihood =  -15.32419
Iteration 15:  log pseudolikelihood = -15.324188
Iteration 16:  log pseudolikelihood = -15.324187
Iteration 17:  log pseudolikelihood = -15.324186
Iteration 18:  log pseudolikelihood = -15.324186
Iteration 19:  log pseudolikelihood = -15.324186
Iteration 20:  log pseudolikelihood = -15.324186
Iteration 21:  log pseudolikelihood = -15.324186
Iteration 22:  log pseudolikelihood = -15.324186
Iteration 23:  log pseudolikelihood = -15.324186
Iteration 24:  log pseudolikelihood = -15.324186
Iteration 25:  log pseudolikelihood = -15.324186
Iteration 26:  log pseudolikelihood = -15.324186
Iteration 27:  log pseudolikelihood = -15.324186
Iteration 28:  log pseudolikelihood = -15.324186
Iteration 29:  log pseudolikelihood = -15.324186
Iteration 30:  log pseudolikelihood = -15.324186
Iteration 31:  log pseudolikelihood = -15.324186
Iteration 32:  log pseudolikelihood = -15.324186
Iteration 33:  log pseudolikelihood = -15.324186
Iteration 34:  log pseudolikelihood = -15.324186
Iteration 35:  log pseudolikelihood = -15.324186
Iteration 36:  log pseudolikelihood = -15.324186
Iteration 37:  log pseudolikelihood = -15.324186
Iteration 38:  log pseudolikelihood = -15.324186
Iteration 39:  log pseudolikelihood = -15.324186
Iteration 40:  log pseudolikelihood = -15.324186
Iteration 41:  log pseudolikelihood = -15.324186
Iteration 42:  log pseudolikelihood = -15.324186
Iteration 43:  log pseudolikelihood = -15.324186
Iteration 44:  log pseudolikelihood = -15.324186
Iteration 45:  log pseudolikelihood = -15.324186
Refining estimates:
Iteration 0:   log pseudolikelihood = -15.324186

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         284
No. of failures      =           23
Time at risk         =       112288
                                                Wald chi2(16)    =       53.62
Log pseudolikelihood =   -15.324186             Prob > chi2      =      0.0000

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |    .223964   .2390797    -1.40   0.161     .0276393      1.8148
      age_tv |    .944233   .0483892    -1.12   0.263     .8539993    1.044001
        male |   2.695146   2.143734     1.25   0.213     .5669331    12.81246
any_high_r~n |          1  (omitted)
             |
   ethnicity |
      Mixed  |   .0306302   .0832882    -1.28   0.200     .0001485    6.319711
      Asian  |   1.110581   2.078841     0.06   0.955     .0283289    43.53833
      Black  |   1.27e-23          .        .       .            .           .
      Other  |   .0205438   .0850928    -0.94   0.348     6.12e-06    68.92457
    Unknown  |   9.47e-24          .        .       .            .           .
             |
         imd |
          2  |   4.203149   13.92066     0.43   0.665     .0063743    2771.528
          3  |   9.47e-21          .        .       .            .           .
          4  |    .634874    1.14494    -0.25   0.801     .0185191    21.76481
          5  |   .1859086   .4831469    -0.65   0.517     .0011407     30.2996
          6  |   1.40e-19          .        .       .            .           .
             |
     bmi_cat |
Underweight  |   59.53624   301.9656     0.81   0.420     .0028676     1236072
 Overweight  |   18.89378   39.51929     1.41   0.160     .3132547    1139.567
      Obese  |    .086205   .1391953    -1.52   0.129       .00364    2.041592
Morbidly ..  |   9.29e-21          .        .       .            .           .
             |
     smoking |
Current s..  |   .2050282   .2495204    -1.30   0.193     .0188754    2.227053
  Ex-smoker  |   73.56772   211.1718     1.50   0.134     .2650716    20417.92
             |
severe_dis~e |   25.76503   77.68349     1.08   0.281     .0699189     9494.38
covid_vacc~t |   .2075674   .7165323    -0.46   0.649     .0002392    180.1136
 liver_trans |   6.69e-20          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp

     number |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,595       61.46       61.46
          1 |      1,000       38.54      100.00
------------+-----------------------------------
      Total |      2,595      100.00
(1868 missing values generated)

unexposed_e |
        ver |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        198      100.00      100.00
------------+-----------------------------------
      Total |        198      100.00
  198
  7
no udca events = 7
(1595 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
total_foll~p |         60       30138           0      30138      30138
1004.6
696.79474

Contains data from ./output/an_dataset_hosp_any.dta
  obs:         2,535                          
 vars:            20                          13 Sep 2023 10:43
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
stp             str4    %9s                   
imd             byte    %8.0g                 
ethnicity       byte    %8.0g      eth5       
has_pbc         byte    %8.0g                 
patient_id      int     %8.0g                 
male            float   %9.0g                 
eth_bin         float   %9.0g      eth2       
bmi_cat         float   %14.0g     bmi        
smoking         float   %14.0g     smok       
any_high_risk~n float   %9.0g                 
time_vacc_cat   byte    %8.0g                 4 quantiles of time_vacc
start           float   %9.0g                 
stop            float   %9.0g                 
hosp_any_flag   float   %9.0g                 
age_tv          float   %9.0g                 
udca            float   %9.0g                 
liver_trans     float   %9.0g                 
covid_vacc_fi~t float   %9.0g                 
severe_disease  float   %9.0g                 
total_hosp      float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: 

                id:  patient_id
     failure event:  hosp_any_flag != 0 & hosp_any_flag < .
obs. time interval:  (stop[_n-1], stop]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      2,535  total observations
          0  exclusions
------------------------------------------------------------------------------
      2,535  observations remaining, representing
      1,000  subjects
         57  failures in single-failure-per-subject data
    652,131  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     1,035
  57

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_hosp_any.svg not found)
(file ./output/graphs/km_hosp_any.svg written in SVG format)

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -8.9146261
Iteration 1:   log pseudolikelihood = -8.0075123
Iteration 2:   log pseudolikelihood = -7.7974571
Iteration 3:   log pseudolikelihood = -7.7278485
Iteration 4:   log pseudolikelihood = -7.7031091
Iteration 5:   log pseudolikelihood = -7.6941187
Iteration 6:   log pseudolikelihood =  -7.690826
Iteration 7:   log pseudolikelihood = -7.6896167
Iteration 8:   log pseudolikelihood =  -7.689172
Iteration 9:   log pseudolikelihood = -7.6890085
Iteration 10:  log pseudolikelihood = -7.6889483
Iteration 11:  log pseudolikelihood = -7.6889262
Iteration 12:  log pseudolikelihood = -7.6889181
Iteration 13:  log pseudolikelihood = -7.6889151
Iteration 14:  log pseudolikelihood =  -7.688914
Iteration 15:  log pseudolikelihood = -7.6889136
Iteration 16:  log pseudolikelihood = -7.6889134
Iteration 17:  log pseudolikelihood = -7.6889134
Iteration 18:  log pseudolikelihood = -7.6889133
Iteration 19:  log pseudolikelihood = -7.6889133
Iteration 20:  log pseudolikelihood = -7.6889133
Iteration 21:  log pseudolikelihood = -7.6889133
Iteration 22:  log pseudolikelihood = -7.6889133
Iteration 23:  log pseudolikelihood = -7.6889133
Iteration 24:  log pseudolikelihood = -7.6889133
Iteration 25:  log pseudolikelihood = -7.6889133
Iteration 26:  log pseudolikelihood = -7.6889133
Iteration 27:  log pseudolikelihood = -7.6889133
Iteration 28:  log pseudolikelihood = -7.6889133
Iteration 29:  log pseudolikelihood = -7.6889133
Iteration 30:  log pseudolikelihood = -7.6889133
Iteration 31:  log pseudolikelihood = -7.6889133
Iteration 32:  log pseudolikelihood = -7.6889133
Iteration 33:  log pseudolikelihood = -7.6889133
Iteration 34:  log pseudolikelihood = -7.6889133
Iteration 35:  log pseudolikelihood = -7.6889133
Refining estimates:
Iteration 0:   log pseudolikelihood = -7.6889133
Iteration 1:   log pseudolikelihood = -7.6889133

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         280
No. of failures      =            9
Time at risk         =       110140
                                                Wald chi2(1)     =     1235.76
Log pseudolikelihood =   -7.6889133             Prob > chi2      =      0.0000

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   8.47e+15   8.84e+15    35.15   0.000     1.10e+15    6.54e+16
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/crude_hosp_any.ster not found)
file ./output/tempdata/crude_hosp_any.ster saved
(note: file ./output/tempdata/surv_crude_hosp_any.dta not found)
file ./output/tempdata/surv_crude_hosp_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |            .         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                      0.00        1         1.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log pseudolikelihood = -8.9146261
Iteration 1:   log pseudolikelihood = -5.9707226
Iteration 2:   log pseudolikelihood = -5.5651532
Iteration 3:   log pseudolikelihood = -5.4222889
Iteration 4:   log pseudolikelihood = -5.3697281
Iteration 5:   log pseudolikelihood = -5.3504089
Iteration 6:   log pseudolikelihood = -5.3433042
Iteration 7:   log pseudolikelihood = -5.3406908
Iteration 8:   log pseudolikelihood = -5.3397295
Iteration 9:   log pseudolikelihood = -5.3393758
Iteration 10:  log pseudolikelihood = -5.3392457
Iteration 11:  log pseudolikelihood = -5.3391979
Iteration 12:  log pseudolikelihood = -5.3391803
Iteration 13:  log pseudolikelihood = -5.3391738
Iteration 14:  log pseudolikelihood = -5.3391714
Iteration 15:  log pseudolikelihood = -5.3391705
Iteration 16:  log pseudolikelihood = -5.3391702
Iteration 17:  log pseudolikelihood = -5.3391701
Iteration 18:  log pseudolikelihood =   -5.33917
Iteration 19:  log pseudolikelihood =   -5.33917
Iteration 20:  log pseudolikelihood =   -5.33917
Iteration 21:  log pseudolikelihood =   -5.33917
Iteration 22:  log pseudolikelihood =   -5.33917
Iteration 23:  log pseudolikelihood =   -5.33917
Iteration 24:  log pseudolikelihood =   -5.33917
Iteration 25:  log pseudolikelihood =   -5.33917
Iteration 26:  log pseudolikelihood =   -5.33917
Iteration 27:  log pseudolikelihood =   -5.33917
Iteration 28:  log pseudolikelihood =   -5.33917
Iteration 29:  log pseudolikelihood =   -5.33917
Iteration 30:  log pseudolikelihood =   -5.33917
Iteration 31:  log pseudolikelihood =   -5.33917
Iteration 32:  log pseudolikelihood =   -5.33917
Iteration 33:  log pseudolikelihood =   -5.33917
Iteration 34:  log pseudolikelihood =   -5.33917
Iteration 35:  log pseudolikelihood =   -5.33917
Iteration 36:  log pseudolikelihood =   -5.33917
Refining estimates:
Iteration 0:   log pseudolikelihood =   -5.33917
Iteration 1:   log pseudolikelihood =   -5.33917

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         280
No. of failures      =            9
Time at risk         =       110140
                                                Wald chi2(1)     =        0.06
Log pseudolikelihood =     -5.33917             Prob > chi2      =      0.8129

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   1.72e+16          .        .       .            .           .
      age_tv |   .9964664   .0149012    -0.24   0.813     .9676844    1.026104
        male |   1.75e+16          .        .       .            .           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/p_adj_model_hosp_any.ster not found)
file ./output/tempdata/p_adj_model_hosp_any.ster saved
(note: file ./output/tempdata/p_surv_adj_hosp_any.dta not found)
file ./output/tempdata/p_surv_adj_hosp_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |      0.76071            .        1             .
      age_tv      |     -0.76071         0.03        1         0.8703
      male        |            .            .        1             .
      ------------+---------------------------------------------------
      global test |                      0.03        1         0.8703
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -8.9146261
Iteration 1:   log pseudolikelihood = -2.2046616
Iteration 2:   log pseudolikelihood =  -.3161228
Iteration 3:   log pseudolikelihood = -.10734583
Iteration 4:   log pseudolikelihood = -.03884627
Iteration 5:   log pseudolikelihood = -.01426319
Iteration 6:   log pseudolikelihood = -.00525643
Iteration 7:   log pseudolikelihood = -.00193852
Iteration 8:   log pseudolikelihood = -.00071481
Iteration 9:   log pseudolikelihood = -.00026349
Iteration 10:  log pseudolikelihood = -.00009709
Iteration 11:  log pseudolikelihood = -.00003576
Iteration 12:  log pseudolikelihood = -.00001317
Iteration 13:  log pseudolikelihood = -4.847e-06
Iteration 14:  log pseudolikelihood = -1.784e-06
Iteration 15:  log pseudolikelihood = -6.752e-07
Iteration 16:  log pseudolikelihood = -2.608e-07
Iteration 17:  log pseudolikelihood = -5.698e-08
Iteration 18:  log pseudolikelihood = -2.683e-08
Iteration 19:  log pseudolikelihood =  1.237e-07
Iteration 20:  log pseudolikelihood =  1.511e-07
Iteration 21:  log pseudolikelihood =  2.098e-07  (backed up)
Iteration 22:  log pseudolikelihood =  2.911e-07
Iteration 23:  log pseudolikelihood =  4.108e-07
Iteration 24:  log pseudolikelihood =  1.872e-07  (backed up)
Refining estimates:
Iteration 0:   log pseudolikelihood = -9.557e-08
Iteration 1:   log pseudolikelihood = -3.516e-08
Iteration 2:   log pseudolikelihood = -1.293e-08
Iteration 3:   log pseudolikelihood = -4.758e-09
Iteration 4:   log pseudolikelihood = -1.750e-09
Iteration 5:   log pseudolikelihood = -6.440e-10
Iteration 6:   log pseudolikelihood = -2.369e-10
Iteration 7:   log pseudolikelihood = -8.715e-11
Iteration 8:   log pseudolikelihood = -3.206e-11
Iteration 9:   log pseudolikelihood = -1.179e-11
Iteration 10:  log pseudolikelihood = -4.334e-12
Iteration 11:  log pseudolikelihood = -1.592e-12
Iteration 12:  log pseudolikelihood = -1.457e-12
Iteration 13:  log pseudolikelihood = -5.471e-13
Iteration 14:  log pseudolikelihood = -1.918e-13
Iteration 15:  log pseudolikelihood = -7.105e-14
Iteration 16:  log pseudolikelihood = -2.842e-14
Iteration 17:  log pseudolikelihood = -7.105e-15
Iteration 18:  log pseudolikelihood =          0

Stratified Cox regr. -- no ties

No. of subjects      =          198             Number of obs    =         280
No. of failures      =            9
Time at risk         =       110140
                                                Wald chi2(13)    =   205489.69
Log pseudolikelihood =            0             Prob > chi2      =      0.0000

                            (Std. Err. adjusted for 89 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        udca |   239.0287   173.5633     7.54   0.000     57.59392    992.0272
      age_tv |   1.021899          .        .       .            .           .
        male |   1.09e+31          .        .       .            .           .
any_high_r~n |          1  (omitted)
             |
     eth_bin |
  Non-White  |   .0000449          .        .       .            .           .
             |
         imd |
          2  |   1.32e+26   1.32e+26    59.93   0.000     1.85e+25    9.43e+26
          3  |   .0000328   .0000403    -8.41   0.000     2.96e-06    .0003642
          4  |   1.59e+15          .        .       .            .           .
          5  |   1.487917    2.67834     0.22   0.825     .0436883    50.67486
          6  |   1.04e-17   1.05e-17   -38.88   0.000     1.45e-18    7.48e-17
             |
     bmi_cat |
Underweight  |   2.84e+10   4.11e+10    16.67   0.000     1.68e+09    4.82e+11
 Overweight  |   4.35e-17   7.68e-17   -21.34   0.000     1.37e-18    1.39e-15
      Obese  |   .0000145   .0000151   -10.65   0.000     1.86e-06    .0001125
Morbidly ..  |   .0231314   .0289247    -3.01   0.003     .0019944    .2682795
             |
     smoking |
Current s..  |   5.18e-13   3.06e-13   -47.89   0.000     1.63e-13    1.65e-12
  Ex-smoker  |   2.01e-09   3.95e-09   -10.21   0.000     4.31e-11    9.41e-08
             |
severe_dis~e |   4.67e-08          .        .       .            .           .
covid_vacc~t |   1.09e-21   1.39e-21   -37.90   0.000     8.98e-23    1.32e-20
 liver_trans |   4.35e+39   8.77e+39    45.30   0.000     8.38e+37    2.26e+41
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/adj_model_hosp_any.ster not found)
file ./output/tempdata/adj_model_hosp_any.ster saved
(note: file ./output/tempdata/surv_adj_hosp_any.dta not found)
file ./output/tempdata/surv_adj_hosp_any.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      udca        |            .         0.00        1         1.0000
      age_tv      |            .            .        1             .
      male        |            .            .        1             .
      o.any_high~n|            .            .        1             .
      0b.eth_bin  |            .            .        1             .
      1.eth_bin   |            .            .        1             .
      1b.imd      |            .            .        1             .
      2.imd       |            .         0.00        1         1.0000
      3.imd       |            .         0.00        1         1.0000
      4.imd       |            .            .        1             .
      5.imd       |            .         0.00        1         1.0000
      6.imd       |            .         0.00        1         1.0000
      1.bmi_cat   |            .         0.00        1         1.0000
      2b.bmi_cat  |            .            .        1             .
      3.bmi_cat   |            .         0.00        1         1.0000
      4.bmi_cat   |            .         0.00        1         1.0000
      5.bmi_cat   |            .         0.00        1         1.0000
      0b.smoking  |            .            .        1             .
      1.smoking   |            .         0.00        1         1.0000
      2.smoking   |            .         0.00        1         1.0000
      severe_dis~e|            .            .        1             .
      covid_vacc~t|            .         0.00        1         1.0000
      liver_trans |            .         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                      0.00       13         1.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.
(note: file ./output/graphs/schoenplot_hosp_any.svg not found)
(file ./output/graphs/schoenplot_hosp_any.svg written in SVG format)

         failure _d:  hosp_any_flag
   analysis time _t:  (stop-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: any_high_risk_condition omitted because of collinearity
Iteration 0:   log pseudolikelihood = -8.9146261
Iteration 1:   log pseudolikelihood = -.58385515
Iteration 2:   log pseudolikelihood = -.13526608
Iteration 3:   log pseudolikelihood = -.04622689
Iteration 4:   log pseudolikelihood =  -.0166274
Iteration 5:   log pseudolikelihood = -.00607164
Iteration 6:   log pseudolikelihood = -.00222827
Iteration 7:   log pseudolikelihood = -.00081915
Iteration 8:   log pseudolikelihood =  -.0003013
Iteration 9:   log pseudolikelihood = -.00011084
Iteration 10:  log pseudolikelihood = -.00004078
Iteration 11:  log pseudolikelihood = -.00001506
Iteration 12:  log pseudolikelihood = -.00001427
Iteration 13:  log pseudolikelihood =  .00099489
Iteration 14:  log pseudolikelihood =  .00149094
Iteration 15:  log pseudolikelihood =  .00251426
Iteration 16:  log pseudolikelihood =  .00687322
Iteration 17:  log pseudolikelihood =  .01515429
Iteration 18:  log pseudolikelihood =  .02107181
Iteration 19:  log pseudolikelihood =  .62151458
Iteration 20:  log pseudolikelihood =   .9133991
Iteration 21:  log pseudolikelihood =  1.0880678
flat region resulting in a missing likelihood
r(430);

end of do-file
r(430);

end of do-file

r(430);


