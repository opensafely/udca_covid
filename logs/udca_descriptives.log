
. 
. tempfile tempfile 

. import delimited using ./output/input_pbc.csv
(106 vars, 1,000 obs)

. save `tempfile' 
file /tmp/St00015.000001 saved

. 
. file open tablecontent using ./output/tables/udca_descriptives.txt, write tex
> t replace
(note: file ./output/tables/udca_descriptives.txt not found)

. * Loop through each dataset with different lengths of days of prescriptions
. forvalues i=60(30)180 {
  2.     use ./output/time_varying_udca_all_vars_`i', clear 
  3.     drop last 
  4.     bys patient_id: gen last = _n==_N 
  5.     file write tablecontent _tab ("Number of obervations") _tab ("Mean") _
> tab ("SD") _tab ("Median") _tab ("25th percentile") _tab ("75th percentile") 
> _n 
  6. 
.     * summarise total number of prescriptions during follow-up 
.     sum total_no_presc if last==1, d 
  7.     file write tablecontent ("Number of prescriptions `i'") _tab %3.1f (r(
> N)) _tab %3.1f (r(mean)) _tab %3.1f (r(sd)) _tab %3.1f (r(p50)) _tab %3.1f (r
> (p25)) _tab %3.1f (r(p75)) _n 
  8. 
.     * Summarise follow-up 
.     sum total_fu if last==1, d
  9.     file write tablecontent ("Total length of follow-up `i'") _tab %3.1f (
> r(N)) _tab %3.1f (r(mean)) _tab %3.1f (r(sd)) _tab %3.1f (r(p50)) _tab %3.1f 
> (r(p25)) _tab %3.1f (r(p75)) _n 
 10. 
.     * Summarise proportion of time on udca 
.     * First generate time for each row 
.     *gen time = stop - start 
.     * Generate total time on & off udca 
.     * First calculate time for both on and off within one variable 
.     bys patient_id udca: egen time_udca = total(time)
 11.     * From this generate variable with time off udca 
.     bys patient_id: egen time_off_udca = max(time_udca) if udca==0
 12.     bys patient_id (time_off_udca): replace time_off_udca = time_off_udca[
> _n-1] if time_off_udca==. & time_off_udca[_n-1]!=.
 13.     * Update time_udca to only contain time on udca 
.     replace time_udca=. if udca==0
 14.     bys patient_id: egen time_on_udca = max(time_udca)
 15.     * Check on and off equals total time of follow-up 
.     count if time_on_udca + time_off_udca!=total_fu
 16. 
.     sum time_on_udca if last==1, d 
 17.     file write tablecontent ("Total time on UDCA `i'") _tab %3.1f (r(N)) _
> tab %3.1f (r(mean)) _tab %3.1f (r(sd)) _tab %3.1f (r(p50)) _tab %3.1f (r(p25)
> ) _tab %3.1f (r(p75)) _n 
 18. 
.     sum time_off_udca if last==1, d 
 19.     file write tablecontent ("Total time off UDCA `i'") _tab %3.1f (r(N)) 
> _tab %3.1f (r(mean)) _tab %3.1f (r(sd)) _tab %3.1f (r(p50)) _tab %3.1f (r(p25
> )) _tab %3.1f (r(p75)) _n 
 20. 
.     bys patient_id: gen rows = _N 
 21.     sum rows if last==1, d 
 22.     file write tablecontent ("Number of rows `i'") _tab %3.1f (r(N)) _tab 
> %3.1f (r(mean)) _tab %3.1f (r(sd)) _tab %3.1f (r(p50)) _tab %3.1f (r(p25)) _t
> ab %3.1f (r(p75)) _n _n 
 23. 
.     * Summarising switching
.     * Generate flag of whether UDCA prescription in 120 days prior to index 
.     gen udca_bl_120 = udca_last_date>=date("01Dec2019", "DMY") & udca_last_da
> te!=.
 24.     gen udca_bl = (udca_count_bl>=1 & udca_count_bl!=.) 
 25.     gen yr_start = year(start)
 26.     sum yr_start 
 27.     gen switch_2020_`i'_i = udca!=udca_bl_120 & yr_start==2020
 28.     bys patient_id: egen switch_2020_`i' = max(switch_2020_`i'_i)
 29.     bys patient_id: egen switch_2020_`i'_total = total(switch_2020_`i'_i)
 30.     gen switch_2020_`i'_start = (switch_2020_`i'==1 & udca_bl_120==0)
 31.     gen switch_2020_`i'_stop = (switch_2020_`i'==1 & udca_bl_120==1)
 32.     gen switch_2020_`i'_multi = (switch_2020_`i'_total>1 & switch_2020_`i'
> _total!=.)
 33.     keep if last==1
 34.     tab switch_2020_`i'  
 35.     safecount if switch_2020_`i'==1
 36.     file write tablecontent ("switching") _tab ("Number switched") _tab ("
> Percent switched") _tab ("Switched from unexposed") _tab ("Percent switched u
> nexposed") _tab ("Switched from exposed") _tab ("Percent switched exposed") _
> n 
 37.     file write tablecontent ("2020 `i'") _tab %3.1f (r(N)) _tab  
 38.     local percent = (r(N)/_N)*100
 39.     safecount if switch_2020_`i'_start==1
 40.     file write tablecontent (`percent') _tab  %3.1f (r(N)) _tab 
 41.     local percent_stt = (r(N)/_N)*100
 42.     safecount if switch_2020_`i'_stop==1
 43.     file write tablecontent (`percent_stt') _tab  %3.1f (r(N)) _tab 
 44.     local percent_stp = (r(N)/_N)*100
 45.     file write tablecontent (`percent_stp') _n _n 
 46. }

                       total_no_presc
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               1,896
25%            0              0       Sum of Wgt.       1,896

50%        142.5                      Mean           82.59968
                        Largest       Std. Dev.      78.45969
75%          157            181
90%          165            181       Variance       6155.923
95%          168            182       Skewness      -.0905987
99%          174            182       Kurtosis       1.033744

                          total_fu
-------------------------------------------------------------
      Percentiles      Smallest
 1%           26              2
 5%          115              3
10%          224              4       Obs               1,896
25%        639.5             10       Sum of Wgt.       1,896

50%         1035                      Mean           832.7468
                        Largest       Std. Dev.      323.0369
75%         1035           1035
90%         1035           1035       Variance       104352.8
95%         1035           1035       Skewness      -1.297616
99%         1035           1035       Kurtosis       3.146838
(1033 missing values generated)
(1033 real changes made)
(1,930 real changes made, 1,930 to missing)
(897 missing values generated)
  897

                        time_on_udca
-------------------------------------------------------------
      Percentiles      Smallest
 1%           75              8
 5%          695              9
10%         1009             13       Obs                 999
25%         1022             19       Sum of Wgt.         999

50%         1028                      Mean           987.7427
                        Largest       Std. Dev.      165.0436
75%         1032           1034
90%         1034           1034       Variance       27239.39
95%         1034           1034       Skewness       -4.46456
99%         1034           1034       Kurtosis       22.47121

                        time_off_udca
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            2              1       Obs               1,896
25%            5              1       Sum of Wgt.       1,896

50%           21                      Mean           312.3064
                        Largest       Std. Dev.      404.4541
75%        633.5           1035
90%         1035           1035       Variance       163583.1
95%         1035           1035       Skewness       .8801369
99%         1035           1035       Kurtosis       2.080501

                            rows
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs               1,896
25%            1              1       Sum of Wgt.       1,896

50%            2                      Mean           1.562764
                        Largest       Std. Dev.      .5948464
75%            2              4
90%            2              4       Variance       .3538423
95%            2              4       Skewness       1.035782
99%            4              4       Kurtosis       5.587189
udca_last_date not found
r(111);

end of do-file
r(111);

end of do-file

r(111);


